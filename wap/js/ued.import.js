var ued_concat = {"ued.import.js":["Concat.js","Config.js","Import.js","../js/util/panda.js"],"cube_editor.js":["../js/util/jquery.js","../js/widget/spectrum.js","../js/editor/util/html2canvas.js","../js/editor/util/feather.js","../js/editor/util/feathercontrols_desktop_zh_hans.js","../js/editor/util/featherpaint.js","../js/editor/util/jquery.nouislider.js","../js/editor/util/jquery.nicescroll.js","../js/widget/jquery-ui-datepicker-slider.js","../js/widget/jquery-ui-timepicker.js","../js/util/jquery-placeholder.js","../js/widget/Guid.js","../js/widget/price.js","../js/widget/Calendar.js","../js/editor/util/activityEditor.js","../js/editor/util/slideEditor.js","../js/editor/propertyeditor/dataproperty.js","../js/editor/util/lang.js","../js/editor/util/imageselector.js","../js/editor/util/imageManager.js","../js/editor/util/loading.js","../js/widget/PTemplate.js","../js/editor/propertyeditor/linkproperty.js","../js/util/JSON2.js","../js/editor/propertyeditor/template.js","../js/editor/propertyeditor/editor.js","../js/editor/propertyPanel.js","../js/editor/util/compDrag.js","../js/editor/componentPanel.js","../js/widget/AjaxUpload.js","../js/editor/util/uploader.js","../js/editor/util/imageEditor.js","../js/editor/rightMenu.js","../js/editor/util/keyboardManager.js","../js/editor/util/undo.js","../js/editor/toolbar.js","../js/widget/Button.js","../js/widget/PopBase.js","../js/editor/util/dialog.js","../js/editor/editCanvas.js","../js/editor/util/netHelper.js","../js/editor/editor.js"],"panda_cube.css":["../skin/v1.0.0/panda_cube.css","../skin/v1.0.0/cube_img_dialog.css","../skin/v1.0.0/cube_viewpage.css","../skin/v1.0.0/cube_editpage.css","../skin/v1.0.0/cube_zy.css","../skin/v1.0.0/spectrum.css","../skin/v1.0.0/jquery.nouislider.css","../skin/v1.0.0/jquery.datepicker.css","../skin/widget/button/cube/button.css","../skin/widget/popbase/cube/popbase.css","../skin/widget/tree/cube/tree.css","../skin/widget/tip/default/tip.css","../skin/widget/table/default/table.css","../skin/widget/pagination/default/pagination.css","../skin/widget/select/default/select.css","../skin/widget/calendar/default/calendar.css","../skin/image_editor/feather_core_minimum.css","../skin/v1.0.0/introjs.css"],"edit_content.css":["../skin/v1.0.0/cube_viewpage.css","../skin/v1.0.0/cube_editpage.css","../skin/v1.0.0/spectrum.css"],"edit_content.js":["../js/util/jquery.js","../js/editor/util/html2canvas.js","../js/panda_widget/nicEdit/nicEdit.js","../js/widget/price.js","../js/widget/Button.js","../js/widget/PopBase.js","../js/editor/util/dialog.js","../js/editor/frame/keyBoard.js","../js/editor/util/netHelper.js","../js/editor/selectRect.js","../js/editor/frame/frame.js"],"cube_preview.js":["../js/util/jquery.js","../js/editor/util/jquery.nicescroll.js","../js/util/qrcode.js","../js/preview/border.js","../js/preview/device.js","../js/widget/PTemplate.js","../js/preview/entrance.js"],"shop_main.css":["../skin/v1.0.0/shop-main.css","../skin/v1.0.0/cube_img_dialog.css","../skin/widget/button/cube/button.css","../skin/widget/popbase/cube/popbase.css","../skin/v1.0.0/jquery.datepicker.css","../skin/v1.0.0/introjs.css"],"cubebase.css":["../skin/v1.0.0/cubebase.css"],"shop_myapp.js":["../js/util/qrcode.js","../js/widget/Button.js","../js/widget/PopBase.js","../js/editor/util/dialog.js","../js/shopModule/appHandle.js","../js/widget/Sldscale.js","../js/widget/ScrollBar.js","../js/shop/shopBack/myApp.js","../js/widget/Guid.js"],"shop_set.js":["../js/util/jquery.js","../js/editor/util/jquery.nicescroll.js","../js/shop/shopModule/formVerify.js","../js/editor/util/lang.js","../js/editor/util/netHelper.js","../js/widget/PTemplate.js","../js/editor/util/imageselector.js","../js/editor/util/imageManager.js","../js/widget/Button.js","../js/widget/PopBase.js","../js/editor/util/dialog.js","../js/editor/util/imageEditor.js","../js/widget/AjaxUpload.js","../js/widget/Sldscale.js","../js/widget/ScrollBar.js","../js/shop/shopBack/appSet.js"],"shop_choice.js":["../js/widget/Sldscale.js","../js/widget/ScrollBar.js","../js/shop/shopBack/appChoice.js","../js/widget/Guid.js"],"shop_start.js":["../js/util/jquery.js","../js/editor/util/jquery.nicescroll.js","../js/editor/util/lang.js","../js/editor/util/netHelper.js","../js/widget/PTemplate.js","../js/editor/util/imageselector.js","../js/editor/util/imageManager.js","../js/widget/Button.js","../js/widget/PopBase.js","../js/editor/util/dialog.js","../js/editor/util/imageEditor.js","../js/widget/AjaxUpload.js","../js/widget/Sldscale.js","../js/widget/ScrollBar.js","../js/shop/shopBack/appStart_new.js"],"store_list.js":["../js/util/qrcode.js","../js/widget/Button.js","../js/widget/PopBase.js","../js/editor/util/dialog.js","../js/widget/Sldscale.js","../js/widget/ScrollBar.js","../js/shop/shopBack/maStore.js","../js/widget/Guid.js"],"widget_up.js":["../js/util/jquery.js","../js/editor/util/jquery.nicescroll.js","../js/editor/util/imageEditor.js","../js/editor/util/lang.js","../js/editor/util/netHelper.js","../js/widget/PTemplate.js","../js/editor/util/imageselector.js","../js/widget/Button.js","../js/widget/PopBase.js","../js/editor/util/dialog.js","../js/editor/util/imageManager.js","../js/widget/AjaxUpload.js","../js/widget/Sldscale.js","../js/widget/ScrollBar.js","../js/shop/shopBack/widgetUp.js"],"shop_pack.js":["../js/util/jquery.js","../js/shop/shopModule/pack.js","../js/widget/Sldscale.js","../js/widget/ScrollBar.js","../js/shop/shopBack/appPreview.js"],"widget_ku.js":["../js/editor/util/imageEditor.js","../js/widget/AjaxUpload.js","../js/editor/util/lang.js","../js/editor/util/netHelper.js","../js/widget/PTemplate.js","../js/editor/util/imageselector.js","../js/widget/Button.js","../js/widget/PopBase.js","../js/editor/util/dialog.js","../js/editor/util/imageManager.js","../js/widget/Sldscale.js","../js/widget/ScrollBar.js","../js/shop/shopBack/widgetKu.js"],"widget_item.js":["../js/widget/Sldscale.js","../js/widget/ScrollBar.js","../js/shop/shopBack/widgetItem.js"],"shop_guide.js":["../js/shop/shopBack/guide.js"],"help.js":["../js/shop/shopBack/help.js"],"run_common.js":["../js/util/jquery.js","../js/util/panda.js","../js/template/follow.js","../js/util/run_common.js","../js/widget/price.js","../js/template/im.js","../js/widget/imgLazyLoad.js","../js/widget/imgLoadCheck.js"],"run_common.css":["../skin/v1.0.0/foundation.css"],"template.js":["../js/template/template.js"],"browserCheck.js":["../js/util/browserCheck.js"],"modernizr.js":["../js/util/modernizr.js"],"browser.css":["../skin/v1.0.0/browser.css"],"m-panda.js":["../js/util/m-panda.js"],"imgLazyLoad.js":["../js/widget/imgLazyLoad.js"],"data_chart.js":["../js/util/jquery.js","../js/widget/jquery-ui-datepicker-slider.js","../js/widget/jquery-ui-timepicker.js","../js/widget/highcharts.js","../js/shop/shopModule/dataModule.js","../js/widget/Sldscale.js","../js/widget/ScrollBar.js","../js/shop/shopBack/dataCharts.js"],"data_table.js":["../js/util/jquery.js","../js/widget/jquery-ui-datepicker-slider.js","../js/widget/jquery-ui-timepicker.js","../js/shop/shopModule/pageModule.js","../js/shopModule/pageModule.js","../js/shop/shopModule/dataModule.js","../js/widget/Sldscale.js","../js/widget/ScrollBar.js","../js/shop/shopBack/dataTable.js"],"template2.css":["../skin/v1.0.0/template2.css"],"template3.css":["../skin/v1.0.0/template3.css"],"template0409.css":["../skin/v1.0.0/template0409.css"],"template0409.js":["../js/template/template0409.js"]}; /*try{panda.use("base.global");}catch(e){}*/
var config = {
	ued_conf:{
		'ued.import.js':[
			'Concat.js',
			'Config.js',
			'Import.js',
			'../js/util/panda.js'
		],
		//编辑器页面的JS
		'cube_editor.js' : [
			"../js/util/jquery.js",
			"../js/widget/spectrum.js",
			"../js/editor/util/html2canvas.js",
			"../js/editor/util/feather.js",
			"../js/editor/util/feathercontrols_desktop_zh_hans.js",
			"../js/editor/util/featherpaint.js",
			"../js/editor/util/jquery.nouislider.js",
			"../js/editor/util/jquery.nicescroll.js",
			"../js/widget/jquery-ui-datepicker-slider.js",
			"../js/widget/jquery-ui-timepicker.js",
            "../js/util/jquery-placeholder.js",
            "../js/widget/Guid.js",
            "../js/widget/price.js",
			"../js/editor/editor.js"
		],
		//编辑器页面的CSS
		"panda_cube.css": [
			'../skin/v1.0.0/panda_cube.css',
            "../skin/v1.0.0/cube_img_dialog.css",
	        "../skin/v1.0.0/cube_viewpage.css",
			'../skin/v1.0.0/cube_editpage.css',
			'../skin/v1.0.0/cube_zy.css',
			'../skin/v1.0.0/spectrum.css',
			'../skin/v1.0.0/jquery.nouislider.css',
			'../skin/v1.0.0/jquery.datepicker.css',
			'../skin/widget/button/cube/button.css',
			'../skin/widget/popbase/cube/popbase.css',
			'../skin/widget/tree/cube/tree.css',
			'../skin/widget/tip/default/tip.css',
			'../skin/widget/table/default/table.css',
			'../skin/widget/pagination/default/pagination.css',
			'../skin/widget/select/default/select.css',
			'../skin/widget/calendar/default/calendar.css',
			'../skin/image_editor/feather_core_minimum.css',
            '../skin/v1.0.0/introjs.css'
	    ],
//		"cube_editpage.css": [
//	        "../js/panda.js",
//			"../js/util/jquery.js",
//			"../js/editor/selectRect.js",
//			"../js/editor/util/html2canvas.js",
//			"../js/editor/util/netHelper.js",
//			"../js/panda_widget/nicEdit/nicEdit.js",
//			"../js/editor/frame/*.js"
//	    ],
		//模板页面的CSS
	    "edit_content.css": [
	        "../skin/v1.0.0/cube_viewpage.css",
			'../skin/v1.0.0/cube_editpage.css',
			'../skin/v1.0.0/spectrum.css'
	    ],	
		//模板的页面的JS
	    "edit_content.js":[
	    	'../js/util/jquery.js',
	    	'../js/editor/util/html2canvas.js',
	    	'../js/panda_widget/nicEdit/nicEdit.js',
            "../js/widget/price.js",
	    	'../js/editor/frame/frame.js'
	    ],
	    "cube_preview.js":[
            "../js/util/jquery.js",
            "../js/editor/util/jquery.nicescroll.js",
            "../js/util/qrcode.js",
            '../js/preview/entrance.js'
	    ],
        //商家页面css
        "shop_main.css": [
            "../skin/v1.0.0/shop-main.css",
            "../skin/v1.0.0/cube_img_dialog.css",
            "../skin/widget/button/cube/button.css",
            "../skin/widget/popbase/cube/popbase.css",
            '../skin/v1.0.0/jquery.datepicker.css',
            '../skin/v1.0.0/introjs.css'
        ],
        "cubebase.css": [
            "../skin/v1.0.0/cubebase.css"
        ],
        //我的app页面js
        "shop_myapp.js": [
            "../js/util/qrcode.js",
            "../js/shop/shopBack/myApp.js",
            "../js/widget/Guid.js"
        ],

        //基础信息设置页面js
        "shop_set.js": [
        	"../js/util/jquery.js",
			"../js/editor/util/jquery.nicescroll.js",
            "../js/shop/shopBack/appSet.js"
        ],

        //模版选择页面js
        "shop_choice.js": [
            "../js/shop/shopBack/appChoice.js",
            "../js/widget/Guid.js"
        ],

        //启动动画页面js
        "shop_start.js": [
            "../js/util/jquery.js",
            "../js/editor/util/jquery.nicescroll.js",
            "../js/shop/shopBack/appStart_new.js"
        ],

        //店铺列表页面js
        "store_list.js": [
            "../js/util/qrcode.js",
            "../js/shop/shopBack/maStore.js",
            "../js/widget/Guid.js"
        ],

        //组件上传页面js
        "widget_up.js": [
            "../js/util/jquery.js",
            "../js/editor/util/jquery.nicescroll.js",
            "../js/shop/shopBack/widgetUp.js"
        ],
        //打包页面js
//        "shop_down.js": [
//            "js/shopBack/package.js"
//        ],

        //打包预览页面
        "shop_pack.js": [
			"../js/util/jquery.js",
            "../js/shop/shopBack/appPreview.js"
        ],

        //组件库列表
        "widget_ku.js": [
            "../js/shop/shopBack/widgetKu.js"
        ],

        //组件库列表
        "widget_item.js": [
            "../js/shop/shopBack/widgetItem.js"
        ],
        //首页
        "shop_guide.js": [
            "../js/shop/shopBack/guide.js"
        ],
        /** 
          *帮助
          */
        "help.js": [
            "../js/shop/shopBack/help.js"
        ],
        // 运行界面公共JS
        "run_common.js":[
        	"../js/util/jquery.js",
        	"../js/util/panda.js",
        	"../js/template/follow.js",
        	"../js/util/run_common.js",
            "../js/widget/price.js",
            '../js/template/im.js',
            "../js/widget/imgLazyLoad.js",
            "../js/widget/imgLoadCheck.js"
        ],
        "run_common.css":[
        	"../skin/v1.0.0/foundation.css"
        ],
        "template.js":[
            "../js/template/template.js"
        ],

        "browserCheck.js":[
            "../js/util/browserCheck.js"
        ],
        "modernizr.js":[
            "../js/util/modernizr.js"
        ],
        "browser.css":[
            "../skin/v1.0.0/browser.css"
        ],
        "m-panda.js":[
            "../js/util/m-panda.js"
        ],
        "imgLazyLoad.js":[
            "../js/widget/imgLazyLoad.js"
        ],

        /**
         *数据统计模块
         */
        "data_chart.js":[
            "../js/util/jquery.js",
            "../js/widget/jquery-ui-datepicker-slider.js",
            "../js/widget/jquery-ui-timepicker.js",
            "../js/widget/highcharts.js",
            "../js/shop/shopBack/dataCharts.js"
        ],
        "data_table.js":[
            "../js/util/jquery.js",
            "../js/widget/jquery-ui-datepicker-slider.js",
            "../js/widget/jquery-ui-timepicker.js",
            "../js/shop/shopBack/dataTable.js"
        ],
        /**
         * 模板css、js 文件
         */
        "cubebase.css":[
            "../skin/v1.0.0/cubebase.css"
        ],
        "template2.css":[
            "../skin/v1.0.0/template2.css"
        ],
        "template3.css":[
            "../skin/v1.0.0/template3.css"
        ],
        // 该js文件是周生生的模板，基于jquery编写
        "template0409.css":[
            "../skin/v1.0.0/template0409.css"
        ],
        "template0409.js":[
            "../js/template/template0409.js"
        ]
        /**
         * end
         */
    },
	ued_config:{
		name:"panda_demo",
		version:"v1.0.0",
		publish:"v20140626",
		development:"online",
		root:"http://static.360buyimg.com/panda_cube/",
		require:"../js/"
	}
//	ued_config:{
//		name:"panda_demo",
//		version:"v1.0.0",
//		publish:"v20140423",
//		development:"dev",
//		root:"http://localhost/panda_cube/dist/",
//		require:"../js/"
//	}
};
var ued_config = config.ued_config;
var ued_conf = config.ued_conf;
(function () {
  	function __ready(onready, config) {
		function DOMContentLoaded() {
			document.attachEvent ? (document.readyState == 'complete' ? doReady() : null) : doReady();
		}
		
        function doReady() {
			onready();
        }
        
		if ( document.readyState === "complete" ) {
            doReady();
        }
        else if ( document.addEventListener ) {
            document.addEventListener( "DOMContentLoaded", DOMContentLoaded, false );
            window.addEventListener( "load", doReady, false );
        } 
		else if ( document.attachEvent ) {
            document.attachEvent("onreadystatechange", DOMContentLoaded);
            window.attachEvent( "onload", doReady );
            var toplevel = false;
            try {
                toplevel = window.frameElement == null;
            } catch(e) {}

            if ( document.documentElement.doScroll && toplevel ) {
                (function () {
	                if (panda.isReady) return;
	                try {
	                    document.documentElement.doScroll("left");
	                } catch (error) {
	                    setTimeout(arguments.callee, 0);
	                    return;
	                }
	                doReady();
	            })();
            }
        }
    }
	
	window.__ready = __ready;
})();

/** 
 * @function asyncImport
 * @param src js的路径
*/

function asyncImportJs(src, charset) {
	charset = charset || "utf-8";
	
	var container = document.getElementsByTagName("head")[0];
    var script = document.createElement("script");
    script.src = src;

    if (charset != undefined) {
        script.charset = charset;
    }

    if (!container) {
        document.body.insertBefore(script, document.body.firstChild);
    } else {
        container.appendChild(script);
    }
}

/** 
 * @function import
 * @param id 静态文件的id名称
 * @param fileType  文件类型  js/css
 * @param mode 运行环境 dev/online dev表示环境加载多个源码文件 online代表线上环境 加载单个合并压缩后的文件
*/
function ued_import(id, fileType, doc) {
	var mode = ued_config.development;
	doc = doc || document;
	
	if(!mode) {
		mode = "online";
	}

	var __id = id +'.' + fileType;

	if (!ued_concat[__id]) {
		return false;
	}

	var jsTemplate = '<script src="${src}" charset="utf-8" type="text/javascript" itemid="${itemid}"><\/script>';
	var cssTemplate = '<link rel="stylesheet" type="text/css" href="${href}">';

	function __import(aFiles, type, id) {
		for(var i=0; i<aFiles.length; i++) {
			if (type == "js") {
				var jsUrl = ued_config.root + aFiles[i];
				document.write(jsTemplate.replace("${src}", jsUrl).replace("${itemid}", id));
			} else if (type == "css") {
				var link = aFiles[i];
				var cssUrl = cssTemplate.replace("${href}", ued_config.root + link).replace("${itemid}", id);
				document.write(cssUrl);
			}
		}
	}

    if (ued_config.development == "online") {
		if ("css" == fileType) {
			__import(['dist/' + ued_config.publish + "/" + __id.replace(".css", "-min.css")], fileType, __id);
		} else {
			__import(['dist/' + ued_config.publish + "/" + __id.replace(".js", "-min.js")], fileType, __id);
		}
    } else if (ued_config.development == "dev") {
		__import(ued_concat[__id], fileType, __id);
    }
} 
(function () {
	if(typeof window.panda == 'function') {
		return;
	}
	
	/**
	 * ERROR START
	 */
	var Stack = {
        list:[],
        extractStacktrace:function(e, offset) {
            offset = offset === undefined ? 3 : offset;
            var stack, include, i;
			this.list.push(e);
            if (e.stacktrace) {
                return e.stacktrace.split("\n")[ offset + 3 ];
            } else if (e.stack) {
                stack = e.stack.split("\n");
                for (i = offset; i < stack.length; i++) {
                    this.list.push(stack[ i ]);
                }
            }
        },
        get:function (){
            return this.list.splice(0).join("\n");
        }
    };
	/**
	 * ERROR END
	 */
	var config = {
		charset:"UTF-8",
		path:""
	};
	
	var scriptNode = document.getElementById('panda');
	if(window && window.ued_config && window.ued_config.root) {
		config.path = window.ued_config.root + window.ued_config.require;
	}
	else if(scriptNode) {
		config.path = scriptNode.getAttribute ? scriptNode.getAttribute('base') : scriptNode.base;
	}
	if(!config.path) {
		var splits = location.href.split('/');
		splits.pop();
		config.path = splits.join('/');
	}
	var head = document.getElementsByTagName("head")[0];
	
	/**
	 * PROMISE START
	 */
	var PromiseA = {};
	function Deferred() {
		var self = this;
		var successCallback = [], failCallback = [], state = "Pending";
		var value;
		
		function Promise() {
			var self = this;
			self.success = function(callback) {
				if(state == "Resolved") {
					callback.call(self, value);
				}else {
					successCallback.push(callback);
				}
				
				return self;
			};
			self.fail = function(callback) {
				if(state == "Rejected") {
					callback.call(self, value);
				}else {
					failCallback.push(callback);
				}
				
				return self;
			};
			self.then = function(onSuccess, onError) {
				return self.success(onSuccess).fail(onError);
			};
			self.always = function(callback) {
				return self.success(callback).fail(callback);
			};
		}
		
		self.promise = new Promise();
		self.resolve = function(result, data) {
			if (state === "Pending") {
                state = "Resolved";
                value = result;
				for(var i=0;i<successCallback.length;i++) {
					(function() {
						successCallback[i].call(self.promise, result, data);
					})();
				}
            }
		};
		self.reject = function(result) {
			if (state === "Pending") {
                state = "Rejected";
                value = result;
				for(var i=0;i<successCallback.length;i++) {
					(function() {
						successCallback[i].call(self.promise, result);
					})();
				}
            }
		};
	}
	
	/**
	 * 该方法会在满足所有条件的情况下，对callback函数进行调用，该方法基于PromiseA
	 * @method when
	 * @param {Array} conditions [] Promise对象列表，表示需要满足的条件
	 * @param {Function} callback - 当满足条件时所需回调的函数
	 * @return {Promise}
	 * @example
	 * 		panda.when([requestFeed('renren'), requestFeed('weibo'), requestFeed('qzone')], function(result) {
	 * 			// 对result数据进行处理
	 * 		});
	 */
	function when(value, data) {
		var promises = value instanceof Array ? value : [value];
		var total = promises.length, completed = 0;
		var def = new Deferred();
		for(var i=0;i<promises.length;i++) {
			(function() {
				var pro = promises[i];
				pro.always(function(value) {
					completed++;
					if(completed === total) {
						def.resolve(value, data);
					}
				});
			})();
		}
		
		return def.promise;
	}
	
	PromiseA.Deferred = Deferred;
	PromiseA.when = when;
	/**
	 * PROMISE END
	 */
	
	/**
	 * AMD START
	 */
	var REQUIRE_RE = /require\(('|")([^()<>\\\/|?*:]*)('|")\)/g;
	//var COMMENT_RE = /(\/\*(\s|.)*?\*\/)|(\/\/\s*.*)/ig;
	var COMMENT_RE = /(\/\*(.|[\r\n])*?\*\/)|((\/\/.*))/g;
	var moduleCache = {};
	var unique = new Date().getTime();
	var timestamp = new Date().getTime();
	var UNIQUE_RE = new RegExp("PANDA\:\\d{"+timestamp.toString().length+"}");
	function request(id) {
		var node = document.createElement('script');
		node.charset = config.charset;
		node.src = config.path + "/" + id.replace(/\./g, '/') + '.js' + (/msie/.test(navigator.userAgent.toLowerCase()) ? '?_='+(unique++) : '');
		node.async = true;
		
		var def = new PromiseA.Deferred();
		
		node.onload = node.onreadystatechange = function() {
			if(/^(?:loaded|complete|undefined)$/.test(node.readyState)) {
				node.onload = node.onerror = node.onreadystatechange = null;
				if (moduleCache[id] && moduleCache[id].factory) {
					moduleCache[id].state = 1;
					var flag = true;
					for(var i=0;i<moduleCache[id].deps.length;i++) {
						var testCache = moduleCache[moduleCache[id].deps[i]];
						if(!testCache || testCache.state < 1) {
							flag = false;
							break;
						}
					}
					if(flag) {
						def.resolve(id);
						return;
					}else {
						load(moduleCache[id], function() {def.resolve(id);});	
					}
				}else {
					setTimeout(arguments.callee, 0);
				}
			}
		};
		node.onerror = function() {
			node.onload = node.onerror = node.onreadystatechange = null;
			throw new Error("Module("+id+") requested error.");
		};
		// IE local filesystem just load timefly
		if(node.src.toLowerCase().indexOf("file:") == 0)
			node.onload();
		
		nodeCache = node;
		head.appendChild(node);
		nodeCache = null;
		
		return def.promise;
	}
	function getDeps(factory) {
		var result = [];
		factory.toString().replace(COMMENT_RE, '').replace(REQUIRE_RE, function(match, f1, f2, f3) {
			var checkerStr = ',' + result.join(',') + ',';
			if(checkerStr.indexOf(f2) < 0)
				result.push(f2);
		});
		return result;
	}
	function unloaded(module) {
		module = typeof module == 'string' ? moduleCache[module] : module;
		var result = [];
		if(module) {
			var deps = module.deps;
			if(deps.length == 0) {
				deps = module.deps = getDeps(module.factory);
			}
			for(var i=0;i<deps.length;i++) {
				if(!moduleCache[deps[i]] || !moduleCache[deps[i]].factory) {
					result.push(deps[i]);
				}
			}
		}
		return result;
	}
	function execute(module, id) {
		function require(id) {
			return execute(moduleCache[id], id);
		}
		if(!module) {
			throw new Error("Can't find Module("+id+"), is it exists or right name?");
		}
		if(module.state < 2) {
			moduleCache[module.id].state = 2;
			var exports = module.factory.call(module, require, module.exports, module);
			if(exports) {
				module.exports = exports;
			}
		}
		if(!UNIQUE_RE.test(module.id)) {
			panda.regist(module.id, module.exports);
		}
		return module.exports;
	}
	function status(module, value) {
		for(var i=0;i<module.deps.length;i++) {
			moduleCache[module.deps[i]].state = value;
		}
	}
	function getModule(id, deps, factory) {
		if(id && !moduleCache[id]) {
			return moduleCache[id] = {id:id, deps:deps, factory:factory, state:0, exports:null};
		}
		
		return moduleCache[id];
	}
	function load(module, callback) {
		function done(id, callback) {
			var module = getModule(id);
			module.state < 1 && (module.state = 1);
			var reunload = [];
			for(var i=0;i<module.deps.length;i++) {
				reunload.concat(unloaded(module.deps[i]));
			}
			
			if(reunload.length) {
				module.deps = module.deps.concat(reunload);
				load(module, callback);
			}else {
				var redeps = [];
				for(var i=0;i<module.deps.length;i++) {
					var remodule = getModule(module.deps[i]);
					remodule.state > 0 && (redeps.concat(getDeps(remodule.factory)));
				}
				if (redeps.length) {
					var repros = [];
					for(var i=0;i<redeps.length;i++) {
						repros.push(request(redeps[i]));
					}
					PromiseA.when(repros, callback).then(load);
				}else {
					callback && callback(module);
				}
			}
		}
		
		var unload = unloaded(module);
		if(!unload.length) {
			callback && callback(module);
			return;
		}
		
		var pros = [];
		for(var i=0;i<unload.length;i++) {
			pros.push(request(unload[i]));
		}

		PromiseA.when(pros, callback).then(done);
	}
	/**
	 * AMD END
	 */
	/**
	 * 定义一个符合AMD规范的有名模块，有名模块不会立即执行，该模块仅在被require的时候才会被执行并返回结果
	 * @method define
	 * @param {String} id - 模块的名称，该名称建议使用文件名进行定义，例如  com.model.Project，注：windows平台下的文件名不区分大小写，建议开发人员在定义模块名时依然明确模块名的大小写
	 * @param {Array} deps [] 该模块所需要的其它模块，另外，分析一个模块的依赖模块时，我们还会根据factory方法里使用require方法声明使用的模块，当所有依赖模块加载完成后，才会执行factory方法
	 * @param {Function} factory - 该模块的具体实现函数
	 * @return {null}
	 * @example
	 * 		// 该方法将定义一个名为widget.CodeEditor的模块，该模块会预先加载KeyboardManager, SkinManager, sql三个文件
	 * 		// 并在requirec("widget.CodeEditor")的时候执行factory
	 * 		define("widget.CodeEditor", ["widget.codeeditor.KeyboardManager", "widget.codeeditor.SkinManager"], function(require) {
	 * 			var mode = requirec("widget.codeeditor.mode.sql");
	 * 			return {};
	 * 		});
	 */
	/**
	 * 定义一个符合AMD规范的匿名模块，匿名模块将会在依赖模块加载完成时被立即执行
	 * @method define
	 * @param {Function} factory - 该模块的具体实现函数
	 * @param {Array} deps [] 该模块所需要的其它模块，另外，分析一个模块的依赖模块时，我们还会根据factory方法里使用require方法声明使用的模块，当所有依赖模块加载完成后，才会执行factory方法
	 * @return {null}
	 * @example
	 * 		// 该方法将定义一个匿名模块，该模块会预先加载KeyboardManager, SkinManager, sql三个文件
	 * 		// 并在三个依赖文件加载完成时，立即执行factory方法
	 * 		define(function(require) {
	 * 			var mode = requirec("widget.codeeditor.mode.sql");
	 * 			return {};
	 * 		}, ["widget.codeeditor.KeyboardManager", "widget.codeeditor.SkinManager"]);
	 */
	window.define = function(id, deps, factory) {
		if(typeof id == 'function') {
			factory = id;
			id = "PANDA:"+(timestamp++);
		}
		
		if(typeof deps == 'function') {
			factory = deps;
			deps = [];
		}
		
		var deps = (deps || []).concat(getDeps(factory));
		var module = getModule(id, deps, factory);
		if(UNIQUE_RE.test(id)) {
			load(module, function() {
				execute(module);
			});
		}
	};
	
	/**
	 * 包含PandaJS中的全局方法以及核心机制方法
	 * @namespace Core.general 
	 */
	/**
	 * 根据CSS选择器进行DOM节点选择，并返回由匹配节点组成的数组
	 * @method panda
	 * @param {String} selector - CSS选择器内容
	 * @param {DOM} context 可选 父级对象，用于表示该CSS选择器的选择范围
	 * @return {PandaDOM}
	 * @example
	 * 		panda("div.test").height();
	 * 		panda("input[name=password]", panda("div.text")).val();
	 * 		panda("ul>li>a>img").attr('src');
	 */
	/**
	 * 将原生节点封装为PandaDOM
	 * @method panda
	 * @param {DOM} dom - 原生节点对象
	 * @return {PandaDOM}
	 * @example
	 * 		panda(document.body).height();
	 */
	/**
	 * 将原生数组对象封装为PandaArray，为原生数组扩展Panda里的array系列方法
	 * @method panda
	 * @param {Array} array - 待扩展的原生数组对象
	 * @return {PandaArray}
	 * @example
	 * 		panda([1,2,2,3,3,4,5]).unique(); // ==> [1,2,3,4,5]
	 */
	/**
	 * 添加一个方法，该方法将会在DOM树完成加载时进行调用
	 * @method panda
	 * @param {Function} func - 待执行的函数
	 * @return {Panda}
	 * @example
	 * 		// 该回调函数将会接收一个require方法，require方法是由AMD规范定义的模块加载方法
	 * 		panda(function(require) {
	 * 			console.log("DOM is finish load.");
	 * 		});
	 */
	/**
	 * 根据指定的HTML片段进行DOM元素的创建
	 * @method panda
	 * @param {String} html - 待创建的HTML片段，Panda会过滤html片段中的首尾空格，请确保传递内容为有效的HTML片段，否则将被视为CSS选择器进行匹配
	 * @return {PandaDOM}
	 * @example
	 * 		// 该示例演示新建一个具有mask样式名的DIV元素，并新增一个hide样式名，最终将创建后的DIV添加到body的最后
	 * 		panda('<div class="mask"></div>').addClass('hide').appendTo('body');
	 */
	
	var panda = function() {
		var param = arguments[0];
        if(param && (typeof param == 'string' || param.__type__ == 'panda.string')) {
            return panda.query(param, arguments[1]);
        }
        if(param && typeof param == 'object') {
            if(panda.isArray(param) && param.__type__ !== "panda.dom") {
                return panda.array.createArray(param);
            }else {
                return panda.query(param);
            }
        }
        if(param && typeof param == 'function') {
            return panda.ready(param);
        }
        
        return panda.query();
	};
	var _rl_ = [];
	panda.ready = function(callback) {
        if(callback && typeof callback == 'function')
            _rl_.push(callback);
        if(this.isReady) {
            var call = null;
            while(call = _rl_.shift()) {
                define(call);
            }
        }
    };
	panda.allReady = function() {
		panda.ready();
	};
	panda.regist = function(id, func) {
		var name = id.replace(/^base\./, '').split('.'),ns,last = panda, str = name.join('"]["');
		while(ns = name.shift()) {
			last[ns] = last[ns] || {};
			last = last[ns];
		}
		last !== panda && (
			// panda[''][''] = func
			eval('panda["'+str+'"]=func')
		);
	};
	panda.use = panda.define = define;
	panda.EXTEND_OBJECT_POOL = {};
	panda.isReady = false;
	panda.Deferred = PromiseA.Deferred;
	panda.when = PromiseA.when;
	panda.stack = Stack;
	panda.__module_cache__ = moduleCache;
	window.panda = panda;
	window.hasOwnProperty = window.hasOwnProperty || Object.prototype.hasOwnProperty;
	
	function onDOMContentLoaded(onready, config) {
		function DOMContentLoaded() {
			document.attachEvent ? (document.readyState == 'complete' ? doReady() : null) : doReady();
		}
		
        function doReady() {
            if (!panda.isReady) {
				panda.isReady = true;
				onready();
			}
        }
        
		if ( document.readyState === "complete" ) {
            doReady();
        }
        else if ( document.addEventListener ) {
            document.addEventListener( "DOMContentLoaded", DOMContentLoaded, false );
            window.addEventListener( "load", doReady, false );
        } 
		else if ( document.attachEvent ) {
            document.attachEvent("onreadystatechange", DOMContentLoaded);
            window.attachEvent( "onload", doReady );
            var toplevel = false;
            try {
                toplevel = window.frameElement == null;
            } catch(e) {}

            if ( document.documentElement.doScroll && toplevel ) {
                (function () {
	                if (panda.isReady) return;
	                try {
	                    document.documentElement.doScroll("left");
	                } catch (error) {
	                    setTimeout(arguments.callee, 0);
	                    return;
	                }
	                doReady();
	            })();
            }
        }
    }
	
	onDOMContentLoaded(function(){
		define(function(require) {
			require("base.global");
		});
        var _ct_ = setInterval(function() {
			var module = moduleCache["base.global"];
            if (module && module.state >= 2) {
				clearInterval(_ct_);
                panda.allReady();
            }
        }, 1);
    });
}());
define("base.array",[],function (require, exports, module) {
	var _obj = require("base.object");
	var _arr = require("base.array.class");
	
	var _index = require("base.array.index");
	var _indexOf = require("base.array.indexOf");
	var _lastIndexOf = require("base.array.lastIndexOf");
	var _insert = require("base.array.insert");
	var _map = require("base.array.map");
	var _some = require("base.array.some");
	var _unique = require("base.array.unique");
	var _remove = require("base.array.remove");
	var _each = require("base.array.each");
	
	_arr.__type__ = "panda.array";
	_arr = _obj.merge(_arr, _index);
	_arr = _obj.merge(_arr, _indexOf);
	_arr = _obj.merge(_arr, _lastIndexOf);
	_arr = _obj.merge(_arr, _insert);
	_arr = _obj.merge(_arr, _map);
	_arr = _obj.merge(_arr, _each);
	_arr = _obj.merge(_arr, _some);
	_arr = _obj.merge(_arr, _unique);
	_arr = _obj.merge(_arr, _remove);
	
	_arr.createArray = function(value) {
		var result = [];
		if(typeof value == 'object') {
			if(value.length != 'undefined') {
				for(var i=0;i<value.length;i++) {
					result.push(value[i]);
				}
			}
		}
		return _obj.merge(result, _arr);
	};
	
	panda = _obj.merge(panda, _arr);
	
	module.exports = _arr;
});
/**
 * Created with JetBrains WebStorm.
 * User: sunqingwei
 * Date: 13-4-11
 * Time: 上午9:22
 * To change this template use File | Settings | File Templates.
 */
define("base.dom",[],function (require, exports, module) {
    var _object = require("base.object"),
        _class = require("base.dom.class"),
        _style = require("base.dom.style"),
        _size = require("base.dom.size"),
        _attr = require("base.dom.attr"),
        _create = require("base.dom.create"),
        _traversal = require("base.dom.traversal"),
        _insertion = require("base.dom.insertion"),
		_position = require("base.dom.position"),
        _event = require("base.event.event"),
        _data = require("base.dom.data"),
        _animate = require("base.dom.animate");


    var DOM = {};
	DOM.__type__ = "panda.dom";
    DOM = _object.merge(DOM, _class);
    DOM = _object.merge(DOM, _size);
    DOM = _object.merge(DOM, _style);
    DOM = _object.merge(DOM, _attr);
    DOM = _object.merge(DOM, _create);
    DOM = _object.merge(DOM, _traversal);
    DOM = _object.merge(DOM, _insertion);
    DOM = _object.merge(DOM, _event);
	DOM = _object.merge(DOM, _position);
	DOM = _object.merge(DOM, _data);
	DOM = _object.merge(DOM, _animate);

    module.exports = DOM;
});
/**
 * 全局变量配置文件
 * User: lizihan
 * Date: 13-06-14
 * Time: 11:35
 */
//require("base.extension");
define("base.global",[],function(require,exports,module){
	require("base.array");
	require("base.dom");
	require("base.object");
	require("base.query");
	require("base.string");
	require("base.system");
	require("base.util");
	require("base.widget");
	
	panda.__type__ = 'panda.global';
	
	module.exports = {};
});
/**
 * User: sunqingwei
 * Date: 13-5-6
 * Time: 下午4:54
 */
/**
 * @namespace Core.object
 * @contructor
 */
define("base.object", [], function (require, exports, module) {
    var class2type = {},
        toString = class2type.toString,
        hasOwn = Object.prototype.hasOwnProperty;

    function isType(type) {
        return function (obj) {
            return Object.prototype.toString.call(obj) === "[object " + type + "]";
        };
    }

    var isObject = isType("Object");
    var isNumber = isType("Number");
    var isString = isType("String");
    var isArray = Array.isArray || isType("Array");
    var isFunction = isType("Function");

    function Empty() {
    }

    function isArraylike(obj) {
        var length = obj.length,
            type = panda.type(obj);

        if (panda.isWindow(obj)) {
            return false;
        }

        if (obj.nodeType === 1 && length) {
            return true;
        }

        return type === "array" || type !== "function" &&
            ( length === 0 ||
                typeof length === "number" && length > 0 && ( length - 1 ) in obj );
    }

    /**
     *主要批量扩展API
     */
    function interface(obj, callback, args) {
        var value,
            i = 0,
            isArray = panda.isArray(obj);

        if (args) {
            if (isArray) {
                for (; i < obj.length; i++) {
                    value = callback.apply(obj[ i ], args);

                    if (value === false) {
                        break;
                    }
                }
            } else {
                for (i in obj) {
                    value = callback.apply(obj[ i ], args);

                    if (value === false) {
                        break;
                    }
                }
            }

            // A special, fast, case for the most common use of each
        } else {
            if (isArray) {
                for (; i < obj.length; i++) {
                    value = callback.call(obj[ i ], i, obj[ i ]);

                    if (value === false) {
                        break;
                    }
                }
            } else {
                for (i in obj) {
                    value = callback.call(obj[ i ], i, obj[ i ]);

                    if (value === false) {
                        break;
                    }
                }
            }
        }

        return obj;
    };

    var _Object = {

        type: function (obj) {
            if (obj == null) {
                return String(obj);
            }
            return typeof obj === "object" || typeof obj === "function" ?
                class2type[ toString.call(obj) ] || "object" :
                typeof obj;
        },

        /**
         * 创建一个带构造函数的类，返回的函数在实例化时会自动调用initialize方法
         * @method create
         * @return {Function}
         * @example
         * 		var clazz = panda.object.create();
         * 		clazz.prototype.initialize = function() {console.log('its initialize');};
         * 		new clazz();
         * 		// ==> its initialize
         */
        create: function () {
            return function () {
                if (typeof this.initialize != "undefined")
                    this.initialize.apply(this, arguments);
            };
        },
        /**
         * 类与类之间的继承函数，该继承是基于prototype来实现
         * @method extend
         * @param {Function} subClass - 子类
         * @param {Function} superClass - 父类
         * @param {Object} px - 额外需要为子类添加的属性或方法
         * @return {Function}
         * @example
         * 		var result = panda.object.extend(function() {}, AnotherParentClass, {
         * 			spaceCount:function() {
         * 				return this.match(/\s/).length;
         * 			}
         * 		});	
         * 		var customString = new result("Prototype from AnotherParentClass");
         * 		customString.spaceCount();
         * 		// ==> 2
         */
        extend: function (subClass, superClass, px) {
            if (!superClass || !subClass) throw Error();
            var F = function () {
                if (superClass.apply)
                    superClass.apply(this);
            };
            F.prototype = superClass.prototype;
            subClass.prototype = new F();
            subClass.prototype.constructor = subClass;
            subClass.superclass = superClass.prototype;
            if (px) {
                for (var k in px) {
                    if (px.hasOwnProperty(k)) subClass.prototype[k] = px[k];
                }
            }
            return subClass;

        },

        /**
         * 将一个对象复制到另外一个新建的空对象上
         * @method copy 
         * @param {Object} source {} 待复制的源数据对象
         * @returns {Object}
         * @example
         * 		var result = panda.object.copy({'a':1});
         * 		// ==> Object {'a':1}
         */
        copy: function (source) {
            return module.exports.extend(new Empty(), source);
        },

        /**
         * 对两个对象进行合并操作，仅检测第一个参数是否提供了属性名，若提供，则会直接覆盖，若不提供，则使用默认属性
         * @method parameter
         * @param {Object} options - 待合并的参数值
         * @param {Object} defaults -  默认参数，options里未提供的属性则从这个参数里直接获取
         * @returns {Object}
         * @example
         * 		var option = panda.object.parameter({
         * 			'wd':'mobile'
         * 		}, {
         * 			'wd':'all',
         * 			'jid':'2014',
         * 			'type':'direct'
         * 		});
         * 		console.log(options);
         * 		// ==> Object {'wd':'mobile', 'jid':'2014', 'type':'direct'}
         */
        parameter: function (options, defaults) {
            var _o = options || {};
            var _defaults = defaults || {};
            for (var key in _defaults) {
                _o[key] = _o.hasOwnProperty(key) ? _o[key] : _defaults[key];
            }
            return _o;
        },

        /**
         * 合并两个对象，该合并为深度合并，会递归的对每一个复杂对象进行属性的对比
         * @method merge 
         * @param {Object} destination - 目标对象，最终会返回该目标对象
         * @param {Object} source - 源对象
         * @return {Object}
         * @example
         */
        merge: function (destination, source) {
            var _des = destination || {};
            if (isArray(destination) && isArray(source)) {
                _des = _des.concat(source);
            } else if (typeof _des == "object" || typeof _des == 'function') {
                for (var key in source) {
                    var val = source[key];
                    (typeof val == "object" && typeof _des[key] == "object") ? _des[key] = arguments.callee(_des[key], val) : _des[key] = val;
                }
            }
            return _des;
        },

        /**
         * 变更函数调用的作用域，并可传递相应的参数
         * @method bind 
         * @param {Function} func - 期待变更作用域的方法
         * @param {Object} scope - 变更后的方法作用域
         * @param {Object} args null 该参数为可选项，该参数将作为新函数的参数进行传递
         * @return {Function}
         * @example
         * 		panda.object.bind(requestAnimationFrame, window);
         */
        bind: function (func, scope, args) {
            try {
                var me = func;

                if (typeof args != 'array') {
                    args = [args];
                }

                return function () {
                    return me.apply(scope, args);
                };
            } catch (err) {

            }
        },

        /**
         * @_extend 对数组注册函数
         * @param nodeList
         * @param obj
         * @returns {*|Array}
         * @private
         */
        _extend: function (nodeList, obj, preScope) { // TODO
            var list = nodeList || [];
            for (var key in obj) {
                list[key] = obj[key];
                list.prevObject = preScope;
            }
            for (var key in panda.EXTEND_OBJECT_POOL) {
                list[key] = panda.EXTEND_OBJECT_POOL[key];
            }
            list.each = function (func) {
                for (var i = 0; i < this.length; i++) {
                    func(this[i], i);
                }
            };
            return list;
        },
        makeArray: function (list) {
            var rtn = [];
            if (!list) return rtn;
            var len = list.length;
            for (var i = 0; i < len; i++) {
                rtn.push(list[i]);
            }
            return rtn;
        },
        /**
         * 判断是否为对象
         * @method isObject
         * @param {Object} target - 待判断的数据
         * @return {Boolean}
         * @example
         * 		panda.object.isObject({});
         * 		// ==> true
         */
        isObject: isObject,
        /**
         * 判断是否为string
         * @method isString
         * @param {Object} target - 待判断的数据
         * @return {Boolean}
         * @example
         * 		panda.object.isString("");
         * 		// ==> true
         */
        isString: isString,
         /**
         * 判断是否为number
         * @method isNumber
         * @param {Object} target - 待判断的数据
         * @return {Boolean}
         * @example
         * 		panda.object.isNumber(0);
         * 		// ==> true
         */
        isNumber: isNumber,
        /**
         * 判断是否为数组、
         * @method isArray
         * @param {Object} target - 待判断的数据
         * @return {Boolean}
         * @example
         * 		panda.object.isArray([]);
         * 		// ==> true
         */
        isArray: isArray,
        /**
         * 判断是否为function
         * @method isFunction
         * @param {Object} target - 待判断的数据
         * @return {Boolean}
         * @example
         * 		panda.object.isFunction({});
         * 		// ==> false
         */
        isFunction: isFunction,
        /**
         * 判断是否为一个简单对象，例如Object
         * @pc
         * @method isPlainObject
         * @param {Object} - 待判断的数据
         * @return {Boolean}
         * @example
         * 		panda.object.isPlainObject({});
         * 		// ==> true
         */
        isPlainObject: function (obj) {
            if (!obj || this.isObject(obj) || obj.nodeType || this.isWindow(obj)) {
                return false;
            }
            try {
                if (obj.constructor && !hasOwn.call(obj, "constructor") && !hasOwn.call(obj.constructor.prototype, "isPrototypeOf")) {
                    return false;
                }
            } catch (e) {
                return false;
            }

            var key;
            for (key in obj) {
            }

            return key === undefined || hasOwn.call(obj, key);
        },
        /**
         * 判断是否为window对象
         * @method isWindow
         * @param {Object} target - 待判断的数据
         * @return {Boolean}
         * @example
         * 		panda.object.isWindow(window);
         * 		// ==> true
         */
        isWindow: function (obj) {
            return obj != null && obj == obj.window;
        },
        /**
         * 判断是否为一个空对象
         * @method isEmptyObject
         * @param {Object} target - 待判断的数据
         * @return {Boolean}
         * @example
         * 		panda.object.isEmptyObject({'a':1});
         * 		// ==> false
         */
        isEmptyObject: function (obj) {
            for (var name in obj) {
                return false;
            }
            return true;
        },
        // merge from jshop-branch
        interface_extend: function (obj, names, fun) {
            if (obj) {
                if (panda.isArray(names)) {
                    for (var i = 0; i < names.length; i++) {
                        obj[names[i]] = fun();
                    }
                }
            }
        },
        interface: interface
    };

    panda = _Object.merge(panda, _Object);

    module.exports = _Object;
})
;
define("base.query", [], function(require) {
	var obj = require("base.object");
	var i,
		support,
		cachedruns,
		Expr,
		getText,
		isXML,
		compile,
		outermostContext,
		sortInput,
	
		setDocument,
		document,
		docElem,
		documentIsHTML,
		rbuggyQSA,
		rbuggyMatches,
		matches,
		contains,
	
		expando = "sizzle" + -(new Date()),
		preferredDoc = window.document,
		dirruns = 0,
		done = 0,
		classCache = createCache(),
		tokenCache = createCache(),
		compilerCache = createCache(),
		hasDuplicate = false,
		sortOrder = function( a, b ) {
			if ( a === b ) {
				hasDuplicate = true;
				return 0;
			}
			return 0;
		},
	
		strundefined = typeof undefined,
		MAX_NEGATIVE = 1 << 31,
	
		hasOwn = ({}).hasOwnProperty,
		arr = [],
		pop = arr.pop,
		push_native = arr.push,
		push = arr.push,
		slice = arr.slice,
		indexOf = arr.indexOf || function( elem ) {
			var i = 0,
				len = this.length;
			for ( ; i < len; i++ ) {
				if ( this[i] === elem ) {
					return i;
				}
			}
			return -1;
		},
	
		booleans = "checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",
	
		whitespace = "[\\x20\\t\\r\\n\\f]",
		characterEncoding = "(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",
	
		identifier = characterEncoding.replace( "w", "w#" ),
	
		attributes = "\\[" + whitespace + "*(" + characterEncoding + ")" + whitespace +
			"*(?:([*^$|!~]?=)" + whitespace + "*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|(" + identifier + ")|)|)" + whitespace + "*\\]",
	
		pseudos = ":(" + characterEncoding + ")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|" + attributes.replace( 3, 8 ) + ")*)|.*)\\)|)",
	
		rtrim = new RegExp( "^" + whitespace + "+|((?:^|[^\\\\])(?:\\\\.)*)" + whitespace + "+$", "g" ),
	
		rcomma = new RegExp( "^" + whitespace + "*," + whitespace + "*" ),
		rcombinators = new RegExp( "^" + whitespace + "*([>+~]|" + whitespace + ")" + whitespace + "*" ),
	
		rsibling = new RegExp( whitespace + "*[+~]" ),
		rattributeQuotes = new RegExp( "=" + whitespace + "*([^\\]'\"]*)" + whitespace + "*\\]", "g" ),
	
		rpseudo = new RegExp( pseudos ),
		ridentifier = new RegExp( "^" + identifier + "$" ),
	
		matchExpr = {
			"ID": new RegExp( "^#(" + characterEncoding + ")" ),
			"CLASS": new RegExp( "^\\.(" + characterEncoding + ")" ),
			"TAG": new RegExp( "^(" + characterEncoding.replace( "w", "w*" ) + ")" ),
			"ATTR": new RegExp( "^" + attributes ),
			"PSEUDO": new RegExp( "^" + pseudos ),
			"CHILD": new RegExp( "^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(" + whitespace +
				"*(even|odd|(([+-]|)(\\d*)n|)" + whitespace + "*(?:([+-]|)" + whitespace +
				"*(\\d+)|))" + whitespace + "*\\)|)", "i" ),
			"bool": new RegExp( "^(?:" + booleans + ")$", "i" ),
			"needsContext": new RegExp( "^" + whitespace + "*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(" +
				whitespace + "*((?:-\\d)?\\d*)" + whitespace + "*\\)|)(?=[^-]|$)", "i" )
		},
	
		rnative = /^[^{]+\{\s*\[native \w/,
	
		rquickExpr = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,
	
		rinputs = /^(?:input|select|textarea|button)$/i,
		rheader = /^h\d$/i,
	
		rescape = /'|\\/g,
	
		runescape = new RegExp( "\\\\([\\da-f]{1,6}" + whitespace + "?|(" + whitespace + ")|.)", "ig" ),
		funescape = function( _, escaped, escapedWhitespace ) {
			var high = "0x" + escaped - 0x10000;
			return high !== high || escapedWhitespace ?
				escaped :
				high < 0 ?
					String.fromCharCode( high + 0x10000 ) :
					String.fromCharCode( high >> 10 | 0xD800, high & 0x3FF | 0xDC00 );
		};
	
	try {
		push.apply(
			(arr = slice.call( preferredDoc.childNodes )),
			preferredDoc.childNodes
		);
		arr[ preferredDoc.childNodes.length ].nodeType;
	} catch ( e ) {
		push = { apply: arr.length ?
	
			function( target, els ) {
				push_native.apply( target, slice.call(els) );
			} :
	
			function( target, els ) {
				var j = target.length,
					i = 0;
				while ( (target[j++] = els[i++]) ) {}
				target.length = j - 1;
			}
		};
	}
	
	function Sizzle( selector, context, results, seed ) {
		var _dom = require("base.dom");
		var match, elem, m, nodeType,
			i, groups, old, nid, newContext, newSelector;
	
		if(typeof context == 'string' && context != '') {
			context = Sizzle(context);
		}
		if ( ( context ? context.ownerDocument || context : preferredDoc ) !== document ) {
			if(context && context.__type__ == 'panda.dom') {
				context = context[0];
			}
			setDocument( context );
		}
	
		context = context || document;
		results = results || [];
	
		if (selector === null) {
            return obj._extend([], _dom);
        }
        if (typeof selector == "function") {
            if (selector.__INSTANCE__) {
                return selector;
            }
            _event.EventDispacther.call(selector);
            return Sizzle(selector());
        }
        if (typeof selector == "string") {
            if (selector == "window") {
                selector = window;
            }
            if (selector == "body") {
                selector = document.body;
            }
            if (selector == "document") {
                selector = document;
            }
        }
        if (typeof (selector) == "object") {
            if (selector && selector.__type__ == "panda.dom") {
                return selector;
            }
            if (selector == window || selector == document || (document && selector == document.body)) {
                return obj._extend([selector], _dom);
            }
            if (selector.getAttribute) {
                return obj._extend([selector], _dom);
            }
            return obj._extend((typeof selector == 'array') ? selector : [selector], _dom);
        }
        if (typeof selector == 'undefined') {
            return obj._extend([], _dom);
        }
        if(typeof selector == 'string' && selector.charAt(0) == '<' && selector.charAt(selector.length-1) == '>' && selector.length >= 3) {
			return _dom.create(selector);
		}
	
		if ( (nodeType = context.nodeType) !== 1 && nodeType !== 9 ) {
			return obj._extend([], _dom);
		}
	
		if ( documentIsHTML && !seed ) {
	
			if ( (match = rquickExpr.exec( selector )) ) {
				if ( (m = match[1]) ) {
					if ( nodeType === 9 ) {
						elem = context.getElementById( m );
						if ( elem && elem.parentNode ) {
							if ( elem.id === m ) {
								results.push( elem );
								return obj._extend(results, _dom);
							}
						} else {
							return obj._extend(results, _dom);
						}
					} else {
						if ( context.ownerDocument && (elem = context.ownerDocument.getElementById( m )) &&
							contains( context, elem ) && elem.id === m ) {
							results.push( elem );
							return obj._extend(results, _dom);
						}
					}
	
				} else if ( match[2] ) {
					push.apply( results, context.getElementsByTagName( selector ) );
					return obj._extend(results, _dom);
	
				} else if ( (m = match[3]) && support.getElementsByClassName && context.getElementsByClassName ) {
					push.apply( results, context.getElementsByClassName( m ) );
					return obj._extend(results, _dom);
				}
			}
	
			if ( support.qsa && (!rbuggyQSA || !rbuggyQSA.test( selector )) ) {
				nid = old = expando;
				newContext = context;
				newSelector = nodeType === 9 && selector;
	
				if ( nodeType === 1 && context.nodeName.toLowerCase() !== "object" ) {
					groups = tokenize( selector );
	
					if ( (old = context.getAttribute("id")) ) {
						nid = old.replace( rescape, "\\$&" );
					} else {
						context.setAttribute( "id", nid );
					}
					nid = "[id='" + nid + "'] ";
	
					i = groups.length;
					while ( i-- ) {
						groups[i] = nid + toSelector( groups[i] );
					}
					newContext = rsibling.test( selector ) && context.parentNode || context;
					newSelector = groups.join(",");
				}
	
				if ( newSelector ) {
					try {
						push.apply( results,
							newContext.querySelectorAll( newSelector )
						);
						return obj._extend(results, _dom);
					} catch(qsaError) {
					} finally {
						if ( !old ) {
							context.removeAttribute("id");
						}
					}
				}
			}
		}
	
		return obj._extend(select( selector.replace( rtrim, "$1" ), context, results, seed ), _dom);
	}
	
	/**
	 * Create key-value caches of limited size
	 * @returns {Function(string, Object)} Returns the Object data after storing it on itself with
	 *	property name the (space-suffixed) string and (if the cache is larger than Expr.cacheLength)
	 *	deleting the oldest entry
	 */
	function createCache() {
		var keys = [];
	
		function cache( key, value ) {
			if ( keys.push( key += " " ) > Expr.cacheLength ) {
				delete cache[ keys.shift() ];
			}
			return (cache[ key ] = value);
		}
		return cache;
	}
	
	/**
	 * Mark a function for special use by Sizzle
	 * @param {Function} fn The function to mark
	 */
	function markFunction( fn ) {
		fn[ expando ] = true;
		return fn;
	}
	
	/**
	 * Support testing using an element
	 * @param {Function} fn Passed the created div and expects a boolean result
	 */
	function assert( fn ) {
		var div = document.createElement("div");
	
		try {
			return !!fn( div );
		} catch (e) {
			return false;
		} finally {
			if ( div.parentNode ) {
				div.parentNode.removeChild( div );
			}
			div = null;
		}
	}
	
	/**
	 * Adds the same handler for all of the specified attrs
	 * @param {String} attrs Pipe-separated list of attributes
	 * @param {Function} handler The method that will be applied
	 */
	function addHandle( attrs, handler ) {
		var arr = attrs.split("|"),
			i = attrs.length;
	
		while ( i-- ) {
			Expr.attrHandle[ arr[i] ] = handler;
		}
	}
	
	/**
	 * Checks document order of two siblings
	 * @param {Element} a
	 * @param {Element} b
	 * @returns {Number} Returns less than 0 if a precedes b, greater than 0 if a follows b
	 */
	function siblingCheck( a, b ) {
		var cur = b && a,
			diff = cur && a.nodeType === 1 && b.nodeType === 1 &&
				( ~b.sourceIndex || MAX_NEGATIVE ) -
				( ~a.sourceIndex || MAX_NEGATIVE );
	
		if ( diff ) {
			return diff;
		}
	
		if ( cur ) {
			while ( (cur = cur.nextSibling) ) {
				if ( cur === b ) {
					return -1;
				}
			}
		}
	
		return a ? 1 : -1;
	}
	
	/**
	 * Returns a function to use in pseudos for input types
	 * @param {String} type
	 */
	function createInputPseudo( type ) {
		return function( elem ) {
			var name = elem.nodeName.toLowerCase();
			return name === "input" && elem.type === type;
		};
	}
	
	/**
	 * Returns a function to use in pseudos for buttons
	 * @param {String} type
	 */
	function createButtonPseudo( type ) {
		return function( elem ) {
			var name = elem.nodeName.toLowerCase();
			return (name === "input" || name === "button") && elem.type === type;
		};
	}
	
	/**
	 * Returns a function to use in pseudos for positionals
	 * @param {Function} fn
	 */
	function createPositionalPseudo( fn ) {
		return markFunction(function( argument ) {
			argument = +argument;
			return markFunction(function( seed, matches ) {
				var j,
					matchIndexes = fn( [], seed.length, argument ),
					i = matchIndexes.length;
	
				while ( i-- ) {
					if ( seed[ (j = matchIndexes[i]) ] ) {
						seed[j] = !(matches[j] = seed[j]);
					}
				}
			});
		});
	}
	
	/**
	 * Detect xml
	 * @param {Element|Object} elem An element or a document
	 */
	isXML = Sizzle.isXML = function( elem ) {
		var documentElement = elem && (elem.ownerDocument || elem).documentElement;
		return documentElement ? documentElement.nodeName !== "HTML" : false;
	};
	
	support = Sizzle.support = {};
	
	/**
	 * Sets document-related variables once based on the current document
	 * @param {Element|Object} [doc] An element or document object to use to set the document
	 * @returns {Object} Returns the current document
	 */
	setDocument = Sizzle.setDocument = function( node ) {
		var doc = node ? node.ownerDocument || node : preferredDoc,
			parent = doc.defaultView;
	
		if ( doc === document || doc.nodeType !== 9 || !doc.documentElement ) {
			return document;
		}
	
		document = doc;
		docElem = doc.documentElement;
	
		documentIsHTML = !isXML( doc );
	
		if ( parent && parent.attachEvent && parent !== parent.top ) {
			parent.attachEvent( "onbeforeunload", function() {
				setDocument();
			});
		}
	
		support.attributes = assert(function( div ) {
			div.className = "i";
			return !div.getAttribute("className");
		});
	
		support.getElementsByTagName = assert(function( div ) {
			div.appendChild( doc.createComment("") );
			return !div.getElementsByTagName("*").length;
		});
	
		support.getElementsByClassName = assert(function( div ) {
			div.innerHTML = "<div class='a'></div><div class='a i'></div>";
	
			div.firstChild.className = "i";
			return div.getElementsByClassName("i").length === 2;
		});
	
		support.getById = assert(function( div ) {
			docElem.appendChild( div ).id = expando;
			return !doc.getElementsByName || !doc.getElementsByName( expando ).length;
		});
	
		if ( support.getById ) {
			Expr.find["ID"] = function( id, context ) {
				if ( typeof context.getElementById !== strundefined && documentIsHTML ) {
					var m = context.getElementById( id );
					return m && m.parentNode ? [m] : [];
				}
			};
			Expr.filter["ID"] = function( id ) {
				var attrId = id.replace( runescape, funescape );
				return function( elem ) {
					return elem.getAttribute("id") === attrId;
				};
			};
		} else {
			delete Expr.find["ID"];
	
			Expr.filter["ID"] =  function( id ) {
				var attrId = id.replace( runescape, funescape );
				return function( elem ) {
					var node = typeof elem.getAttributeNode !== strundefined && elem.getAttributeNode("id");
					return node && node.value === attrId;
				};
			};
		}
	
		Expr.find["TAG"] = support.getElementsByTagName ?
			function( tag, context ) {
				if ( typeof context.getElementsByTagName !== strundefined ) {
					return context.getElementsByTagName( tag );
				}
			} :
			function( tag, context ) {
				var elem,
					tmp = [],
					i = 0,
					results = context.getElementsByTagName( tag );
	
				if ( tag === "*" ) {
					while ( (elem = results[i++]) ) {
						if ( elem.nodeType === 1 ) {
							tmp.push( elem );
						}
					}
	
					return tmp;
				}
				return results;
			};
	
		Expr.find["CLASS"] = support.getElementsByClassName && function( className, context ) {
			if ( typeof context.getElementsByClassName !== strundefined && documentIsHTML ) {
				return context.getElementsByClassName( className );
			}
		};
	
		/* QSA/matchesSelector
		---------------------------------------------------------------------- */
	
		rbuggyMatches = [];
	
		rbuggyQSA = [];
	
		if ( (support.qsa = rnative.test( doc.querySelectorAll )) ) {
			assert(function( div ) {
				div.innerHTML = "<select><option selected=''></option></select>";
	
				if ( !div.querySelectorAll("[selected]").length ) {
					rbuggyQSA.push( "\\[" + whitespace + "*(?:value|" + booleans + ")" );
				}
	
				if ( !div.querySelectorAll(":checked").length ) {
					rbuggyQSA.push(":checked");
				}
			});
	
			assert(function( div ) {
	
				var input = doc.createElement("input");
				input.setAttribute( "type", "hidden" );
				div.appendChild( input ).setAttribute( "t", "" );
	
				if ( div.querySelectorAll("[t^='']").length ) {
					rbuggyQSA.push( "[*^$]=" + whitespace + "*(?:''|\"\")" );
				}
	
				if ( !div.querySelectorAll(":enabled").length ) {
					rbuggyQSA.push( ":enabled", ":disabled" );
				}
	
				div.querySelectorAll("*,:x");
				rbuggyQSA.push(",.*:");
			});
		}
	
		if ( (support.matchesSelector = rnative.test( (matches = docElem.webkitMatchesSelector ||
			docElem.mozMatchesSelector ||
			docElem.oMatchesSelector ||
			docElem.msMatchesSelector) )) ) {
	
			assert(function( div ) {
				support.disconnectedMatch = matches.call( div, "div" );
	
				matches.call( div, "[s!='']:x" );
				rbuggyMatches.push( "!=", pseudos );
			});
		}
	
		rbuggyQSA = rbuggyQSA.length && new RegExp( rbuggyQSA.join("|") );
		rbuggyMatches = rbuggyMatches.length && new RegExp( rbuggyMatches.join("|") );
	
		/* Contains
		---------------------------------------------------------------------- */
	
		contains = rnative.test( docElem.contains ) || docElem.compareDocumentPosition ?
			function( a, b ) {
				var adown = a.nodeType === 9 ? a.documentElement : a,
					bup = b && b.parentNode;
				return a === bup || !!( bup && bup.nodeType === 1 && (
					adown.contains ?
						adown.contains( bup ) :
						a.compareDocumentPosition && a.compareDocumentPosition( bup ) & 16
				));
			} :
			function( a, b ) {
				if ( b ) {
					while ( (b = b.parentNode) ) {
						if ( b === a ) {
							return true;
						}
					}
				}
				return false;
			};
	
		sortOrder = docElem.compareDocumentPosition ?
		function( a, b ) {
	
			if ( a === b ) {
				hasDuplicate = true;
				return 0;
			}
	
			var compare = b.compareDocumentPosition && a.compareDocumentPosition && a.compareDocumentPosition( b );
	
			if ( compare ) {
				if ( compare & 1 ||
					(!support.sortDetached && b.compareDocumentPosition( a ) === compare) ) {
	
					if ( a === doc || contains(preferredDoc, a) ) {
						return -1;
					}
					if ( b === doc || contains(preferredDoc, b) ) {
						return 1;
					}
	
					return sortInput ?
						( indexOf.call( sortInput, a ) - indexOf.call( sortInput, b ) ) :
						0;
				}
	
				return compare & 4 ? -1 : 1;
			}
	
			return a.compareDocumentPosition ? -1 : 1;
		} :
		function( a, b ) {
			var cur,
				i = 0,
				aup = a.parentNode,
				bup = b.parentNode,
				ap = [ a ],
				bp = [ b ];
	
			if ( a === b ) {
				hasDuplicate = true;
				return 0;
	
			} else if ( !aup || !bup ) {
				return a === doc ? -1 :
					b === doc ? 1 :
					aup ? -1 :
					bup ? 1 :
					sortInput ?
					( indexOf.call( sortInput, a ) - indexOf.call( sortInput, b ) ) :
					0;
	
			} else if ( aup === bup ) {
				return siblingCheck( a, b );
			}
	
			cur = a;
			while ( (cur = cur.parentNode) ) {
				ap.unshift( cur );
			}
			cur = b;
			while ( (cur = cur.parentNode) ) {
				bp.unshift( cur );
			}
	
			while ( ap[i] === bp[i] ) {
				i++;
			}
	
			return i ?
				siblingCheck( ap[i], bp[i] ) :
	
				ap[i] === preferredDoc ? -1 :
				bp[i] === preferredDoc ? 1 :
				0;
		};
	
		return doc;
	};
	
	Sizzle.matches = function( expr, elements ) {
		return Sizzle( expr, null, null, elements );
	};
	
	Sizzle.matchesSelector = function( elem, expr ) {
		if ( ( elem.ownerDocument || elem ) !== document ) {
			setDocument( elem );
		}
	
		expr = expr.replace( rattributeQuotes, "='$1']" );
	
		if ( support.matchesSelector && documentIsHTML &&
			( !rbuggyMatches || !rbuggyMatches.test( expr ) ) &&
			( !rbuggyQSA     || !rbuggyQSA.test( expr ) ) ) {
	
			try {
				var ret = matches.call( elem, expr );
	
				if ( ret || support.disconnectedMatch ||
						elem.document && elem.document.nodeType !== 11 ) {
					return ret;
				}
			} catch(e) {}
		}
	
		return Sizzle( expr, document, null, [elem] ).length > 0;
	};
	
	Sizzle.contains = function( context, elem ) {
		if ( ( context.ownerDocument || context ) !== document ) {
			setDocument( context );
		}
		return contains( context, elem );
	};
	
	Sizzle.attr = function( elem, name ) {
		if ( ( elem.ownerDocument || elem ) !== document ) {
			setDocument( elem );
		}
	
		var fn = Expr.attrHandle[ name.toLowerCase() ],
			val = fn && hasOwn.call( Expr.attrHandle, name.toLowerCase() ) ?
				fn( elem, name, !documentIsHTML ) :
				undefined;
	
		return val === undefined ?
			support.attributes || !documentIsHTML ?
				elem.getAttribute( name ) :
				(val = elem.getAttributeNode(name)) && val.specified ?
					val.value :
					null :
			val;
	};
	
	Sizzle.error = function( msg ) {
		throw new Error( "Syntax error, unrecognized expression: " + msg );
	};
	
	/**
	 * Document sorting and removing duplicates
	 * @param {ArrayLike} results
	 */
	Sizzle.uniqueSort = function( results ) {
		var elem,
			duplicates = [],
			j = 0,
			i = 0;
	
		hasDuplicate = !support.detectDuplicates;
		sortInput = !support.sortStable && results.slice( 0 );
		results.sort( sortOrder );
	
		if ( hasDuplicate ) {
			while ( (elem = results[i++]) ) {
				if ( elem === results[ i ] ) {
					j = duplicates.push( i );
				}
			}
			while ( j-- ) {
				results.splice( duplicates[ j ], 1 );
			}
		}
	
		return results;
	};
	
	/**
	 * Utility function for retrieving the text value of an array of DOM nodes
	 * @param {Array|Element} elem
	 */
	getText = Sizzle.getText = function( elem ) {
		var node,
			ret = "",
			i = 0,
			nodeType = elem.nodeType;
	
		if ( !nodeType ) {
			for ( ; (node = elem[i]); i++ ) {
				ret += getText( node );
			}
		} else if ( nodeType === 1 || nodeType === 9 || nodeType === 11 ) {
			if ( typeof elem.textContent === "string" ) {
				return elem.textContent;
			} else {
				for ( elem = elem.firstChild; elem; elem = elem.nextSibling ) {
					ret += getText( elem );
				}
			}
		} else if ( nodeType === 3 || nodeType === 4 ) {
			return elem.nodeValue;
		}
	
		return ret;
	};
	
	Expr = Sizzle.selectors = {
	
		cacheLength: 50,
	
		createPseudo: markFunction,
	
		match: matchExpr,
	
		attrHandle: {},
	
		find: {},
	
		relative: {
			">": { dir: "parentNode", first: true },
			" ": { dir: "parentNode" },
			"+": { dir: "previousSibling", first: true },
			"~": { dir: "previousSibling" }
		},
	
		preFilter: {
			"ATTR": function( match ) {
				match[1] = match[1].replace( runescape, funescape );
	
				match[3] = ( match[4] || match[5] || "" ).replace( runescape, funescape );
	
				if ( match[2] === "~=" ) {
					match[3] = " " + match[3] + " ";
				}
	
				return match.slice( 0, 4 );
			},
	
			"CHILD": function( match ) {
				match[1] = match[1].toLowerCase();
	
				if ( match[1].slice( 0, 3 ) === "nth" ) {
					if ( !match[3] ) {
						Sizzle.error( match[0] );
					}
	
					match[4] = +( match[4] ? match[5] + (match[6] || 1) : 2 * ( match[3] === "even" || match[3] === "odd" ) );
					match[5] = +( ( match[7] + match[8] ) || match[3] === "odd" );
	
				} else if ( match[3] ) {
					Sizzle.error( match[0] );
				}
	
				return match;
			},
	
			"PSEUDO": function( match ) {
				var excess,
					unquoted = !match[5] && match[2];
	
				if ( matchExpr["CHILD"].test( match[0] ) ) {
					return null;
				}
	
				if ( match[3] && match[4] !== undefined ) {
					match[2] = match[4];
	
				} else if ( unquoted && rpseudo.test( unquoted ) &&
					(excess = tokenize( unquoted, true )) &&
					(excess = unquoted.indexOf( ")", unquoted.length - excess ) - unquoted.length) ) {
	
					match[0] = match[0].slice( 0, excess );
					match[2] = unquoted.slice( 0, excess );
				}
	
				return match.slice( 0, 3 );
			}
		},
	
		filter: {
	
			"TAG": function( nodeNameSelector ) {
				var nodeName = nodeNameSelector.replace( runescape, funescape ).toLowerCase();
				return nodeNameSelector === "*" ?
					function() { return true; } :
					function( elem ) {
						return elem.nodeName && elem.nodeName.toLowerCase() === nodeName;
					};
			},
	
			"CLASS": function( className ) {
				var pattern = classCache[ className + " " ];
	
				return pattern ||
					(pattern = new RegExp( "(^|" + whitespace + ")" + className + "(" + whitespace + "|$)" )) &&
					classCache( className, function( elem ) {
						return pattern.test( typeof elem.className === "string" && elem.className || typeof elem.getAttribute !== strundefined && elem.getAttribute("class") || "" );
					});
			},
	
			"ATTR": function( name, operator, check ) {
				return function( elem ) {
					var result = Sizzle.attr( elem, name );
	
					if ( result == null ) {
						return operator === "!=";
					}
					if ( !operator ) {
						return true;
					}
	
					result += "";
	
					return operator === "=" ? result === check :
						operator === "!=" ? result !== check :
						operator === "^=" ? check && result.indexOf( check ) === 0 :
						operator === "*=" ? check && result.indexOf( check ) > -1 :
						operator === "$=" ? check && result.slice( -check.length ) === check :
						operator === "~=" ? ( " " + result + " " ).indexOf( check ) > -1 :
						operator === "|=" ? result === check || result.slice( 0, check.length + 1 ) === check + "-" :
						false;
				};
			},
	
			"CHILD": function( type, what, argument, first, last ) {
				var simple = type.slice( 0, 3 ) !== "nth",
					forward = type.slice( -4 ) !== "last",
					ofType = what === "of-type";
	
				return first === 1 && last === 0 ?
	
					function( elem ) {
						return !!elem.parentNode;
					} :
	
					function( elem, context, xml ) {
						var cache, outerCache, node, diff, nodeIndex, start,
							dir = simple !== forward ? "nextSibling" : "previousSibling",
							parent = elem.parentNode,
							name = ofType && elem.nodeName.toLowerCase(),
							useCache = !xml && !ofType;
	
						if ( parent ) {
	
							if ( simple ) {
								while ( dir ) {
									node = elem;
									while ( (node = node[ dir ]) ) {
										if ( ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1 ) {
											return false;
										}
									}
									start = dir = type === "only" && !start && "nextSibling";
								}
								return true;
							}
	
							start = [ forward ? parent.firstChild : parent.lastChild ];
	
							if ( forward && useCache ) {
								outerCache = parent[ expando ] || (parent[ expando ] = {});
								cache = outerCache[ type ] || [];
								nodeIndex = cache[0] === dirruns && cache[1];
								diff = cache[0] === dirruns && cache[2];
								node = nodeIndex && parent.childNodes[ nodeIndex ];
	
								while ( (node = ++nodeIndex && node && node[ dir ] ||
	
									(diff = nodeIndex = 0) || start.pop()) ) {
	
									if ( node.nodeType === 1 && ++diff && node === elem ) {
										outerCache[ type ] = [ dirruns, nodeIndex, diff ];
										break;
									}
								}
	
							} else if ( useCache && (cache = (elem[ expando ] || (elem[ expando ] = {}))[ type ]) && cache[0] === dirruns ) {
								diff = cache[1];
	
							} else {
								while ( (node = ++nodeIndex && node && node[ dir ] ||
									(diff = nodeIndex = 0) || start.pop()) ) {
	
									if ( ( ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1 ) && ++diff ) {
										if ( useCache ) {
											(node[ expando ] || (node[ expando ] = {}))[ type ] = [ dirruns, diff ];
										}
	
										if ( node === elem ) {
											break;
										}
									}
								}
							}
	
							diff -= last;
							return diff === first || ( diff % first === 0 && diff / first >= 0 );
						}
					};
			},
	
			"PSEUDO": function( pseudo, argument ) {
				var args,
					fn = Expr.pseudos[ pseudo ] || Expr.setFilters[ pseudo.toLowerCase() ] ||
						Sizzle.error( "unsupported pseudo: " + pseudo );
	
				if ( fn[ expando ] ) {
					return fn( argument );
				}
	
				if ( fn.length > 1 ) {
					args = [ pseudo, pseudo, "", argument ];
					return Expr.setFilters.hasOwnProperty( pseudo.toLowerCase() ) ?
						markFunction(function( seed, matches ) {
							var idx,
								matched = fn( seed, argument ),
								i = matched.length;
							while ( i-- ) {
								idx = indexOf.call( seed, matched[i] );
								seed[ idx ] = !( matches[ idx ] = matched[i] );
							}
						}) :
						function( elem ) {
							return fn( elem, 0, args );
						};
				}
	
				return fn;
			}
		},
	
		pseudos: {
			"not": markFunction(function( selector ) {
				var input = [],
					results = [],
					matcher = compile( selector.replace( rtrim, "$1" ) );
	
				return matcher[ expando ] ?
					markFunction(function( seed, matches, context, xml ) {
						var elem,
							unmatched = matcher( seed, null, xml, [] ),
							i = seed.length;
	
						while ( i-- ) {
							if ( (elem = unmatched[i]) ) {
								seed[i] = !(matches[i] = elem);
							}
						}
					}) :
					function( elem, context, xml ) {
						input[0] = elem;
						matcher( input, null, xml, results );
						return !results.pop();
					};
			}),
	
			"has": markFunction(function( selector ) {
				return function( elem ) {
					return Sizzle( selector, elem ).length > 0;
				};
			}),
	
			"contains": markFunction(function( text ) {
				return function( elem ) {
					return ( elem.textContent || elem.innerText || getText( elem ) ).indexOf( text ) > -1;
				};
			}),
	
			"lang": markFunction( function( lang ) {
				if ( !ridentifier.test(lang || "") ) {
					Sizzle.error( "unsupported lang: " + lang );
				}
				lang = lang.replace( runescape, funescape ).toLowerCase();
				return function( elem ) {
					var elemLang;
					do {
						if ( (elemLang = documentIsHTML ?
							elem.lang :
							elem.getAttribute("xml:lang") || elem.getAttribute("lang")) ) {
	
							elemLang = elemLang.toLowerCase();
							return elemLang === lang || elemLang.indexOf( lang + "-" ) === 0;
						}
					} while ( (elem = elem.parentNode) && elem.nodeType === 1 );
					return false;
				};
			}),
	
			"target": function( elem ) {
				var hash = window.location && window.location.hash;
				return hash && hash.slice( 1 ) === elem.id;
			},
	
			"root": function( elem ) {
				return elem === docElem;
			},
	
			"focus": function( elem ) {
				return elem === document.activeElement && (!document.hasFocus || document.hasFocus()) && !!(elem.type || elem.href || ~elem.tabIndex);
			},
	
			"enabled": function( elem ) {
				return elem.disabled === false;
			},
	
			"disabled": function( elem ) {
				return elem.disabled === true;
			},
	
			"checked": function( elem ) {
				var nodeName = elem.nodeName.toLowerCase();
				return (nodeName === "input" && !!elem.checked) || (nodeName === "option" && !!elem.selected);
			},
	
			"selected": function( elem ) {
				if ( elem.parentNode ) {
					elem.parentNode.selectedIndex;
				}
	
				return elem.selected === true;
			},
	
			"empty": function( elem ) {
				for ( elem = elem.firstChild; elem; elem = elem.nextSibling ) {
					if ( elem.nodeName > "@" || elem.nodeType === 3 || elem.nodeType === 4 ) {
						return false;
					}
				}
				return true;
			},
	
			"parent": function( elem ) {
				return !Expr.pseudos["empty"]( elem );
			},
	
			"header": function( elem ) {
				return rheader.test( elem.nodeName );
			},
	
			"input": function( elem ) {
				return rinputs.test( elem.nodeName );
			},
	
			"button": function( elem ) {
				var name = elem.nodeName.toLowerCase();
				return name === "input" && elem.type === "button" || name === "button";
			},
	
			"text": function( elem ) {
				var attr;
				return elem.nodeName.toLowerCase() === "input" &&
					elem.type === "text" &&
					( (attr = elem.getAttribute("type")) == null || attr.toLowerCase() === elem.type );
			},
	
			"first": createPositionalPseudo(function() {
				return [ 0 ];
			}),
	
			"last": createPositionalPseudo(function( matchIndexes, length ) {
				return [ length - 1 ];
			}),
	
			"eq": createPositionalPseudo(function( matchIndexes, length, argument ) {
				return [ argument < 0 ? argument + length : argument ];
			}),
	
			"even": createPositionalPseudo(function( matchIndexes, length ) {
				var i = 0;
				for ( ; i < length; i += 2 ) {
					matchIndexes.push( i );
				}
				return matchIndexes;
			}),
	
			"odd": createPositionalPseudo(function( matchIndexes, length ) {
				var i = 1;
				for ( ; i < length; i += 2 ) {
					matchIndexes.push( i );
				}
				return matchIndexes;
			}),
	
			"lt": createPositionalPseudo(function( matchIndexes, length, argument ) {
				var i = argument < 0 ? argument + length : argument;
				for ( ; --i >= 0; ) {
					matchIndexes.push( i );
				}
				return matchIndexes;
			}),
	
			"gt": createPositionalPseudo(function( matchIndexes, length, argument ) {
				var i = argument < 0 ? argument + length : argument;
				for ( ; ++i < length; ) {
					matchIndexes.push( i );
				}
				return matchIndexes;
			})
		}
	};
	
	Expr.pseudos["nth"] = Expr.pseudos["eq"];
	
	for ( i in { radio: true, checkbox: true, file: true, password: true, image: true } ) {
		Expr.pseudos[ i ] = createInputPseudo( i );
	}
	for ( i in { submit: true, reset: true } ) {
		Expr.pseudos[ i ] = createButtonPseudo( i );
	}
	
	function setFilters() {}
	setFilters.prototype = Expr.filters = Expr.pseudos;
	Expr.setFilters = new setFilters();
	
	function tokenize( selector, parseOnly ) {
		var matched, match, tokens, type,
			soFar, groups, preFilters,
			cached = tokenCache[ selector + " " ];
	
		if ( cached ) {
			return parseOnly ? 0 : cached.slice( 0 );
		}
	
		soFar = selector;
		groups = [];
		preFilters = Expr.preFilter;
	
		while ( soFar ) {
	
			if ( !matched || (match = rcomma.exec( soFar )) ) {
				if ( match ) {
					soFar = soFar.slice( match[0].length ) || soFar;
				}
				groups.push( tokens = [] );
			}
	
			matched = false;
	
			if ( (match = rcombinators.exec( soFar )) ) {
				matched = match.shift();
				tokens.push({
					value: matched,
					type: match[0].replace( rtrim, " " )
				});
				soFar = soFar.slice( matched.length );
			}
	
			for ( type in Expr.filter ) {
				if ( (match = matchExpr[ type ].exec( soFar )) && (!preFilters[ type ] ||
					(match = preFilters[ type ]( match ))) ) {
					matched = match.shift();
					tokens.push({
						value: matched,
						type: type,
						matches: match
					});
					soFar = soFar.slice( matched.length );
				}
			}
	
			if ( !matched ) {
				break;
			}
		}
	
		return parseOnly ?
			soFar.length :
			soFar ?
				Sizzle.error( selector ) :
				tokenCache( selector, groups ).slice( 0 );
	}
	
	function toSelector( tokens ) {
		var i = 0,
			len = tokens.length,
			selector = "";
		for ( ; i < len; i++ ) {
			selector += tokens[i].value;
		}
		return selector;
	}
	
	function addCombinator( matcher, combinator, base ) {
		var dir = combinator.dir,
			checkNonElements = base && dir === "parentNode",
			doneName = done++;
	
		return combinator.first ?
			function( elem, context, xml ) {
				while ( (elem = elem[ dir ]) ) {
					if ( elem.nodeType === 1 || checkNonElements ) {
						return matcher( elem, context, xml );
					}
				}
			} :
	
			function( elem, context, xml ) {
				var data, cache, outerCache,
					dirkey = dirruns + " " + doneName;
	
				if ( xml ) {
					while ( (elem = elem[ dir ]) ) {
						if ( elem.nodeType === 1 || checkNonElements ) {
							if ( matcher( elem, context, xml ) ) {
								return true;
							}
						}
					}
				} else {
					while ( (elem = elem[ dir ]) ) {
						if ( elem.nodeType === 1 || checkNonElements ) {
							outerCache = elem[ expando ] || (elem[ expando ] = {});
							if ( (cache = outerCache[ dir ]) && cache[0] === dirkey ) {
								if ( (data = cache[1]) === true || data === cachedruns ) {
									return data === true;
								}
							} else {
								cache = outerCache[ dir ] = [ dirkey ];
								cache[1] = matcher( elem, context, xml ) || cachedruns;
								if ( cache[1] === true ) {
									return true;
								}
							}
						}
					}
				}
			};
	}
	
	function elementMatcher( matchers ) {
		return matchers.length > 1 ?
			function( elem, context, xml ) {
				var i = matchers.length;
				while ( i-- ) {
					if ( !matchers[i]( elem, context, xml ) ) {
						return false;
					}
				}
				return true;
			} :
			matchers[0];
	}
	
	function condense( unmatched, map, filter, context, xml ) {
		var elem,
			newUnmatched = [],
			i = 0,
			len = unmatched.length,
			mapped = map != null;
	
		for ( ; i < len; i++ ) {
			if ( (elem = unmatched[i]) ) {
				if ( !filter || filter( elem, context, xml ) ) {
					newUnmatched.push( elem );
					if ( mapped ) {
						map.push( i );
					}
				}
			}
		}
	
		return newUnmatched;
	}
	
	function setMatcher( preFilter, selector, matcher, postFilter, postFinder, postSelector ) {
		if ( postFilter && !postFilter[ expando ] ) {
			postFilter = setMatcher( postFilter );
		}
		if ( postFinder && !postFinder[ expando ] ) {
			postFinder = setMatcher( postFinder, postSelector );
		}
		return markFunction(function( seed, results, context, xml ) {
			var temp, i, elem,
				preMap = [],
				postMap = [],
				preexisting = results.length,
	
				elems = seed || multipleContexts( selector || "*", context.nodeType ? [ context ] : context, [] ),
	
				matcherIn = preFilter && ( seed || !selector ) ?
					condense( elems, preMap, preFilter, context, xml ) :
					elems,
	
				matcherOut = matcher ?
					postFinder || ( seed ? preFilter : preexisting || postFilter ) ?
	
						[] :
	
						results :
					matcherIn;
	
			if ( matcher ) {
				matcher( matcherIn, matcherOut, context, xml );
			}
	
			if ( postFilter ) {
				temp = condense( matcherOut, postMap );
				postFilter( temp, [], context, xml );
	
				i = temp.length;
				while ( i-- ) {
					if ( (elem = temp[i]) ) {
						matcherOut[ postMap[i] ] = !(matcherIn[ postMap[i] ] = elem);
					}
				}
			}
	
			if ( seed ) {
				if ( postFinder || preFilter ) {
					if ( postFinder ) {
						temp = [];
						i = matcherOut.length;
						while ( i-- ) {
							if ( (elem = matcherOut[i]) ) {
								temp.push( (matcherIn[i] = elem) );
							}
						}
						postFinder( null, (matcherOut = []), temp, xml );
					}
	
					i = matcherOut.length;
					while ( i-- ) {
						if ( (elem = matcherOut[i]) &&
							(temp = postFinder ? indexOf.call( seed, elem ) : preMap[i]) > -1 ) {
	
							seed[temp] = !(results[temp] = elem);
						}
					}
				}
	
			} else {
				matcherOut = condense(
					matcherOut === results ?
						matcherOut.splice( preexisting, matcherOut.length ) :
						matcherOut
				);
				if ( postFinder ) {
					postFinder( null, results, matcherOut, xml );
				} else {
					push.apply( results, matcherOut );
				}
			}
		});
	}
	
	function matcherFromTokens( tokens ) {
		var checkContext, matcher, j,
			len = tokens.length,
			leadingRelative = Expr.relative[ tokens[0].type ],
			implicitRelative = leadingRelative || Expr.relative[" "],
			i = leadingRelative ? 1 : 0,
	
			matchContext = addCombinator( function( elem ) {
				return elem === checkContext;
			}, implicitRelative, true ),
			matchAnyContext = addCombinator( function( elem ) {
				return indexOf.call( checkContext, elem ) > -1;
			}, implicitRelative, true ),
			matchers = [ function( elem, context, xml ) {
				return ( !leadingRelative && ( xml || context !== outermostContext ) ) || (
					(checkContext = context).nodeType ?
						matchContext( elem, context, xml ) :
						matchAnyContext( elem, context, xml ) );
			} ];
	
		for ( ; i < len; i++ ) {
			if ( (matcher = Expr.relative[ tokens[i].type ]) ) {
				matchers = [ addCombinator(elementMatcher( matchers ), matcher) ];
			} else {
				matcher = Expr.filter[ tokens[i].type ].apply( null, tokens[i].matches );
	
				if ( matcher[ expando ] ) {
					j = ++i;
					for ( ; j < len; j++ ) {
						if ( Expr.relative[ tokens[j].type ] ) {
							break;
						}
					}
					return setMatcher(
						i > 1 && elementMatcher( matchers ),
						i > 1 && toSelector(
							tokens.slice( 0, i - 1 ).concat({ value: tokens[ i - 2 ].type === " " ? "*" : "" })
						).replace( rtrim, "$1" ),
						matcher,
						i < j && matcherFromTokens( tokens.slice( i, j ) ),
						j < len && matcherFromTokens( (tokens = tokens.slice( j )) ),
						j < len && toSelector( tokens )
					);
				}
				matchers.push( matcher );
			}
		}
	
		return elementMatcher( matchers );
	}
	
	function matcherFromGroupMatchers( elementMatchers, setMatchers ) {
		var matcherCachedRuns = 0,
			bySet = setMatchers.length > 0,
			byElement = elementMatchers.length > 0,
			superMatcher = function( seed, context, xml, results, expandContext ) {
				var elem, j, matcher,
					setMatched = [],
					matchedCount = 0,
					i = "0",
					unmatched = seed && [],
					outermost = expandContext != null,
					contextBackup = outermostContext,
					elems = seed || byElement && Expr.find["TAG"]( "*", expandContext && context.parentNode || context ),
					dirrunsUnique = (dirruns += contextBackup == null ? 1 : Math.random() || 0.1),
					len = elems.length;
	
				if ( outermost ) {
					outermostContext = context !== document && context;
					cachedruns = matcherCachedRuns;
				}
	
				for ( ; i !== len && (elem = elems[i]) != null; i++ ) {
					if ( byElement && elem ) {
						j = 0;
						while ( (matcher = elementMatchers[j++]) ) {
							if ( matcher( elem, context, xml ) ) {
								results.push( elem );
								break;
							}
						}
						if ( outermost ) {
							dirruns = dirrunsUnique;
							cachedruns = ++matcherCachedRuns;
						}
					}
	
					if ( bySet ) {
						if ( (elem = !matcher && elem) ) {
							matchedCount--;
						}
	
						if ( seed ) {
							unmatched.push( elem );
						}
					}
				}
	
				matchedCount += i;
				if ( bySet && i !== matchedCount ) {
					j = 0;
					while ( (matcher = setMatchers[j++]) ) {
						matcher( unmatched, setMatched, context, xml );
					}
	
					if ( seed ) {
						if ( matchedCount > 0 ) {
							while ( i-- ) {
								if ( !(unmatched[i] || setMatched[i]) ) {
									setMatched[i] = pop.call( results );
								}
							}
						}
	
						setMatched = condense( setMatched );
					}
	
					push.apply( results, setMatched );
	
					if ( outermost && !seed && setMatched.length > 0 &&
						( matchedCount + setMatchers.length ) > 1 ) {
	
						Sizzle.uniqueSort( results );
					}
				}
	
				if ( outermost ) {
					dirruns = dirrunsUnique;
					outermostContext = contextBackup;
				}
	
				return unmatched;
			};
	
		return bySet ?
			markFunction( superMatcher ) :
			superMatcher;
	}
	
	compile = Sizzle.compile = function( selector, group /* Internal Use Only */ ) {
		var i,
			setMatchers = [],
			elementMatchers = [],
			cached = compilerCache[ selector + " " ];
	
		if ( !cached ) {
			if ( !group ) {
				group = tokenize( selector );
			}
			i = group.length;
			while ( i-- ) {
				cached = matcherFromTokens( group[i] );
				if ( cached[ expando ] ) {
					setMatchers.push( cached );
				} else {
					elementMatchers.push( cached );
				}
			}
	
			cached = compilerCache( selector, matcherFromGroupMatchers( elementMatchers, setMatchers ) );
		}
		return cached;
	};
	
	function multipleContexts( selector, contexts, results ) {
		var i = 0,
			len = contexts.length;
		for ( ; i < len; i++ ) {
			Sizzle( selector, contexts[i], results );
		}
		return results;
	}
	
	function select( selector, context, results, seed ) {
		var i, tokens, token, type, find,
			match = tokenize( selector );
	
		if ( !seed ) {
			if ( match.length === 1 ) {
	
				tokens = match[0] = match[0].slice( 0 );
				if ( tokens.length > 2 && (token = tokens[0]).type === "ID" &&
						support.getById && context.nodeType === 9 && documentIsHTML &&
						Expr.relative[ tokens[1].type ] ) {
	
					context = ( Expr.find["ID"]( token.matches[0].replace(runescape, funescape), context ) || [] )[0];
					if ( !context ) {
						return results;
					}
					selector = selector.slice( tokens.shift().value.length );
				}
	
				i = matchExpr["needsContext"].test( selector ) ? 0 : tokens.length;
				while ( i-- ) {
					token = tokens[i];
	
					if ( Expr.relative[ (type = token.type) ] ) {
						break;
					}
					if ( (find = Expr.find[ type ]) ) {
						if ( (seed = find(
							token.matches[0].replace( runescape, funescape ),
							rsibling.test( tokens[0].type ) && context.parentNode || context
						)) ) {
	
							tokens.splice( i, 1 );
							selector = seed.length && toSelector( tokens );
							if ( !selector ) {
								push.apply( results, seed );
								return results;
							}
	
							break;
						}
					}
				}
			}
		}
	
		compile( selector, match )(
			seed,
			context,
			!documentIsHTML,
			results,
			rsibling.test( selector )
		);
		return results;
	}
	
	support.sortStable = expando.split("").sort( sortOrder ).join("") === expando;
	
	support.detectDuplicates = hasDuplicate;
	
	setDocument();
	
	support.sortDetached = assert(function( div1 ) {
		return div1.compareDocumentPosition( document.createElement("div") ) & 1;
	});
	
	if ( !assert(function( div ) {
		div.innerHTML = "<a href='#'></a>";
		return div.firstChild.getAttribute("href") === "#" ;
	}) ) {
		addHandle( "type|href|height|width", function( elem, name, isXML ) {
			if ( !isXML ) {
				return elem.getAttribute( name, name.toLowerCase() === "type" ? 1 : 2 );
			}
		});
	}
	
	if ( !support.attributes || !assert(function( div ) {
		div.innerHTML = "<input/>";
		div.firstChild.setAttribute( "value", "" );
		return div.firstChild.getAttribute( "value" ) === "";
	}) ) {
		addHandle( "value", function( elem, name, isXML ) {
			if ( !isXML && elem.nodeName.toLowerCase() === "input" ) {
				return elem.defaultValue;
			}
		});
	}
	
	if ( !assert(function( div ) {
		return div.getAttribute("disabled") == null;
	}) ) {
		addHandle( booleans, function( elem, name, isXML ) {
			var val;
			if ( !isXML ) {
				return (val = elem.getAttributeNode( name )) && val.specified ?
					val.value :
					elem[ name ] === true ? name.toLowerCase() : null;
			}
		});
	}
	
	return Sizzle;
});
/**
 * 提供更高级的字符串使用方式，并添加中文字符相关处理，注意：该系列方法的返回值均为String对象(typeof的值为object)，而非简单字符串对象(typeof值为string)
 * @namespace Core.string
 * @constructor
 */
define("base.string", [], function(require,exports,module){
	var _obj = require("base.object");
	var _str = require("base.string.class");
	
	var _cut = require("base.string.cut");
	var _bytesLength = require("base.string.bytesLength");
	var _leftBytes = require("base.string.leftBytes");
	var _dbcToSbc = require("base.string.dbcToSbc");
	var _trim = require("base.string.trim");
	
	_str.__type__ = "panda.string";
	_str = _obj.merge(_str, _cut);
	_str = _obj.merge(_str, _bytesLength);
	_str = _obj.merge(_str, _leftBytes);
	_str = _obj.merge(_str, _dbcToSbc);
	_str = _obj.merge(_str, _trim);
	
	/**
	 * 将普通字符串数据封装为PandaString类型的字符串对象，并为它添加string系列方法
	 * @method create
 	 * @param {String} value "" 待封装的普通字符串数据
 	 * @return {PandaString}
	 */
	_str.create = function(value) {
		if (value == null || value == undefined)
			value = "";
		return _obj.merge(new String(value+""), _str);
	};
	
	module.exports = _obj.merge(_str, new String(""));
	
	panda = _obj.merge(panda, _str);
});
/**
 * System配置文件
 * User: lizihan
 * Date: 13-06-13
 * Time: 14:29
 */
define("base.system",[],function(require,exports,module){
	var _obj = require("base.object");
	var _system = {};
	
	var _browser = require("base.system.browser");
	var _cookie = require("base.system.cookie");
	var _storage = require("base.system.storage");
	var _screen = require("base.system.screen");
	var _scroll = require("base.system.scroll");
	
	_system.__type__ = "panda.system";
	
	_system = _obj.merge(_system, {
		browser: _browser
	});
	_system = _obj.merge(_system, {
		cookie: _cookie
	});
	_system = _obj.merge(_system, {
		storage: _storage
	});
	_system = _obj.merge(_system, {
		screen:_screen	
	});
	_system = _obj.merge(_system, {
		scroll:_scroll
	});

	panda = _obj.merge(panda, _system);
	module.exports = _system;
});
/**
 * 工具配置文件
 * User: lizihan
 * Date: 13-06-14
 * Time: 11:35
 */
define("base.util",[],function(require,exports,module){
	var _obj = require("base.object");
	var _util = {};
	
	var _dateFormatter = require("base.util.DateFormatter");
	var _reg = require("base.util.Reg");
	var _url = require("base.util.URL");
	var _guid = require("base.util.guid");
	var _swf = require("base.util.SWF");
	var _timer = require("base.util.Timer");
	var _tween = require("base.util.Tweener");
	var _io = require("base.util.io");
	var _lang = require("base.util.lang");
	var _template = require("base.util.template");
	
	_util.__type__ = "panda.util";
	
	_util = _obj.merge(_util, {
		Reg: _reg
	});
	_util = _obj.merge(_util, {
		URL: _url
	});
	_util = _obj.merge(_util, {
		guid: _guid
	});
	_util = _obj.merge(_util, {
		DateFormatter: _dateFormatter
	});
	_util = _obj.merge(_util, {
		swf: _swf
	});
	_util = _obj.merge(_util, {
		Timer:_timer
	});
	_util = _obj.merge(_util, {
		Tweener:_tween
	});
	_util = _obj.merge(_util, {
		Color:require("base.util.Color")
	});
	_util = _obj.merge(_util, _io);
	_util = _obj.merge(_util, _lang);
	_util = _obj.merge(_util, {
		template:_template
	});
	
	panda = _obj.merge(panda, _util);
	
	module.exports = _util;
});
/**
 * 组件核心类
 * User: lizihan
 * Date: 13-07-22
 * Time: 18:08
 */
define("base.widget",[],function(require,exports,module){
	var _obj = require("base.object");
	var _bw = {};
	
	
	_bw.__type__ = "panda.widget";
	
	_bw = _obj.merge(_bw, {
		manager: require("base.widget.WidgetManager"),
		base: require("base.widget.Widget")
	});
	
	_bw.get = _bw.manager.get;
	
	module.exports = _bw;
});
/**
 * @namespace Core.array
 * @constructor
 * 提供更高级的数组使用方式，并且封装常用数组算法方便开发者使用
 */
define("base.array.class", [], function(require, exports, module) {
	var _obj = require("base.object");
    
	var _Array = _obj.create();
	_Array.prototype = {
    	index:function(value) {
			
		},
		/**
	     * 过滤当前数组中的重复元素，过滤后并不产生新的数组
	     * @method unique
	     * @return {Array}
	     * @example
	     *      panda([1,1,2,3,4,4]).unique(); // ==> [1,2,3,4]
	     */
    	unique:function() {
			
		},
		/**
	     * 在当前数组中的指定位置插入新的元素，元素下标从0开始计算
	     * @method insert
	     * @param {Number} index - 待插入的位置下标，
	     * @param {Object} value - 待插入的数据元素
	     * @return {Array}
	     * @example
	     *      panda([1,2,4]).insert(2, 3); // ==> [1,2,3,4]
	     */
    	insert:function(index, value) {
			
		},
		/**
	     * 在数组的指定位置插入数据
	     * @method remove
	     * @param {Number} index - 待删除元素的下标数字
	     * @return {Array}
	     * @example
	     *      panda([1,2,3,4]).remove(2); // ==> [1,2,4]
	     * 		// 删除指定元素
	     * 		var array = panda(["1", "2", "3", "4"]);
	     * 		array.remove(array.indexOf("3")); // ==> ["1", "2", "4"]
	     */
    	remove:function(index) {
			
		},
		/**
	     * 获取指定数据在当前数组中首次出现的位置下标
	     * @pc
	     * @method indexOf
	     * @param {Object} value - 在数组中待查找的值，该值可以是任意对象
	     * @param {Number} index 0 从指定索引之后开始查找
	     * @return {Number}
	     * @example
	     *      panda([1,2,2,3]).indexOf(2); // ==> 1
	     * 		panda([1,2,2,3]).indexOf(2, 2); // ==> 2
	     */
    	indexOf:function(item, i) {
			
		},
		/**
	     * 获取指定数据在当前数组中最后出现的位置下标
	     * @pc
	     * @method lastIndexOf
	     * @param {Object} value - 在数组中待查找的值，该值可以是任意对象
	     * @param {Number} index undefined 若不设置起始查找位置，则默认从数组最后一个元素开始查找
	     * @return {Number}
	     * @example
	     * 		panda([1,2,3,4,2]).lastIndexOf(2);	// ==> 4
	     *      panda([1,2,3,4,2]).lastIndexOf(2, 3); // ==> 1
	     */
    	lastIndexOf:function(item, i) {
			
		},
		/**
	     * 在数组中的每个项上运行一个函数，并将处理函数的结果作为当前下标的元素值
	     * @method map
	     * @param {Function} fun - 每一个元素的处理函数,该函数会接收两个参数，第一个参数为当前元素对象，第二个参数为当前元素下标
	     * @return {Array}
	     * @example
	     *      panda([1,2,3,4]).map(function(item, index) {
	     * 			return item+1;
	     * 		});
	     * 		// ==> [2,3,4,5]
	     */
		/**
	     * 循环数组当中的每一个元素，并执行一个处理函数，该执行过程及返回结果均不改变原数组数据
	     * @method each
	     * @param {Function} fun - 每一个元素的处理函数,该函数会接收两个参数，第一个参数为当前元素对象，第二个参数为当前元素下标
	     * @return {Array}
	     * @example
	     *      panda([1,2,3,4]).each(function(item, index) {
	     * 			return item+1;
	     * 		});
	     * 		// ==> [1,2,3,4]
	     */
    	map:function(func) {
    		
    	},
		each:function(func) {
			
		},
		/**
	     * 在数组中的每个项上运行一个函数，若存在任意的结果返回真，则停止循环
	     * @pc
	     * @method some
	     * @param {Function} fun - 每一个元素的处理函数,该函数会接收两个参数，第一个参数为当前元素对象，第二个参数为当前元素下标
	     * @return {Boolean}
	     * @example
	     *      panda([1,2,3,4]).some(function(item, index) {
	     * 			return true;
	     * 		});
	     * 		// ==> true
	     */
    	some:function(fun) {
			
		}
    };
	_Array = _obj._extend(_Array, []);
    
    module.exports = _Array;
});

define("base.array.each", [], function(require, exports, module) {
	var _obj = require("base.object");
	var _arr = require("base.array.class");
	
	module.exports = {
		each:function() {
			var value = arguments[0];
			var self = value;
			
			if(typeof this == 'object' && this.__type__ == 'panda.array') {
				self = this;
			}
			if(typeof value == 'object' && typeof arguments[1] != 'undefined') {
				self = _obj.merge(value, _arr);
				value = arguments[1];
			}
			
			var len = self.length;
			var res = new Array();
			
			if(typeof value == 'function') {
	        	for (var i = 0; i < len; i++) {
		            if (i in self)
		                value.call(null, self[i], i, self);
		        }
			}
	
	        return self;
		}
	};
});
define("base.array.index", [], function(require, exports, module) {
	var _obj = require("base.object");
	var _arr = require("base.array.class");
	
	module.exports = {
		index:function() {
			var value = arguments[0];
			var self = value;
			
			if(typeof this == 'object' && this.__type__ == 'panda.array') {
				self = this;
			}
			if(typeof value == 'object' && typeof arguments[1] != 'undefined') {
				self = _obj.merge(value, _arr);
				value = arguments[1];
			}
			
			for (var i = 0, il = self.length; i < il; i++) {
	            if (self[i] == value) {
	                return i;
	            }
	        }
	        return -1;
		}
	};
});
define("base.array.indexOf", [], function(require, exports, module) {
	var _obj = require("base.object");
	var _arr = require("base.array.class");
	
	module.exports = {
		indexOf:function() {
			var value = arguments[0];
			var self = value;
			var target = null;
			
			if(typeof this == 'object' && this.__type__ == 'panda.array') {
				self = this;
				target = arguments[0];
				value = arguments[1];
			}
			if(typeof value == 'object' && typeof arguments[1] != 'undefined') {
				self = _obj.merge(value, _arr);
				target = arguments[1];
				value = arguments[2];
			}
			
			value || (value = 0);
	        var length = self.length;
	        if (value < 0) value = length + i;
	        for (; value < length; value++)
	            if (self[value] === target) return value;
	        return -1;
		}
	};
});
define("base.array.insert", [], function(require, exports, module) {
	var _obj = require("base.object");
	var _arr = require("base.array.class");
	
	module.exports = {
		insert:function() {
			var value = arguments[0];
			var self = value;
			var index = 0;
			
			if(typeof this == 'object' && this.__type__ == 'panda.array') {
				self = this;
				index = arguments[1];
			}
			if(typeof value == 'object' && typeof arguments[1] != 'undefined') {
				self = _obj.merge(value, _arr);
				value = arguments[1];
				index = arguments[2];
			}
			
			index = isNaN(index) ? self.length : index;
			
			return self.slice(0, index).concat(value, self.slice(index));
		}
	};
});
define("base.array.lastIndexOf", [], function(require, exports, module) {
	var _obj = require("base.object");
	var _arr = require("base.array.class");
	
	module.exports = {
		lastIndexOf:function() {
			var i = arguments[0];
			var self = i;
			var target = null;
			
			if(typeof this == 'object' && this.__type__ == 'panda.array') {
				self = this;
				i = arguments[1];
				target = arguments[0];
			}
			if(typeof value == 'object' && typeof arguments[1] != 'undefined') {
				self = _obj.merge(i, _arr);
				i = arguments[2];
				target = arguments[1];
			}
			
			i = isNaN(i) ? self.length : (i < 0 ? self.length + i : i) + 1;
	        var reArray = self.slice(0, i).reverse();
	        var n = -1;
	        if(!reArray.indexOf){
	            /**
	             * 主要兼容 IE 上面无indexOf 方法
	             */
	            for(var j= 0,Ln = reArray.length; j<Ln ; j++){
	               if(reArray[j] == target){
	                   n=j;
	                   break;
	               }
	            }
	        }else{
	            n = self.slice(0, i).reverse().indexOf(target);
	        }
	
	        return (n < 0) ? n : i - n - 1;
		}
	};
});
define("base.array.map", [], function(require, exports, module) {
	var _obj = require("base.object");
	var _arr = require("base.array.class");
	
	module.exports = {
		map:function() {
			var value = arguments[0];
			var self = value;
			
			if(typeof this == 'object' && this.__type__ == 'panda.array') {
				self = this;
			}
			if(typeof value == 'object' && typeof arguments[1] != 'undefined') {
				self = _obj.merge(value, _arr);
				value = arguments[1];
			}
			
			var len = self.length;
			var res = new Array();
			
			if(typeof value == 'function') {
				if(typeof [].map == 'function') {
					var temp = Array.apply(null, self);
					return temp.map(value);
				}
		        else {
		        	for (var i = 0; i < len; i++) {
			            if (i in self)
			                res[i] = value.call(null, self[i], i, self);
			        }
			    }
			}
	
	        return _obj.merge(res, _arr);
		}
	};
});
define("base.array.remove", [], function(require, exports, module) {
	var _obj = require("base.object");
	var _arr = require("base.array.class");
	
	module.exports = {
		remove:function() {
			var value = arguments[0];
			var self = value;
			
			if(typeof this == 'object' && this.__type__ == 'panda.array') {
				self = this;
			}
			if(typeof value == 'object' && typeof arguments[1] != 'undefined') {
				self = _obj.merge(new Array(), _arr);
				value = arguments[1];
			}
			
			while(value < 0) {
				value += self.length;
			}
			
			var arr1 = self.slice(0, value);
	        var arr2 = self.slice(value + 1);
	        return arr1.concat(arr2);
		}
	};
});
define("base.array.some", [], function(require, exports, module) {
	var _obj = require("base.object");
	var _arr = require("base.array.class");
	
	module.exports = {
		some:function() {
			var value = arguments[0];
			var self = value;
			
			if(typeof this == 'object' && this.__type__ == 'panda.array') {
				self = this;
			}
			if(typeof value == 'object' && typeof arguments[1] != 'undefined') {
				self = _obj.merge(value, _arr);
				value = arguments[1];
			}
			
			var len = self.length;
	
	        if(typeof value == 'function') {
				if(typeof [].some == 'function') {
					var temp = Array.apply(null, self);
					return temp.some(value);
				}
		        else {
		        	for (var i = 0; i < len; i++) {
			            if (i in self && value.call(null, self[i], i, self))
	                		return true;
			        }
			    }
			}
	
	        return false;
		}
	};
});
define("base.array.unique", [], function(require, exports, module) {
	var _obj = require("base.object");
	var _arr = require("base.array.class");
	
	module.exports = {
		unique:function() {
			var value = arguments[0];
			var self = value;
			
			if(typeof this == 'object' && this.__type__ == 'panda.array') {
				self = this;
			}
			if(typeof value == 'object') {
				self = _obj.merge(value, _arr);
			}
			
			for (var i = 0; i < self.length; i++) {
	            var it = self[i];
	            for (var j = self.length - 1; j > i; j--) {
	                if (self[j] == it) self.splice(j, 1);
	            }
	        }
	        return self;
		}
	};
});
/**
 * User: sunqingwei
 * Date: 13-9-24
 * Time: 下午3:31
 */
/**
 * @namespace DOM.animate
 * @constructor
 */
define("base.dom.animate", [], function (require, exports, module) {
    var _object = require("base.object");
    var _tweens = require("base.util.tweens");
    /**
     * 动画time 的类型
     */
    var DEFAULT_ANIMATE_TYPE = {
        "fast": 200,
        "slow": 600
    };
    /**
     * 参数纠正
     */
    function fix(speed, easing, fn) {
        var opt = {};
        if (speed && !_object.isObject(speed)) {
            if (_object.isString(speed) && isNaN(speed)) {
                if (DEFAULT_ANIMATE_TYPE[speed])opt["time"] = DEFAULT_ANIMATE_TYPE[speed];
            } else if (!isNaN(speed)) {
                opt["time"] = parseFloat(speed);
            }
            if ((fn && easing || easing && _object.isString(speed) ) && _object.isFunction(_tweens[easing]))
                opt["type"] = fn && easing || easing && _object.isString(speed) && easing;
            if (fn || !fn && easing || _object.isFunction(speed) && speed)
                opt["onEnd"] = fn || !fn && easing || _object.isFunction(speed) && speed;
        } else if (_object.isObject(speed)) {
            opt = speed;
        }
        return opt;
    }

    var Animate = {
        /**
         * 针对DOM元素的基础动画函数
         * @method animate
         * @param {Object} properties - 一组包含作为动画属性和终值的样式属性和及其值的集合
         * @param {Number} duration normal  三种预定速度之一的字符串或表示动画时长的毫秒数值(如：1000)
         * @param {String} easing easeOutQuad 要使用的缓动效果的名称
         * @param {Function} callback - 在动画完成时执行的函数
         * @returns {PandaDOM}
         * @platform all
         * @example
         * 		panda("#book").animate({
         * 			opacity: 0.25,
         *       	left: '+=50',
         *       	height: 'toggle'
         *     	}, 5000, function() {
         * 			// Animation complete.
         *     	});
         */
        animate: function (properties, duration, easing, callback) {
            var self = this,
                opts = {},
                index = 0,
                i = 0;

            if (_object.isEmptyObject(properties))
                return self;

            opts = _object.parameter(opts, fix(duration, easing, callback));
            opts.to = properties;

            if (properties.hasOwnProperty('autoComplete')) {
                opts.autoComplete = properties.autoComplete;
            }

            panda(self).each(function (item, index) {
                item = panda(item);

                var tweenerQueue = item.data("__animate__");
                if (!tweenerQueue) {
                    item.data("__animate__", {});
                    tweenerQueue = {};
                } else {
                    if (tweenerQueue.isPlay) {
                        tweenerQueue.stop();
                    }
                }

                opts.target = item;
                var tweener = new panda.Tweener(opts);
                tweenerQueue = tweener;

                if (panda.isFunction(tweenerQueue.start))
                    tweenerQueue.start();

                item.data("__animate__", tweenerQueue);
            });

            return self;
        },
        /**
         * 停止当前DOM元素正在执行或未开始执行的动画
         * @method stop
         * @return {PandaDOM}
         * @platform all
         * @example
         * 		panda("#book").animate({
         * 			'opacity':0.5,
         * 			'left':100
         * 		}, 5000, function() {
         * 			console.log('stop');
         * 		}).stop();  //=> 此处会在控制台输出'stop', stop方法将会默认将动画置为已完成状态，并调用 completeCallback 方法
         * 
         * 		// 若希望不调用动画完成方法(completeCallback)，则可设置 autoComplte为false
		 *		panda("#book").animate({
         * 			'opacity':0.5,
         * 			'left':100,
         * 			'autoComplete':false
         * 		}, 5000, function() {
         * 			console.log('stop'); 
         * 		}).stop(); //=> 此处不会在控制台输出'stop'
         */
        stop: function () {
            panda(this).each(function (item, index) {
                item = panda(item);

                var tweenerQueue = panda(item).data("__animate__");
                if (!tweenerQueue) {
                    item.data("__animate__", {});
                    tweenerQueue = {};
                }

                if (panda.isFunction(tweenerQueue.stop))
                    tweenerQueue.stop();
            });

            return this;
        },
        /**
         * 使用向下滑动动画显示当前DOM元素
         * @method slideDown
         * @param {Number|String} speed normal 三种预定速度之一的字符串("slow","normal","fast")或表示动画时长的毫秒数值(如：1000)
         * @param {Function} callback - 在动画完成时执行的函数
         * @return {PandaDOM}
         * @platform all
         * @example
         * 		panda("#book").slideUp("slow", function() {
         * 			console.log("#book is show.");
         * 		});
         */
        slideDown: function (speed, callback) {
            var self = this;
            if (self.data("__slideNum__") == undefined) {
                self.data("__slideNum__", self.height());
            }
            /**
             * 主要解决元素在隐藏是，执行slideDown 无法看到效果的问题
             */
            if(self.css("display") == "none"){
                self.show();
                self.height(0);
            }
            self.animate({
                height: self.data("__slideNum__")
            }, speed || 350, callback);
        },
        /**
         * 使用向上滑动动画隐藏当前DOM元素
         * @method slideUp
         * @param {Number|String} speed normal 三种预定速度之一的字符串("slow","normal","fast")或表示动画时长的毫秒数值(如：1000)
         * @param {Function} callback - 在动画完成时执行的函数
         * @platform all
         * @return {PandaDOM}
         * @example
         * 		panda("#book").slideUp("slow", function() {
         * 			console.log("#book is hide.");
         * 		});
         */
        slideUp: function (speed, callback) {
            var self = this;
            if (self.data("__slideNum__") == undefined) {
                self.data("__slideNum__", self.height());
            }
            self.animate({
                height: 0
            }, speed || 350, callback);
           return self;
        },
        /**
         * 使用上下滑动动画将当前DOM元素在显示和隐藏状态之间切换
         * @method slideToggle
         * @param {Number|String} speed normal 三种预定速度之一的字符串("slow","normal","fast")或表示动画时长的毫秒数值(如：1000)
         * @param {Function} callback - 在动画完成时执行的函数
         * @platform all
         * @return {PandaDOM}
         * @example
         * 		panda("#book").show();
         * 		panda("#book").slideToggle('slow', function() {
         * 			console.log(panda("#book").css('display')); //=> 此处会输出 none
         * 		});
         */
        slideToggle: function (speed, callback) {
            var self = this;
            if (self.data("__slideNum__") == undefined)self.data("__slideNum__", self.height());
            if (self.data("__animate__"))self.data("__animate__").stop();

            if(self.css("display") == "none"){
                self.show();
                self.height(0);
            }
            if (self.height() <= 0) {
                self.slideDown(speed, callback);
            } else {
                self.slideUp(speed, callback);
            }
            return self;
        },
        /**
         * 使用渐现动画显示当前DOM元素
         * @method fadeIn
         * @param {Number} speed normal 三种预定速度之一的字符串("slow","normal","fast")或表示动画时长的毫秒数值(如：1000)
         * @param {Function} callback - 在动画完成时执行的函数
         * @platform all
         * @return {PandaDOM}
         * @example
         * 		panda("#book").fadeIn("slow", function() {
         * 			console.log("#book is show.");
         * 		});
         */
        fadeIn: function (speed, callback) {
            return this.css("opacity", 0).show().animate({opacity: 1}, speed || 400,callback);
        },
        /**
         * 使用渐隐动画隐藏当前DOM元素
         * @method fadeOut
         * @param {Number} speed normal 三种预定速度之一的字符串("slow","normal","fast")或表示动画时长的毫秒数值(如：1000)
         * @param {Function} callback - 在动画完成时执行的函数
         * @return {PandaDOM}
         * @example
         * 		panda("#book").fadeOut("slow", function() {
         * 			console.log("#book is hide.");
         * 		});
         */
        fadeOut: function (speed, callback) {
            return this.show().animate({opacity: 0}, speed || 400,"easing", function(){
                if(panda.isFunction(callback))callback();
                this.target && this.target.hide();
            });
        },
        /**
         * 把所有匹配元素的不透明度以渐进方式调整到指定的不透明度，并在动画完成后可选地触发一个回调函数
         * @method fadeTo
         * @param {Number|String} speed normal 三种预定速度之一的字符串("slow","normal","fast")或表示动画时长的毫秒数值(如：1000)
         * @param {Number} opacity - 指定的透明度，如:0.5
         * @param {String} easing easeOutQuad 指定使用的缓动方式，若不指定，则将该参数设置为 null
         * @param {Function} callback - 在动画完成时执行的函数
         * @return {PandaDOM}
         * @example
         * 		panda("#book").fadeOut("slow", function() {
         * 			console.log("#book is hide.");
         * 		});
         */
        fadeTo: function (speed, opacity, easing, callback) {
            return this.css("opacity", 0).show().animate({opacity: opacity}, speed, easing, callback);
        },
        /**
         * 将当前元素的内部滚动条滚动到指定位置
 		 * @param {Number} value - 指定的滚动到的位置，若超过当前滚动条的最大高度，则以最大高度计算
 		 * @param {Number} time 300 表示动画时长的毫秒数值(如：1000)
 		 * @return {PandaDOM}
 		 * @example
 		 * 		panda('body').scrollTo(40, 500);
         */
        scrollTo: function (value, time) {
            time || (time = 300);
            var maxScroll = require("base.query")("body").height() - require("base.system.screen")().height + 20;
            if (value > maxScroll) {
                value = maxScroll;
            }
            var self = this;
            var duration = 10;
            var repeat = time / duration;
            var dy = value - require("base.system.scroll").scrollTop();
            dy = dy / repeat;

            var Timer = require("base.util.Timer");
            var timer = new Timer({
                duration: duration,
                delay: 0,
                repeat: repeat,
                callback: function () {
                    var scroll = require("base.system.scroll");
                    var top = scroll.scrollTop();
                    scroll.scrollTop(top + dy);

                    if (((top + 1)) >= maxScroll) {
                        timer.stop();
                    }
                }
            });
            timer.start();
            return this;
        }
    };
    module.exports = Animate;
})
;

/**
 * author: sunqingwei <sunqingwei@jd.com>
 * Date: 13-5-8
 * Time: 下午1:32
 */
/**
 * @namespace DOM.attributes
 * @constructor
 */
define("base.dom.attr", [], function (require, exports, module) {
    var pObj = require("base.object");
    var Attr = {
        /**
         * 为所有匹配的元素设置指定的属性值。
         * @method attr
         * @param {String} key - key如果是sting表示属性
         * @param {String} value - 属性值
         * @returns {PandaDOM}
         * @platform all
         * @example
         *      panda("#id").attr("data-value",1);
         */
        /**
         * 为所有匹配的元素设置指定的属性值。
         * @method attr
         * @param {Object} key - key如果是Object表示属性的“名/值对”对象
         * @returns {PandaDOM}
         * @platform all
         * @example
         *      panda("#id").attr({
         *          data-value:"111"
         *      })
         */

        /**
         * 为所有匹配的元素获取指定的属性值。
         * @method attr
         * @param {String} key - key如果是sting表示属性
         * @returns {String} 属性值
         * @platform all
         * @example
         *     var value = panda("#id").attr("data-value");
         */
        attr: function (key, value) {
            var self = this;
            if (pObj.isObject(key)) {
                self.each(function (el) {
                    for (var i in key) {
                        _set(el, i, key[i]);
                    }
                });
                return self;
            } else if (pObj.isString(key) && typeof value != 'undefined') {
                self.each(function (el) {
                    _set(el, key, value);
                });
                return self;
            } else if (pObj.isString(key)) {
                return _get((this && this.length) ? this[0] : {}, key);
            }
        },
        /**
         * 删除当前元素集合中所有元素指定属性
         * @method removeAttr
         * @param {String} key - 删除的属性的名称
         * @returns {PandaDOM}
         * @example
         *      panda("#id").removeAttr("data-value")
         */
        removeAttr: function (key) {
            if (!key)return this;
            var _this = this;
            _this.each(function (el) {
                _remove(el, key);  //TODO 需要过滤value的空格
            });
            return this;
        },
        /**
         * 获取当前元素集合第一个元素的滚动位置
         * @method scrollTop
         * @return {Number}
         * @example
         * 		panda("window").scrollTop(); // => 120 
         */

        /**
         * 设置当前元素集合第一个元素的滚动到某位置
         * @method scrollTop
         * @param  {Number} value - 元素滚动到位置的坐标值
         * @return {PandaDOM}
         * @example
         * 		panda("window").scrollTop(400); // => 滚动条会滚动到400的位置 
         */
		scrollTop: function() {
			if (!this.length)
				return arguments.length ? this : 0;
			
			if(!arguments.length) {
				// 修复IE9下window对象无scrollTop值 by lizihan 20140304
				if(this[0] === window || this[0] === document) {
					if(panda.isNumber(window.pageYOffset)){
						return window.pageYOffset;
					}else {
						return document.documentElement.scrollTop || document.body.scrollTop;
					}
				}else
					return ('scrollTop' in this[0]) ? this[0].scrollTop : this[0].scrollY;
			}else {
				if(this[0] === window || this[0] === document) {
					window.scrollTo(0, arguments[0]);
				}else if('scrollTop' in this[0]) {
					this[0].scrollTop = arguments[0];
				}else {
					this[0].scrollY = arguments[0];
				}
				return this;
			}
        }
    };


    /**
     * @method _set 设置属性
     * @param el
     * @private
     */
    function _set(el, key, value) {
        switch (key) {
            case 'class':
                el.className = value;
                break;
            case 'style':
                el.style.cssText = value;
                break;
            default:
            {
                el && el.setAttribute ? el.setAttribute(key, value) : el[key] = value;
            }
        }
    }

    /**
     * @method _get 获得属性
     * @returns {*}
     * @private
     */
    function _get(el, key) {
        switch (key) {
            case 'class':
                return el.className;
            case 'style':
                return el.style.cssText;
            default:
                var result = el && el.getAttribute ? el.getAttribute(key) : el[key];
                return (result == null) ? undefined : result;
        }
    }

    /**
     * @method _remove 删除属性
     * @param el
     * @private
     */
    function _remove(el, key) {
    	try {
            el[key] = null;
        } catch (e) {}
        try {
            delete el[key];
        } catch (e) {}
        try {
            el.removeAttribute(key);
        } catch (e) {}
    }


    module.exports = Attr;
});
/**
 * author: sunqingwei <sunqingwei@jd.com>
 * Date: 13-5-7
 * Time: 下午4:22
 */
/**
 * @namespace DOM.style
 * @constructor
 */
define("base.dom.class", [], function (require, exports, module) {
    var string = require("base.string");
    var pandaObj = require("base.object");
    var array = require("base.array");
    var Class = {
        /**
         * 为所有匹配的元素添加class。
         * @method addClass
         * @param {String} value - 待添加的className
         * @return {PandaDOM}
         * @platform all
         * @example
         * 		panda("#id").addClass("panda");
         */
        addClass: function (value) {
        	value = string.create(value).trim();
            var self = this,
                proceed = pandaObj.isString(value) && value;
            if (proceed) {
                this.each(function (item) {
                    item = panda(item);
                    if (!item.hasClass(value)) {
                        item[0].className += ' ' + value;
                    }
                });
            }
            return this;
        },
        /**
         * 为所有匹配的元素删除指定的 class
         * @method removeClass
         * @param {String} value - 待删除的className
         * @return {PandaDOM}
         * @example
         * 		panda("#id").removeClass("panda");
         */
        removeClass: function (value) {
        	value = string.create(value).trim();
            var self = this;
            proceed = pandaObj.isString(value) && value;
            if (proceed) {
                this.each(function (item) {
                    item = panda(item);
                    if (item.hasClass(value)) {
                        var reg = new RegExp('(^'+value+'\\s*)|(\\s+'+value+')');
                        item[0].className = item[0].className.replace(reg, '');
                    }
                });
            }
            return this;
        },
        /**
         * 为所有匹配的元素检测是否具有class
         * @method hasClass
         * @param {String} value - 所要检查的class值
         * @return {Boolean}
         * @example
         * 	    panda("#id").hasClass("className");
         */
        hasClass: function (value) {
        	value = string.create(value).trim();
            var reg = new RegExp('(^'+value+'\\s+)|(\\s+'+value+'\\s)|(\\s+'+value+'$)|(^'+value+'$)');
            var target = this && this.length ? this[0] : null;
            if (target && target.className && target.className.match(reg)) {
                return true;
            }
            return false;
        },
        /**
         * 将当前元素集的所有元素上进行指定className的切换，如果存在（不存在）就删除（添加）一个类
         * @method toggleClass
         * @param {String} value - 待添加或删除的class值
         * @returns {PandaDOM}
         * @example
         *      panda("#id").toggleClass("panda")
         */
        toggleClass: function (value) {
            var self = this;
            if (self && self.length > 0) {
                self.hasClass(value) ? self.removeClass(value) : self.addClass(value);
            }
            return self;
        }
    };

    module.exports = Class;
});
/**
 * author: sunqingwei <sunqingwei@jd.com>
 * Date: 13-5-8
 * Time: 下午1:40
 */
/**
 * @namespace DOM.general
 * @constructor
 */
define("base.dom.create", [], function (require, exports, module) {
	var browser = require("base.system.browser");
    var Create = {
        /**
         * 返回当前元素集的第一个元素的html内容
         * @method html
         * @returns {PandaDOM}
         * @example
         *      panda("#id").html();
         */

        /**
         * 设置有匹配元素的HTML内容的值
         * @method html
         * @param {String} value - 设置元素的html内容
         * @returns {PandaDOM}
         * @example
         *      panda("#id").html("我是Panda");
         */
        html: function () {
            var self = this,
                args = arguments;
            if (!self || !self[0])return this;
            if (args.length === 0) {
                return self[0].innerHTML;
            } else if (args.length > 0) {
                self.each(function (el) {
                	if(browser.ie && el.tagName.toLowerCase() == 'tbody') {
                		var temp = el.ownerDocument.createElement('div');
						temp.innerHTML = '<table>' + args[0] + '</table>';
						el.parentNode.replaceChild(temp.firstChild.firstChild, el);
                	}else {
                    	el.innerHTML = args[0];
                    }
                });
                return this;
            }
        },
        /**
         * 设置匹配元素的文本内容
         * @method text
         * @param {String} value - 设置元素的文本内容
         * @return {PandaDOM}
         * @example
         *      panda("#id").text("我是panda");
         */

        /**
         * 获取当前匹配元素集的第一个元素的文本内容
         * @method text
         * @returns {PandaDOM}
         * @example
         *      panda("#id").text();
         */
        text: function () {
            var self = this,
                args = arguments,
                value = args[0];
            if (!self || !self[0])return this;
            if (self && self.length > 0)
                if (args.length === 0) {
                    return this[0].innerText || this[0].textContent;
                } else if (args.length > 0) {
                    self.each(function (el) {
                        if (el.innerText) {
                            el.innerText = value;
                        } else {
                            el.textContent = value;
                        }
                    });
                    return this;
                }
        },
        /**
         * 设置所有匹配元素
         * @method val
         * @param {String} value - 设置元素的value
         * @returns {String}
         * @example
         *      panda("#id").val("Panda");
         */

        /**
         * 获取匹配元素集合第一个元素的value
         * @method val
         * @returns {String}
         * @example
         *      panda("#id").val();
         */
        val: function (value) {
            if(typeof value != 'undefined') {
				if(this && this.length) {
					this.each(function(item) {
						var el = item;
						if (el.tagName.toLowerCase() == "select") {
							var len = el.options.length;
							for(var i= 0; i<len; i++){
								if(el.options[i].value == value){
									el.options[i].selected = true;
								}
							}
						} else {
							el.value = value;
						}
					});
				}
				return this;
			}else {
				if(this && this.length) {
					var el = this[0];
					if (el.tagName.toLowerCase() == "select") {
						var index = el.selectedIndex,
							len = el.options.length;
						if (len > 0) {
							return el.options[index > -1 ? index : 0].value;
						}
					} else {
						return el.value;
					}
				}else {
					return null;
				}
			}
        }
    };
    module.exports = Create;
});
/**
 * author: sunqingwei <sunqingwei@jd.com>
 * Date: 13-5-8
 * Time: 下午1:38
 */
/**
 * @namespace DOM.general
 * @constructor
 */
define("base.dom.data", [], function(require, exports, module) {

    /**
     * 为当前元素集所有元素绑定指定的数据
     * @method data
     * @param {String} name - 绑定数据的名称
     * @param {Object} data - 绑定数据的内容，若不传递data参数时，则该方法返回当前元素集第一个元素绑定的name名称下的数据
     * @return {PandaObject}
     * @example
     * 		panda(".book").data('temp', {a:1}).data('temp');
     * 		//=> 此处会显示 {'a':1}
     */

    /**
     * 为当前元素集所有元素获取指定的数据
     * @method data
     * @param {String} name - 绑定数据的名称
     * @return {Object}
     * @example
     * 		panda(".book").data('temp', {a:1}).data('temp');
     * 		//=> 此处会显示 {'a':1}
     */
	// 修复了一个严重BUG，居然没有根据当前对象来存值
	// fixed by lizihan at 2013/10/22
	// 修复Panda对象无数据时返回数据不正确的问题
	// fixed by lizihan at 2013/12/23
	
	var Data = {};
	var guid = require("base.util.guid");
	
	function _getDataId(target) {
		var id = "";
		if(!target.__guid__) {
			id = target.__guid__ = guid();
		}else {
			id = target.__guid__;
		}
		
		if(!Data[id]) {
			Data[id] = {};
		}
		
		return id;
	}
	
    function data(key, value) {
    	if(!this) {
    		return null;
    	}
    	
    	var last = null;
		var isset = false;
    	this.each(function(item) {
    		if(last) {
    			return;
    		}
    		var id = _getDataId(item);
    		if ( typeof key == 'object') {
	            for (var k in key) {
	                Data[id][k] = key[k];
	            }
	        }
	        if ( typeof key == 'string' && value) {
	            Data[id][key] = value;
				
	        }
	        if ( typeof value == 'undefined') {
				isset = true;
	            last = Data[id][key];
	        }
    	});

        return isset ? last : this;
    }

    function removeData(key) {
		if(!this || !this.length) {
			return this;
    	}
		
		this.each(function(item) {
			var id = _getDataId(item);
		
			Data[id][key] = null;
			delete Data[id][key];
		});
		
        return this;
    };

    module.exports = {
        data : data,
        removeData : removeData
    };
}); 
/**
 * author: sunqingwei <sunqingwei@jd.com>
 * Date: 13-5-8
 * Time: 下午1:41
 */
/**
 * @namespace DOM.insertion
 * @constructor
 */
define("base.dom.insertion", [], function (require, exports, module) {

    var _object = require("base.object");
    var _browser = require("base.system.browser");
    var _string = require("base.string");

    var nodeNames = "abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|" +
            "header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",
        rhtml = /<|&#?\w+;/,
        rtagName = /<([\w:]+)/,
        rxhtmlTag = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,
        nodes = [];

    /**
     * 把所有匹配的元素插入到另一个、指定的元素元素集合的前面。
     * @method insertBefore
     * @param {PandaDOM} elem - Panda对象
     * @returns {PandaDOM}
     * @example
     *          var foo = panda("#foo");
     *          panda("p").insertBefore(foo);
     *          结果:
     *          <p>I would like to say: </p><div id="foo">Hello</div>
     *
     */

    var Insertion = {
        insertBefore: function (elem) {
            var _this = this;
            var i = 0;
            elem = panda(elem);
            if (elem.length) {
                elem.each(function (el) {
                    if (el.parentNode) {
                        while (i < _this.length) {
                            el.parentNode.insertBefore(_this[i], el);
                            i++;
                        }
                    }
                });
            }
            return _this;
        },
        before: function (elem) {
            return panda(elem).insertBefore(this);
        },
        insertAfter: function (elem) {
            var _this = this;
            var i = 0;
            elem = panda(elem);
            if (elem.length) {
                elem.each(function (el) {
                    if (el && el.parentNode) {
                        while (i < _this.length) {
							if (el.nextSibling) {
								el.parentNode.insertBefore(_this[i], el.nextSibling);
							} else {
                                /**
                                 * 修复了在某节点的最后一个孩子节点后面插入节点时，删去了当前节点的问题
                                 * fixed 20140124 10:15
                                 */
								if (el.parentNode) {
									el.parentNode.appendChild(_this[i]);
								}
							}
                            i++;
                        }
                    }
                });
            }
            return _this;
        },
        after: function (elem) {
            return panda(elem).insertAfter(this);
        },
        appendTo: function (elem) {
            var _this = this;
            if (_this.length) {
                var result = [];
                _this.each(function (el) {
                    var node = panda(elem);
                    if (node[0] && (node[0].nodeType === 1 || node[0].nodeType === 9 || node[0].nodeType === 11)) {
                        result.push(node.append(el));
                    }
                });
            }
            return _this;
        },
        append: function (elem) {
            var _this = this;
            if (_this.length) {
                _this.each(function (el) {
                    var node = panda(elem);
                    if (el.nodeType === 1 || el.nodeType === 9 || el.nodeType === 11) {
                        node.each(function (item, index) {
                            el.appendChild(item);
                        });
                    }
                    ;
                });
            }
            return _this;
        },
        prependTo: function (elem) {
            var _this = this;
            if (_this.length) {
                var result = [];
                _this.each(function (el) {
                    if (el.parentNode) {
                        var node = panda(elem);
                        /**
                         * 元素element   1
                         * 属性attr    2
                         * 文本text  3
                         * 注释comments 8
                         * 文档document  9
                         * 文档碎片 fragment 11
                         */
                        if (node[0] && (el.nodeType === 1 || el.nodeType === 11 || el.nodeType === 9)) {
                            node[0].insertBefore(el, node[0].firstChild);
                        }

                    }
                });
            }
            return _this;
        },
        create: function (html) {
            var div = null;
            html = _string.create(html).trim();
            if (html.indexOf('<tr') == 0) {
                div = document.createElement('table');
            } 
            else if(html.indexOf('<td') == 0 || html.indexOf('<th') == 0) {
            	div = document.createElement('table');
            	div.appendChild(document.createElement('tr'));
            	div = div.childNodes[0];
            }
            else {
                div = document.createElement('div');
            }
            if (html.match(/^\<t(r|h|d)/) && _browser.ie) {
                _tableInnerHTML(div, html);
            } else {
                div.innerHTML = html;
            }
            /**
             * bug fix
             * 修复了create的链式调用
             * 例如： panda.create("<div>测试节点</div>").appendTo(panda.query("#test"))
             */
            var _dom = require("base.dom");
            return _object._extend(_object.makeArray(div.childNodes), _dom);
        },
        remove: function () {
            var _this = this;
            if (_this.length) {
                _this.each(function (el, index) {
                    if (el.parentNode) {
                        el.parentNode.removeChild(el);
                    }
                });
                _this && _this.splice(0, _this.length);
            }
            return _this;
        },
        empty: function () {
            this.each(function(item) {
				panda(item).html('');
			});
            return this;
        }
    };

    /**
     * 把所有匹配的元素插入到另一个、指定的元素元素集合的后面。
     * @method insertAfter
     * @param {PandaDOM} elem - Panda 对象
     * @returns {PandaDOM}
     * @example
     *          var foo = panda("#foo");
     *          panda("p").insertAfter(foo);
     *          结果:
     *          <div id="foo">Hello</div><p>I would like to say: </p>
     *
     */


    /**
     * 把所有匹配的元素追加到另一个指定的元素元素集合中。
     * 实际上，使用这个方法是颠倒了常规的$(A).append(B)的操作，即不是把B追加到A中，而是把A追加到B中。
     * @method appendTo
     * @param  {PandaDOM} element PandaDOM 对象
     * @returns {PandaDOM}
     * @example
     *      html代码：
     *      <p>I would like to say: </p>
     *      <div id="parent"></div>
     *      代码 ：var parent = panda("#parent");
     *             panda("p").appendTo(parent);结果:
     *             <div id="parent"><p>I would like to say: </p></div>
     *
     */


    /**
     * 向每个匹配的元素内部追加内容。
     * 这个操作与对指定的元素执行appendChild方法，将它们添加到文档中的情况类似。
     * @method append
     * @param {String|PandaDOM} elem - 支持的类型 String, panda对象
     * @returns {object}
     * @example
     *      panda("#id").append("<div>我是Panda</div>");
     *
     */
    function _tableInnerHTML(table, html) {
        if (_browser.ie) {
            var temp = document.createElement('div');
            if(table.tagName == 'TR') {
            	temp.innerHTML = '<table><tbody><tr>' + html + '</tr></tbody></table>';
            	var nodes = temp.firstChild.firstChild.firstChild.childNodes;
            	var array = [];
            	if(nodes && nodes.length > 0) {
            		array = panda.makeArray(nodes);
            	}
            	while(array.length > 0) {
            		var node = array.shift();
            		table.appendChild(node);
            	}
            }
            else {
            	temp.innerHTML = '<table><tbody>' + html + '</tbody></table>';
            	if (table.tagName != 'TR' && table.tBodies.length == 0) {
	                var tbody = document.createElement("tbody");
	                table.appendChild(tbody);
	            }
	            table.replaceChild(temp.firstChild.firstChild, table.tBodies[0]);
            }
        } else {
            table.innerHTML = html;
        }
    }

    /**
     * 根据HTML字符串片段创建DOM对象，支持多个DOM对象的创建
     * @method create
     * @param {String} html - HTML字符串片段
     * @returns {PandaDOM}
     * @example
     *   panda.dom.create("<div>动态创建的节点</div>");
     */


    /**
     * 从DOM中把所有段落删除
     * @method remove
     * @returns {PandaDOM}
     * @example
     *      panda("p").remove();
     *
     */

    function nodeName(elem, name) {
        return elem.nodeName && elem.nodeName.toLowerCase() === name.toLowerCase();
    }

    /**
     * 清空节点内容
     * @method empty
     * @returns {PandaDOM}
     * @example
     * 		panda('<div>I have some contents.</div>').empty();
     * 		// ==> <div></div>
     */

    /**
     * @method _buildFragment 构建文档碎片
     * @param elems
     * @returns {*}
     * @private
     */
    function _buildFragment(elems) {
        var tmp,
            tag,
            i,
            nodes = [],
            L = elems.length,
            safe = _createFragment(document);
        if (elems || elems === 0) {
            if (typeof elems == 'object') {
                if (elems.__type__ && elems.__type__ == 'panda.dom') {
                    safe = elems[0];
                } else {
                    safe = elems;
                }
            }
            else {
                if (!rhtml.test(elems)) {
                    nodes.push(document.createTextNode(elems));
                }
                else {
                    tmp = tmp || safe.appendChild(document.createElement("div"));
                    tmp.innerHTML = elems.replace(rxhtmlTag, "<$1></$2>"); //TODO 来自 jquery 没有明白意思
                    _object.merge(nodes, tmp.childNodes);
                    tmp.textContent = "";
                    while (tmp.firstChild) {
                        tmp.removeChild(tmp.firstChild);
                    }
                    tmp = safe.lastChild;
                    if (tmp) {
                        safe.removeChild(tmp);
                    }
                }
                i = 0;
                while (elems = nodes[i++]) {
                    safe.appendChild(elems);
                }
            }
        }
        return safe;
    }

    function _createFragment(document) {
        var list = nodeNames.split("|"),
            safeFrag = document.createDocumentFragment();

        if (safeFrag.createElement) {
            while (list.length) {
                safeFrag.createElement(
                    list.pop()
                );
            }
        }
        return safeFrag;
    }

    module.exports = Insertion;
})
;
/**
 * 指定节点的全屏坐标
 * author: lizihan <lizihan@jd.com>
 * Date: 13-6-25
 * Time: 17:49
 */
/**
 * @namespace DOM.attributes
 * @constructor
 */
define("base.dom.position", [], function (require, exports, module) {
    var Position = {
        /**
         * 获取匹配的元素相对浏览器窗口 x 和 y 坐标
         * @method position
         * @returns {Object} {x:50 , y:50}
         * @example
         *      var coord = null;
         *      coord = panda.query("#id").position();
         */
        position: function (target) {
            var ua = navigator.userAgent.toLowerCase();
            var isOpera = (ua.indexOf('opera') != -1);
            var isIE = (ua.indexOf('msie') != -1 && !isOpera); // not opera spoof
            var el = target ? target : this[0];
		
			if(el && (el === window || el === document)) {
				return {x:0,y:0,left:0,top:0};
			}

            if (!el || el.parentNode === null || el.style.display == 'none') {
                return {x:0,y:0,left:0,top:0};
            }
            var parent = null;
            var pos = [];
            var box;
            if (el.getBoundingClientRect)    //IE
            {
                box = el.getBoundingClientRect();
                var scrollTop = Math.max(document.documentElement.scrollTop, document.body.scrollTop);
                var scrollLeft = Math.max(document.documentElement.scrollLeft, document.body.scrollLeft);
                return {x: box.left + scrollLeft, y: box.top + scrollTop};
            } else if (document.getBoxObjectFor)    // gecko
            {
                box = document.getBoxObjectFor(el);
                var borderLeft = (el.style.borderLeftWidth) ? parseInt(el.style.borderLeftWidth) : 0;
                var borderTop = (el.style.borderTopWidth) ? parseInt(el.style.borderTopWidth) : 0;
                pos = [box.x - borderLeft, box.y - borderTop];
            } else    // safari & opera
            {
                pos = [el.offsetLeft, el.offsetTop];
                parent = el.offsetParent;
                if (parent != el) {
                    while (parent) {
                        pos[0] += parent.offsetLeft;
                        pos[1] += parent.offsetTop;
                        parent = parent.offsetParent;
                    }
                }
                if (ua.indexOf('opera') != -1 || ( ua.indexOf('safari') != -1 && el.style.position == 'absolute' )) {
                    pos[0] -= document.body.offsetLeft;
                    pos[1] -= document.body.offsetTop;
                }
            }
            if (el.parentNode) {
                parent = el.parentNode;
            } else {
                parent = null;
            }
            while (parent && parent.tagName != 'BODY' && parent.tagName != 'HTML') {
                pos[0] -= parent.scrollLeft;
                pos[1] -= parent.scrollTop;
                if (parent.parentNode) {
                    parent = parent.parentNode;
                } else {
                    parent = null;
                }
            }
            return {x: pos[0], y: pos[1], left: pos[0], top: pos[1]};
        }
    };

    module.exports = Position;
});
/**
 * author: sunqingwei <sunqingwei@jd.com>
 * Date: 13-5-9
 * Time: 上午10:33
 */
/**
 * @namespace DOM.style
 * @constructor
 */
define("base.dom.size", [], function (require, exports, module) {

    var DEFAULT_UNIT = "px", WIDTH = "width", HEIGHT = "height";
    var cssShow = { position: "absolute", visibility: "hidden", display: "block" };
    var rdisplayswap = /^(none|table(?!-c[ea]).+)/;
    var PStyle = require("base.dom.style");

    var Size = {
        width: function (value) {
            if (this.length <= 0)
                return null;
            if (value == undefined) {
                return _get(this[0], WIDTH);
            } else {
                // var _val = parseFloat(value);
                // if (isNaN(_val))
                    // return this;
                // this.each(function (el) {
                    // _set(el, _val, WIDTH);
                // });
                // return this;
                return this.css('width', value);
            }
        },
        height: function (value) {
            if (this.length <= 0)
                return null;
            if (typeof value == "undefined") {
                return _get(this[0], HEIGHT);
            } else {
                // var _val = parseFloat(value);
                // if (isNaN(_val))
                    // return this;
                // this.each(function (el) {
                    // _set(el, _val, HEIGHT);
                // });
                // return this;
                return this.css('height', value);
            }
        },
        innerWidth: function () {
            if (this.length <= 0)
                return null;
            if (arguments.length == 0) {
                return this.width() - _get(this[0], 'borderLeftWidth') - _get(this[0], 'borderRightWidth');
            } else if (arguments.length > 0) {
                var _val = parseFloat(arguments[0]);
                this.width(_val);
                return this;
            }
        },
        innerHeight: function () {
            if (this.length <= 0)
                return null;
            if (arguments.length == 0) {
                return this.height() - _get(this[0], 'borderTopWidth') - _get(this[0], 'borderBottomWidth');
            } else if (arguments.length > 0) {
                var _val = parseFloat(arguments[0]);
                this.height(_val);
                return this;
            }
        },
        outerWidth: function () {
            if (this.length <= 0)
                return null;
            if (arguments.length > 0) {
                var _val = parseFloat(arguments[0]);
                this.width(_val);
                return this;
            } else {
                return this.width() + _get(this[0], 'margin-left') + _get(this[0], 'margin-right');
            }
        },
        outerHeight: function () {
            if (this.length <= 0)
                return null;
            if (arguments.length > 0) {
                var _val = parseFloat(arguments[0]);
                this.height(_val);
                return this;
            } else {
                return this.height() + _get(this[0], 'margin-top') + _get(this[0], 'margin-bottom');
            }
        },
        size: function () {
            return this.length;
        }
    };

	/**
     * 取得第一个匹配元素当前计算的宽度值（px）。
     * @method width
     * @return {Number}
     * @example
     *   panda("#id").width()
     */
    /**
     * 为每个匹配的元素设置CSS宽度(width)属性的值。
     * @method width
     * @param {Number} value - 目标值
     * @return {PandaDOM}
     * @example
     *      panda.query("#id").width(100);
     *
     */

    /**
     * 取得第一个匹配元素当前计算的高度值（px）。
     * @method height
     * @return {Number}
     * @example
     * panda(".className").height()
     */

    /**
     * 为每个匹配的元素设置CSS高度(hidth)属性的值(px)。
     * @method height(val)
     * @param {Number} value - CSS高度的值
     * @returns {PandaDOM}
     * @example
     * panda(".className").height()
     */

    /**
     * 获取第一个匹配元素内部区域宽度（包括补白、不包括边框）。
     * @method innerWidth
     * @returns {number} value
     * @example
     * panda(".className").innerWidth()
     */


    /**
     * 获取第一个匹配元素内部区域高度（包括补白、不包括边框）。
     * @method innerHeight()
     * @returns {Number}
     * @example
     * panda(".className").innerHeight()
     */


    /**
     * 获取第一个匹配元素外部宽度（默认包括补白和边框）。
     * @method outerWidth()
     * @returns {Number}
     * @example
     *    panda(".className").outerWidth()
     */


    /**
     * 获取第一个匹配元素外部高度（默认包括补白和边框）。
     * @method outerHeight
     * @returns {Number}
     * @example
     *    panda(".className").outerHeight()
     *
     */


    /**
     * 获取对象的个数
     * @method size
     * @returns {Number}
     * @example
     *      panda("img").size();
     */


    /**
     * @method _set 设置元素的宽度or高度
     * @param value
     * @private
     */
    function _set(el, value, flag) {
        var style = {};
        style[flag] = value;
        PStyle._setStyle(el,PStyle._transformStyle(style));
        return el;
    }

    /**
     * @method _getWidth 获取元素的宽度
     * @param el
     * @returns {number}
     * @private
     */
    function _get(el, flag) {
        var _val = 0;
        switch (flag) {
            case WIDTH:
            case HEIGHT:
                _val = parseInt(getWidthOrHeight(el, flag));
                break;
            default :
                if (!isNaN(parseInt(PStyle._getStyle(el, flag))))
                    _val = parseInt(PStyle._getStyle(el, flag));
                break;
        }
        return _val;
    }

    /**
     * 特殊处理了 el 元素 隐藏的时候情况
     * @method _getWidthOrHeight
     * @private
     */
    function getWidthOrHeight(els, attributeValue) {
        var value = 0,
            name = attributeValue.toLocaleLowerCase() || null;
        if (panda.isWindow(els)) {
            name = firstIscapitalized(name);
            return els.document.documentElement[ "client" + name ];
        }
        // Get document width or height
        if (els && els.nodeType === 9) {
            doc = els.documentElement;
            name = firstIscapitalized(name);
            return Math.max(
                els.body[ "scroll" + name ], doc[ "scroll" + name ],
                els.body[ "offset" + name ], doc[ "offset" + name ],
                doc[ "client" + name ]
            );
        }
        value = (name === "width") ? els.offsetWidth : els.offsetHeight;
        if (value <= 0 || value == null) {
            if (rdisplayswap.test(panda(els).css("display"))) {
                value = changeElementStyle(els, cssShow, function () {
                    return PStyle._getStyle(els, name);
                });
            } else {
                value = PStyle._getStyle(els, name);
            }
        }
        return value;
    }

    function changeElementStyle(elem, options, callback, args) {
        var ret, name,
            old = {};
        for (name in options) {
            old[ name ] = elem.style[ name ];
            elem.style[ name ] = options[ name ];
        }
        ret = callback.apply(elem, args || []);

        for (name in options) {
            elem.style[ name ] = old[ name ];
        }
        return ret;
    }

    /**
     * 转换首字符为大写
     * @param string
     * @returns {*|XML|string|Node|void|replace}
     */
    function firstIscapitalized(string) {
        return  string.replace(/(^|\s+)\w/g, function (s) {
            return s.toUpperCase();
        });
    }

    panda = panda.merge(panda, Size);
    module.exports = Size;
})
;
/**
 * @namespace DOM.style
 * @constructor
 */
define("base.dom.style", [], function (require, exports, module) {
    var _browser = require("base.system.browser");


    var DEFAULT_UNIT = "px",
        re_unit = /width|height|top|left|right|bottom|margin|padding|marginTop|marginLeft|marginRight|marginBottom|paddingTop|paddingLeft|paddingRight|paddingBottom|fontSize|opacity/i,
        STYLES = {},
        rmsPrefix = /^-ms-/,
        rdashAlpha = /-([\da-z])/gi,
        core_pnum = /[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,
        rnumsplit = new RegExp("^(" + core_pnum + ")(.*)$", "i"),
        rrelNum = new RegExp("^([+-])=(" + core_pnum + ")", "i");

    function fcamelCase(all, letter) {
        return letter.toUpperCase();
    }

    var Style = {
        /**
         * 获取第一个匹配元素的样式属性
         * @method css
         * @param {String} name - 样式属性
         * @returns {String|Number}
         * @example
         *    panda(".className").css("height")
         */

        /**
         * 设置匹配元素的样式属性
         * @method css
         * @param {String} name - 样式属性
         * @param {String|Number} value - 属性值
         * @returns {PandaDOM}
         * @example
         *    panda(".className").css("height",100)
         */

        /**
         * 把一个“名/值对”对象设置为所有匹配元素的样式属性
         * @method css
         * @param {Object} properties - 属性表 比如({ color: "#ff0011", background: "blue" });
         * @returns {PandaDOM}
         * @example
         *    panda(".className").css({ color: "#ff0011", background: "blue" })
         */

        css: function (name, value) {
            if (this.length == 0)return this;
            var _arg = arguments;
            if (_arg.length == 1) {
                var first = _arg[0];
                if (panda.object.isArray(first)) {
                    var returnStyle = {
                    };
                    for (var i = 0, Ln = first.length; i < Ln; i++) {
                        returnStyle[first[i]] = _getStyle(this[0], first[i]);
                    }
                    return returnStyle;
                } else if (typeof first == "object") {
                    STYLES = _transformStyle(first);
                } else if (typeof first == "string") {
                    return _getStyle(this[0], name);
                }
            } else if (_arg.length === 2) {
//			此处第二个参数为何必须为 String ?
//            if (typeof _arg[0] == "string" && typeof _arg[1] == "string") {
                if (typeof _arg[0] == 'string') {
                    var _json = {};
                    if (value !== null)_json[name] = value;
                    STYLES = _transformStyle(_json);
                } else {
                    throw new Error("参数类型错误！！！！");
                }
            }

            this.each(function (el) {
                for (var key in STYLES) {
                    var value = STYLES[key];
                    if (typeof value === "string" && (ret = rrelNum.exec(value))) {
                        value = ( ret[1] + 1 ) * ret[2] + parseFloat(panda.query(el).css(key));
                        if (key !== "opacity") {
                            value += DEFAULT_UNIT;
                        }
                        STYLES[key] = value;
                    }
                }
                _setStyle(el, STYLES);
            });

            return this;
        },
        /**
         * 显示隐藏的匹配元素
         * @method show
         * @returns {PandaDOM}
         */
        show: function () {
            var self = this;
            this.each(function (el) {
                 var item = panda(el);
                if (item.css("display") == "none")
                	item.css("display", (item.data("__oldDisplay__") ? false : item.data("__oldDisplay__")) || "block");
            });
            return this;
        },
        /**
         * 隐藏显示的匹配元素
         * @method hide
         * @returns {Style}
         */
        hide: function () {
            var self = this;
            this.each(function (el) {
                var item = panda(el);
                item.data("__oldDisplay__",item.css("display")=='none'?'':item.css("display"));
                item.css("display", "none");
            });

            return this;
        },
        /**
         * 切换元素的可见状态。如果元素是可见的，切换为隐藏的；如果元素是隐藏的，切换为可见的。
         * @method toggle
         * @returns {PandaDOM}
         */
        toggle: function () {
            this.each(function (el) {
                (_getStyle(el, "display") !== "none") ? _setStyle(el, {display: "none"}) : _setStyle(el, {display: "block"});  //TODO 需要记录节点之前的display
            });
            return this;
        },
        isStyle: function (key) {
            return re_unit.test(key);
        }
    };
    /**
     * @method setStyle 设置元素样式
     * @param el
     * @private
     */
    function _setStyle(el, style) {
        var _styles = style || {};
        for (var key in _styles) {
            var value = _styles[key];
            if (key == 'opacity') {
                if (_browser.ie && parseInt(_browser.version, 10) < 9) {
                    el.style.filter = 'Alpha(Opacity=' + value * 100 + ');';
                } else {
                    el.style.opacity = (value == 1 ? '1' : value);
                }
            } else {
                try {
                    if (key == "width" || key == "height") {
                        el.style[key] = setPositiveNumber(value);
                    } else {
                        el.style[key] = value;
                    }
                } catch (e) {
                }
            }
        }

    }

    function setPositiveNumber(value, subtract) {
        var matches = rnumsplit.exec(value);
        return matches ?
            Math.max(0, matches[ 1 ] - ( subtract || 0 )) + ( matches[ 2 ] || "px" ) :
            value;
    }

    /**
     * @mehod _getStyle 获取样式
     * @param el    目标元素
     * @param namey 样式
     * @private
     */
    function _getStyle(el, name) {
        if (name == 'opacity') {
            if (_browser.ie) {
                var filter = el.style.filter, filterLowerCase = filter.toLowerCase();
                return filter && filterLowerCase.indexOf("opacity=") >= 0 ? parseFloat(filterLowerCase.match(/opacity=([^)]*)/)[1]) / 100 : 1;
            } else {
                return el.style.opacity ? parseFloat(el.style.opacity) : 1;
            }
        } else {
            function hyphenate(name) {
                return name.replace(/[A-Z]/g,
                    function (match) {
                        return '-' + match.toLowerCase();
                    });
            }

            if (window && window.getComputedStyle) {
                return  window.getComputedStyle(el, null) && window.getComputedStyle(el, null).getPropertyValue(hyphenate(name));
            }
            if (document.defaultView && document.defaultView.getComputedStyle) {
                var computedStyle = document.defaultView.getComputedStyle(el, null);
                if (computedStyle) return computedStyle.getPropertyValue(hyphenate(name));
                if (name == "display") return "none";
            }
            if (el.currentStyle) {
                return el.currentStyle[name];
            }
            return el.style[name];
        }
    }

    /**
     * @method transformStyle 转换style
     * @param style
     * @returns {{}}
     * @private
     */
    function _transformStyle(style) {
        var _styles = {};
        for (var key in style) {
            var val = style[key];
            if (key != "opacity" && !isNaN(new Number(val)) && Style.isStyle(key)) {
                val += DEFAULT_UNIT;
            }
            if (key.toLowerCase() == 'float') {
            	if(_browser.ie) {
            		key = 'styleFloat';
            	}else {
            		key = 'cssFloat';
            	}
            }
            if (val !== null)_styles[camelCase(key)] = val;
        }
        return _styles;
    }

    function camelCase(string) {
        return string.replace(rmsPrefix, "ms-").replace(rdashAlpha, fcamelCase);
    }

    module.exports = {
        css: Style.css,
        hide: Style.hide,
        show: Style.show,
        toggle: Style.toggle,
        isStyle: Style.isStyle,
        _getStyle: _getStyle,
        _setStyle: _setStyle,
        _transformStyle: _transformStyle
    };
});
/**
 * author: sunqingwei <sunqingwei@jd.com>
 * Date: 13-5-8
 * Time: 下午1:40
 */
/**
 * @namespace DOM.general
 * @constructor
 */
define("base.dom.traversal", [], function (require, exports, module) {
    /**
     * 保存一些原生的函数
     * @type {*}
     */
    var core_concat = [].concat,
        obj = require("base.object"),
        array = require("base.array");
    /**
     * 获取第一个元素
     * @method first
     * @return {PandaDOM}
     * @example
     * panda.query("li").first();
     *
     */
    var Traversal = {
        first: function () {
            var _this = this;
            var _dom = require("base.dom");
            return obj._extend([_eq(_this, 0)], _dom);
        },
        last: function () {
            var _this = this;
            var _dom = require("base.dom");
            return obj._extend([_eq(_this, -1)], _dom);
        },
        parent: function () {
            var _dom = require("base.dom");
            if (!this[0] || !this[0].parentNode)
                return obj._extend([], _dom, this);
            return obj._extend([this[0].parentNode], _dom, this);
        },
        parents:function(selector) {
        	var _dom = require("base.dom");
        	var matches = [];
        	this.each(function(item) {
        		matches = matches.concat(dir(item, "parentNode"));
        	});
        	
        	matches = panda(matches).unique();
        	
        	if(selector && typeof selector == 'string' && matches.length > 0) {
        		matches = filter(selector, matches);
        	}
        	
        	return obj._extend(matches, _dom);
        },
        next: function () {
            var el = this[0];
            var _dom = require("base.dom");
            var nextSiblings = [];
			if (el) {
				var nextElem = _sibling(el, "nextSibling");
				if(nextElem)
					nextSiblings.push(nextElem);
			}

            return obj._extend(nextSiblings, _dom);
        },
        prev: function () {
            var el = this[0];
            var _dom = require("base.dom");
            var previousSiblings = [];
			if (el) {
				var prevElem = _sibling(el, "previousSibling");
				if(prevElem)
					previousSiblings.push(prevElem);
			}

            return obj._extend(previousSiblings, _dom);
        },
        siblings: function () {
            var _this = this;
            var resultSiblings = map(_this, function (el) {
                return sibling((el.parentNode || {}).firstChild, el);
            });
            var _dom = require("base.dom");
            return obj._extend(resultSiblings, _dom);
        },
        end: function () {
            return this.prevObject || this.constructor(null);
        },

        index: function () {
            return ( this[0] && this[0].parentNode ) ? this.first().prevAll().length : -1;
        },
        prevAll: function () {
            return dir(this[0], "previousSibling");
        },
        find: function () {
            var _param = arguments[0];
            if(this && !this.length) {
                return this;
            }
            var matched = [];
            this.each(function (el){
                matched = matched.concat(panda.query(_param, el));
            });
            var _dom = require("base.dom");
            return obj._extend(matched, _dom);
        },
        eq: function (index) {
        	if(!this.length) {
        		return this;
        	}
        	
            while (index < 0) {
                index = index + this.length;
            }
            if (index > this.length)
                index = this.length - 1;

            var self = this.__last_link__ ? this.__last_link__ : (this.__last_link__ = this);
            var temp = self[index];
            var _dom = require("base.dom");

            var result = obj._extend([temp], _dom);
            result.__last_link__ = self;
            return result;
        },
        is: function (tag) {
            var self = this;
            var tagName = panda.isFunction(tag) ? tag() : tag;
            var i = 0;
            if (!self.length || !tagName)return false;
            for (; i < this.length; i++) {
                
				if (this[i].nodeName == tagName.toLocaleUpperCase())
					return true;

            }
            return false;
        },
        /**
         * 获取该节点下所有子节点（所有层级）
         * @method childrens
         * @example
         *     var childrens = panda('#test').childrens();
         */
        childrens: function () {
            return this.find('*');
        },
        /**
         * 获取该节点下的直接孩子节点（只是向下一层）
         * @method children
         * @example
         *     var children = panda('#test').children();
         */
        children: function () {
            var result = [];
            this.each(function (item, index) {
                result = result.concat(sibling(item.firstChild));
            });
            var _dom = require("base.dom");
            return obj._extend(result, _dom);
        }
    };


    /**
     * 获取最后一个元素
     * @method last
     * @return {PandaDOM}
     * @example
     *      // last() 返回的是封装后的panda array
     *      var pandaNode = panda.query("#id").last();
     *      // 如果要获取原生的dom 节点
     *      if(pandaNode.length != 0 ){
     *          var domNode = pandaNode[0];
     *      }
     */


    /**
     * 获取匹配元素的第一个元素的父亲元素
     * @method parent
     * @return {PandaDOM}
     * @example
     *      // last() 返回的是封装后的panda array
     *      var pandaNode = panda.query("#id").parent();
     *      // 如果要获取原生的dom 节点
     *      if(pandaNode.length != 0 ){
     *          var domNode = pandaNode[0];
     *      }
     */
    
    /**
     * 获取匹配元素的所有父级元素（不包含自身）
     * @method parents
     * @return {PandaDOM}
     * @example
     *      panda('.p-desc').parents(); ==> // 返回所有p-desc元素的父级
     */
    
    /**
     * 获取匹配元素的所有指定父级元素（不包含自身）
     * @method parents
     * @param {String} selector - 通过选择器过滤返回结果
     * @return {PandaDOM}
     * @example
     * 		panda('.p-desc').parents('body') ==> // 返回内容里将只有body
     */


    /**
     * 获取匹配元素集的第一个元素的后一个元素（同级）
     * @method next
     * @return {PandaDOM}
     * @example
     *      // next() 返回的是封装后的panda array
     *      var pandaNode = panda.query("#id").next();
     *      // 如果要获取原生的dom 节点
     *      if(pandaNode.length != 0 ){
     *          var domNode = pandaNode[0];
     *      }
     */


    /**
     * 获取匹配元素集的第一个元素的前一个元素（同级）
     * @method prev
     * @return {PandaDOM}
     * @example
     *      // prev() 返回的是封装后的panda array
     *      var pandaNode = panda.query("#id").prev();
     *      // 如果要获取原生的dom 节点
     *      if(pandaNode.length != 0 ){
     *          var domNode = pandaNode[0];
     *      }
     */


    /**
     * 获取匹配元素同辈元素的元素集合
     * @method siblings
     * @return {PandaDOM}
     * @example
     *      // siblings() 返回的是封装后的panda array
     *      var pandaNode = panda.query("#id").siblings();
     *      // 如果要获取原生的dom 节点
     *      if(pandaNode.length != 0 ){
     *          var domNode = pandaNode[0];
     *      }
     */

    function dir(elem, dir) {
        var matched = [],
            cur = elem[dir];
        while (cur && cur != document) {
            if (cur.nodeType == 1)
                matched.push(cur);
            cur = cur[dir];
        }
        return matched;
    }

    function _eq(target, i) {
        var len = target.length,
            j = +i + ( i < 0 ? len : 0 );
        return target[j];
    }

    function _sibling(cur, dir) {
        do {
            cur = cur[ dir ];
        } while (cur && cur.nodeType !== 1);

        return cur;
    }
    function sibling(n, elem) {
        var r = [];
        for (; n; n = n.nextSibling) {
            if (n.nodeType === 1 && n !== elem) {
                r.push(n);
            }
        }
        return r;
    }
    function map(elems, callback) {
        var value,
            i = 0,
            length = elems.length,
            ret = [];
        if (panda.object.isArray(elems)) {
            for (; i < length; i++) {
                value = callback(elems[i], i);
                if (value != null)ret[ret.length] = value;
            }
        }
        // 使用了query 里面工作了uniqueSort
        return panda.query.uniqueSort(core_concat.apply([], ret));
    }
    function filter(expr, elems, not) {
    	var query = require("base.query");
    	if(not) {
    		expr = ":not("+expr+")";
    	}
    	
    	return query.matches(expr, elems);
    }

    module.exports = Traversal;
});
/**
 * author: sunqingwei <sunqingwei@jd.com>
 * Date: 13-6-18
 * Time: 下午5:54
 */
/**
 * @namespace Event
 */
define("base.event.event", [], function (require, exports, module) {
    var _guid = require("base.util.guid"),
        core_rnotwhite = /\S+/g,
        rformElems = /^(?:input|select|textarea)$/i,
        rkeyEvent = /^key/,
        rmouseEvent = /^(?:mouse|contextmenu)|click/,
        rfocusMorph = /^(?:focusinfocus|focusoutblur)$/,
        rtypenamespace = /^([^.]*)(?:\.(.+)|)$/,
        class2type = {},
        core_deletedIds = [],
        core_strundefined = typeof undefined,
        core_concat = core_deletedIds.concat,
        core_push = core_deletedIds.push,
        core_slice = core_deletedIds.slice,
        core_indexOf = core_deletedIds.indexOf,
        core_toString = class2type.toString,
        core_hasOwn = class2type.hasOwnProperty,
        rmsPrefix = /^-ms-/,
        rdashAlpha = /-([\da-z])/gi,
        fcamelCase = function (all, letter) {
            return letter.toUpperCase();
        };
    var pObject = require("base.object");
    var deleteExpando = true;
    var noDataObject = {
        "embed": true,
        "object": "clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",
        "applet": true
    };

    panda.expandO = panda.version + "-" + _guid();

    var originalRemoveEvent = document.removeEventListener ? function (elem, type, handle) {
        if (elem.removeEventListener) {
            elem.removeEventListener(type, handle, false);
        }
    } : function (elem, type, handle) {
        var name = "on" + type;
        if (elem.detachEvent) {
            if (typeof elem[name] === core_strundefined) {
                elem[name] = null;
            }
            elem.detachEvent(name, handle);
        }
    };

    function makeArray(list) {
        if (!list)
            return;
        var rtn = [], len = list.length;
        for (var i = 0; i < len; i++) {
            rtn.push(list[i]);
        }
        return rtn;
    }

    function nodeName(elem, name) {
        return elem.nodeName && elem.nodeName.toLowerCase() === name.toLowerCase();
    }

    function isEmptyDataObject(obj) {
        var name;
        for (name in obj) {
            if (name === "data" && pObject.isEmptyObject(obj[name])) {
                continue;
            }
            if (name !== "toJSON") {
                return false;
            }
        }
        return true;
    }

    function internalData(elem, name, data, pvt) {
        if (!acceptData(elem)) {
            return;
        }
        var thisCache, ret, internalKey = panda.expandO, getByName = typeof name === "string", isNode = elem.nodeType, cache = isNode ? pandaEvent.cache : elem, id = isNode ? elem[internalKey] : elem[internalKey] && internalKey;
        if ((!id || !cache[id] || (!pvt && !cache[id].data)) && getByName && data === undefined) {
            //return;
        }
        if (!id) {
            if (isNode) {
                elem[internalKey] = id = core_deletedIds.pop() || _guid();
            } else {
                id = internalKey;
            }
        }

        if (!cache[id]) {
            cache[id] = {};
            if (!isNode && id) {
                cache[id].toJSON = function () {
                };
            }
        }
        if (typeof name === "object" || typeof name === "function") {
            if (pvt) {
                cache[id] = panda.object.merge(cache[id], name);
            } else {
                cache[id].data = panda.object.merge(cache[id].data, name);
            }
        }

        thisCache = cache[id];
        if (!pvt) {
            if (!thisCache.data) {
                thisCache.data = {};
            }
            thisCache = thisCache.data;
        }

        if (data !== undefined) {
            thisCache[ camelCase(name)] = data;
        }
        if (getByName) {
            ret = thisCache[name];
            if (ret == null) {
                ret = thisCache[ camelCase(name)];
            }
        } else {
            ret = thisCache;
        }

        return ret;
    }

    function internalRemoveData(elem, name, pvt) {
        if (!acceptData(elem))
            return;
        var i, l, thisCache, isNode = elem.nodeType, cache = isNode ? pandaEvent.cache : elem, id = isNode ? elem[panda.expandO] : panda.expandO;
//        if (!cache[id])return;
        if (name) {
            thisCache = pvt ? cache[id] : cache[id].data;
            if (thisCache) {
                if (!pObject.isArray(name)) {
                    if (name in thisCache) {
                        name = [name];
                    } else {
                        name = camelCase(name);
                        if (name in thisCache) {
                            name = [name];
                        } else {
                            name = name.split(" ");
                        }
                    }
                } else {
                    // 主要处理 name 是array 情况
                }

                for (i = 0, l = name.length; i < l; i++) {
                    delete thisCache[name[i]];
                }
                if (!( pvt ? isEmptyDataObject : pObject.isEmptyObject )(thisCache)) {
                    return;
                }
            }
        }
        if (!pvt) {
            delete cache[id].data;
            if (!isEmptyDataObject(cache[id])) {
                return;
            }
        }
        if (isNode) {
            cleanData([elem], true);
        } else if (deleteExpando || cache != cache.window) {
            delete cache[id];
        } else {
            cache[id] = null;
        }
    }

    function _removeData(elem, name) {
        return internalRemoveData(elem, name, true);
    }

    function acceptData(elem) {
        if (elem.nodeType && elem.nodeType !== 1 && elem.nodeType !== 9) {
            return false;
        }
        var noData = elem.nodeName && noDataObject[ elem.nodeName.toLowerCase()];
        return !noData || noData !== true && elem.getAttribute("classid") === noData;
    }

    function cleanData(elems, acceptData) {
        var elem, type, id, data, i = 0, internalKey = panda.expandO, cache = pandaEvent.cache, deleteExpando = true, special = pandaEvent.special;

        for (; ( elem = elems[i]) != null; i++) {
            if (acceptData || acceptData(elem)) {
                id = elem[internalKey];
                data = id && cache[id];
                if (data) {
                    if (data.events) {
                        for (type in data.events) {
                            if (special[type]) {
                                pandaEvent.remove(elem, type);
                            } else {
                                originalRemoveEvent(elem, type, data.handle);
                            }
                        }
                    }
                    if (cache[id]) {
                        delete cache[id];
                        if (deleteExpando) {
                        	try {
                            	delete elem[internalKey];
                            }catch(errx) {
                            	elem[internalKey] = null;
                            }
                        } else if (typeof elem.removeAttribute !== core_strundefined) {
                            elem.removeAttribute(internalKey);
                        } else {
                            elem[internalKey] = null;
                        }
                        core_deletedIds.push(id);
                    }
                }
            }
        }
    }

    function camelCase(string) {
        return string.replace(rmsPrefix, "ms-").replace(rdashAlpha, fcamelCase);
    }

    /**
     *  事件处理
     * @type {{}}
     * @private
     */
    var pandaEvent = {
        cache: {},
        global: {},
        props: "altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),
        fixEventType: function (types) {
            var _types = (types || "").match(core_rnotwhite) || [""],
                i = 0;
            if (_types.join(" ").indexOf("mousewheel") >= 0) {
                _types.push("DOMMouseScroll");
            }

            return _types;
        },
        add: function (elem, types, handler, data, selector) {
            var tmp,
                events,
                t,
                handleObjIn,
                special,
                eventHandle,
                handleObj,
                handlers,
                type,
                namespaces,
                origType,
                elemData = internalData(elem, undefined, undefined, true),
                types,
                fixType;

            if (!handler.guid) {
                handler.guid = _guid();
            }
            if (!elemData) {
                elemData = {};
            }
            if (!( events = elemData.events)) {
                events = elemData.events = {};
            }
            if (!( eventHandle = elemData.handle)) {
                elemData.handle = eventHandle = function (e) {
                    if (window && window.ued_config && window.ued_config.development == 'online') {
                        try {
                            if (typeof panda !== core_strundefined && (!e || panda.event.triggered !== e.type)) {
                                return pandaEvent.dispatch.apply(eventHandle.elem, arguments);
                            } else {
                                return undefined;
                            }
                        } catch (e) {
                            panda.stack.extractStacktrace(e, 1);
                        }
                    } else {
                        if (typeof panda !== core_strundefined && (!e || panda.event.triggered !== e.type)) {
                            return pandaEvent.dispatch.apply(eventHandle.elem, arguments);
                        } else {
                            return undefined;
                        }
                    }

                };
                eventHandle.elem = elem;
            }
            types = pandaEvent.fixEventType(types);

            t = types.length;
            while (t--) {
                tmp = rtypenamespace.exec(types[t]) || [];
                type = origType = tmp[1];
                namespaces = (tmp[2] || "" ).split(".").sort();
                special = pandaEvent.special[type] || {};
                type = ( selector ? special.delegateType : special.bindType ) || type;
                if (type == "mouseleave") {
                    type = "mouseout";
                }
                if (type == "mouseenter") {
                    type = "mouseover";
                }

                handleObj = panda.object.merge({
                    type: type,
                    origType: origType,
                    data: data,
                    handler: handler,
                    guid: handler.guid,
                    selector: selector,
                    needsContext: selector && panda.query.selectors.match.needsContext.test(selector),
                    namespace: namespaces.join(".")
                }, handleObjIn);
                if (!( handlers = events[type])) {
                    handlers = events[type] = [];
                    handlers.delegateCount = 0;

                    if (elem.addEventListener) {
                        elem.addEventListener(type, eventHandle, false);
                    } else if (elem.attachEvent) {
                        elem.attachEvent("on" + type, eventHandle);
                    }
                }

                if (selector) {
                    handlers.splice(handlers.delegateCount++, 0, handleObj);
                } else {
                    handlers.push(handleObj);
                }
                pandaEvent.global[type] = true;
            }
            elem = null;

        },
        remove: function (elem, types, handler, selector, mappedTypes) {
            var j, handleObj, tmp, origCount, t, events, special, handlers, type, namespaces, origType, elemData = internalData(elem, undefined, undefined, true);

            if (!elemData || !( events = elemData.events)) {
                return;
            }
            types = (types || "" ).match(core_rnotwhite) || [""];
            t = types.length;
            while (t--) {
                tmp = rtypenamespace.exec(types[t]) || [];
                type = origType = tmp[1];
                namespaces = (tmp[2] || "" ).split(".").sort();
                if (!type) {
                    for (type in events) {
                        pandaEvent.remove(elem, type + types[t], handler, selector, true);
                    }
                    continue;
                }

                special = pandaEvent.special[type] || {};
                type = ( selector ? special.delegateType : special.bindType ) || type;
                handlers = events[type] || [];
                tmp = tmp[2] && new RegExp("(^|\\.)" + namespaces.join("\\.(?:.*\\.|)") + "(\\.|$)");
                origCount = j = handlers.length;
                while (j--) {
                    handleObj = handlers[j];
                    if ((mappedTypes || origType === handleObj.origType ) && (!handler || handler.guid === handleObj.guid ) && (!tmp || tmp.test(handleObj.namespace) ) && (!selector || selector === handleObj.selector || selector === "**" && handleObj.selector )) {
                        handlers.splice(j, 1);
                        if (handleObj.selector) {
                            handlers.delegateCount--;
                        }
                        if (special.remove) {
                            special.remove.call(elem, handleObj);
                        }
                    }
                }
                if (origCount && !handlers.length) {
                    if (!special.teardown || special.teardown.call(elem, namespaces, elemData.handle) === false) {
                        originalRemoveEvent(elem, type, elemData.handle);
                    }
                    delete events[type];
                }
            }
            if (pObject.isEmptyObject(events)) {
                delete elemData.handle;
                _removeData(elem, "events");
            }
        },
        trigger: function (event, data, elem, onlyHandlers) {
            var handle, ontype, cur, bubbleType, special, tmp, i, eventPath = [elem || document], type = core_hasOwn.call(event, "type") ? event.type : event, namespaces = core_hasOwn.call(event, "namespace") ? event.namespace.split(".") : [];

            cur = tmp = elem = elem || document;
            if (elem.nodeType === 3 || elem.nodeType === 8) {
                return;
            }
            if (rfocusMorph.test(type + panda.event.triggered)) {
                return;
            }

            if (type.indexOf(".") >= 0) {
                namespaces = type.split(".");
                type = namespaces.shift();
                namespaces.sort();
            }
            ontype = type.indexOf(":") < 0 && "on" + type;
            event = event[panda.expandO] ? event : new Event(type, typeof event === "object" && event);

            event.isTrigger = true;
            event.namespace = namespaces.join(".");
            event.namespace_re = event.namespace ? new RegExp("(^|\\.)" + namespaces.join("\\.(?:.*\\.|)") + "(\\.|$)") : null;
            event.result = undefined;
            if (!event.target) {
                event.target = elem;
            }
            data = data == null ? [event] : makeArray(data, [event]);

            special = pandaEvent.special[type] || {};
            if (!onlyHandlers && special.trigger && special.trigger.apply(elem, data) === false) {
                return;
            }
            if (!onlyHandlers && !special.noBubble && !pObject.isWindow(elem)) {
                bubbleType = special.delegateType || type;
                if (!rfocusMorph.test(bubbleType + type)) {
                    cur = cur.parentNode;
                }
                for (; cur; cur = cur.parentNode) {
                    eventPath.push(cur);
                    tmp = cur;
                }
                if (tmp === (elem.ownerDocument || document)) {
                    eventPath.push(tmp.defaultView || tmp.parentWindow || window);
                }
            }
            i = 0;
            while (( cur = eventPath[i++]) && !event.isPropagationStopped()) {

                event.type = i > 1 ? bubbleType : special.bindType || type;
                handle = ( internalData(cur, "events", undefined, true) || {} )[event.type] && internalData(cur, "handle", undefined, true);
                if (handle) {
                    handle.apply(cur, data);
                }
                handle = ontype && cur[ontype];
                if (handle && acceptData(cur) && handle.apply && handle.apply(cur, data) === false) {
                    event.preventDefault();
                }
            }
            event.type = type;
            if (!onlyHandlers && !event.isDefaultPrevented()) {

                if ((!special._default || special._default.apply(elem.ownerDocument, data) === false) && !(type === "click" && nodeName(elem, "a")) && acceptData(elem)) {
                    if (ontype && elem[type] && !pObject.isWindow(elem)) {
                        tmp = elem[ontype];
                        if (tmp) {
                            elem[ontype] = null;
                        }
                        panda.event.triggered = type;
                        try {
                            elem[ type ]();
                        } catch (e) {
                        }
                        panda.event.triggered = undefined;
                        if (tmp) {
                            elem[ontype] = tmp;
                        }
                    }
                }
            }

            return event.result;
        },
        dispatch: function (event) {
            if (!event) {
                return undefined;
            }

            event = pandaEvent.fix(event);

            var i, ret, handleObj, matched, j, handlerQueue = [], args = core_slice.call(arguments);
            var handlers = ( internalData(this, "events", undefined, true) || {} )[event.type] || [], special = pandaEvent.special[event.type] || {};

            args[0] = event;
            event.delegateTarget = this;

            if (special.preDispatch && special.preDispatch.call(this, event) === false) {
                return;
            }
            handlerQueue = pandaEvent.handlers.call(this, event, handlers);
            i = 0;
            while (( matched = handlerQueue[i++]) && !event.isPropagationStopped()) {
                event.currentTarget = matched.elem;
                j = 0;
                while (( handleObj = matched.handlers[j++]) && !event.isImmediatePropagationStopped()) {
                    if (!event.namespace_re || event.namespace_re.test(handleObj.namespace)) {

                        event.handleObj = handleObj;
                        event.data = handleObj.data;

                        if (handleObj.selector) {
                            panda(handleObj.selector, this).each(function (el) {
                                if (handleObj.origType == "mouseleave" || handleObj.origType == "mouseenter") {
                                    if(handleObj.origType == "mouseenter"){
                                        if(el === event.target || panda.query.contains(el,event.target)){
                                            ret = ((pandaEvent.special[handleObj.origType] || {}).handle || handleObj.handler ).apply(matched.elem, args);
                                        }
                                    }else{
                                        if(!panda.query.contains(el,event.relatedTarget)){
                                            ret = ((pandaEvent.special[handleObj.origType] || {}).handle || handleObj.handler ).apply(matched.elem, args);
                                        }
                                    }
                                } else {
                                    if (el === matched.elem)ret = ((pandaEvent.special[handleObj.origType] || {}).handle || handleObj.handler ).apply(matched.elem, args);
                                }
                            });
                        } else {
                            if (handleObj.origType == "mouseleave" || handleObj.origType == "mouseenter") {
                                if(handleObj.origType == "mouseenter"){
                                    if(matched.elem === event.target || panda.query.contains(matched.elem,event.target)){
                                        ret = ((pandaEvent.special[handleObj.origType] || {}).handle || handleObj.handler ).apply(matched.elem, args);
                                    }
                                }else{
                                    if(!panda.query.contains(matched.elem,event.relatedTarget)){
                                        ret = ((pandaEvent.special[handleObj.origType] || {}).handle || handleObj.handler ).apply(matched.elem, args);
                                    }
                                }
                            }else{
                                ret = ((pandaEvent.special[handleObj.origType] || {}).handle || handleObj.handler ).apply(matched.elem, args);
                            }
                        }

                        if (ret !== undefined) {
                            if ((event.result = ret) === false) {
                                event.preventDefault();
                                event.stopPropagation();
                            }
                        }
                    }
                }
            }
            if (special.postDispatch) {
                special.postDispatch.call(this, event);
            }

            return event.result;
        },
        /**
         * 把 native event object 转换成 panda event
         * @method fix
         * @param event
         * @private
         */
        fix: function (event) {
            if (event[panda.expand]) {
                return event;
            }
            // 统一event 各项属性
            var i, prop, copy, originalEvent = event, type = event.type, fixHook = pandaEvent.fixHooks[type];
            if (!fixHook) {
                pandaEvent.fixHooks[type] = fixHook = rmouseEvent.test(type) ? pandaEvent.mouseHooks : rkeyEvent.test(type) ? pandaEvent.keyHooks : {};
            }
            copy = fixHook.props ? pandaEvent.props.concat(fixHook.props) : pandaEvent.props;
            event = new Event(originalEvent);
            i = copy.length;
            while (i--) {
                prop = copy[i];
                event[prop] = originalEvent[prop];
            }
            if (!event.target) {
                event.target = originalEvent.srcElement || document;
            }

            if (event.target.nodeType === 3) {
                event.target = event.target.parentNode;
            }
            event.metaKey = !!event.metaKey;
            return fixHook.filter ? fixHook.filter(event, originalEvent) : event;
        },
        fixHooks: {},

        keyHooks: {
            props: "char charCode key keyCode".split(" "),
            filter: function (event, original) {

                // Add which for key events
                if (event.which == null) {
                    event.which = original.charCode != null ? original.charCode : original.keyCode;
                }

                return event;
            }
        },
        mouseHooks: {
            props: "button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),
            filter: function (event, original) {
                var body, eventDoc, doc, button = original.button, fromElement = original.fromElement;
                if (event.pageX == null && original.clientX != null) {
                    eventDoc = event.target.ownerDocument || document;
                    doc = eventDoc.documentElement;
                    body = eventDoc.body;

                    event.pageX = original.clientX + (doc && doc.scrollLeft || body && body.scrollLeft || 0 ) - (doc && doc.clientLeft || body && body.clientLeft || 0 );
                    event.pageY = original.clientY + (doc && doc.scrollTop || body && body.scrollTop || 0 ) - (doc && doc.clientTop || body && body.clientTop || 0 );
                }

                if (!event.relatedTarget && fromElement) {
                    event.relatedTarget = fromElement === event.target ? original.toElement : fromElement;
                }

                if (!event.which && button !== undefined) {
                    event.which = (button & 1 ? 1 : (button & 2 ? 3 : (button & 4 ? 2 : 0 ) ) );
                }

                return event;
            }
        },
        special: {
            load: {
                noBubble: true
            },
            click: {
                trigger: function () {
                    if (nodeName(this, "input") && this.type === "checkbox" && this.click) {
                        this.click();
                        return false;
                    }
                }
            },
            focus: {
                trigger: function () {
                    if (this !== document.activeElement && this.focus) {
                        try {
                            this.focus();
                            return false;
                        } catch (e) {
                        }
                    }
                },
                delegateType: "focusin"
            },
            blur: {
                trigger: function () {
                    if (this === document.activeElement && this.blur) {
                        this.blur();
                        return false;
                    }
                },
                delegateType: "focusout"
            },

            beforeunload: {
                postDispatch: function (event) {
                    if (event.result !== undefined) {
                        event.originalEvent.returnValue = event.result;
                    }
                }
            }
        },
        handlers: function (event, handlers) {
            var sel, handleObj, matches, i, handlerQueue = [], delegateCount = handlers.delegateCount, cur = event.target;
            if (delegateCount && cur.nodeType && (!event.button || event.type !== "click")) {
                for (; cur != this; cur = cur.parentNode || this) {
                    if (cur.nodeType === 1 && (cur.disabled !== true || event.type !== "click")) {
                        matches = [];
                        for (i = 0; i < delegateCount; i++) {
                            handleObj = handlers[i];
                            sel = handleObj.selector + " ";
                            if (matches[sel] === undefined) {
                                matches[sel] = handleObj.needsContext ? panda(sel, this).index(cur) >= 0 : panda(this).find(sel).length;
                            }
                            if (matches[sel]) {
                                matches.push(handleObj);
                            }
                        }
                        if (matches.length) {
                            handlerQueue.push({
                                elem: cur,
                                handlers: matches
                            });
                        }
                    }
                }
            }

            if (delegateCount < handlers.length) {
                handlerQueue.push({
                    elem: this,
                    handlers: handlers.slice(delegateCount)
                });
            }

            return handlerQueue;
        }
    };

    function nodeName(elem, name) {
        return elem.nodeName && elem.nodeName.toLowerCase() === name.toLowerCase();
    }

    function returnFalse() {
        return false;
    }

    function returnTrue() {
        return true;
    }

    function Event(src, props) {
        if (!(this instanceof Event)) {
            return new Event(src, props);
        }
        if (src && src.type) {
            this.originalEvent = src;
            this.type = src.type;
            this.isDefaultPrevented = (src.defaultPrevented || src.returnValue === false || src.getPreventDefault && src.getPreventDefault() ) ? returnTrue : returnFalse;
        } else {
            this.type = src;
        }
        if (props) {
            panda.object.merge(this, props);
        }
        this.timeStamp = src && src.timeStamp || (new Date()).getTime();

        this[panda.expandO] = true;
    }


    Event.prototype = {
        isDefaultPrevented: returnFalse,
        isPropagationStopped: returnFalse,
        isImmediatePropagationStopped: returnFalse,
        preventDefault: function () {
            var e = this.originalEvent;
            this.isDefaultPrevented = returnTrue;
            if (!e) {
                return;
            }
            if (e.preventDefault) {
                e.preventDefault();
            } else {
                e.returnValue = false;
            }
        },
        stopPropagation: function () {
            var e = this.originalEvent;
            this.isPropagationStopped = returnTrue;
            if (!e) {
                return;
            }
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            e.cancelBubble = true;
        }
    };

    /**
     * @method off 删除事件
     * @param types
     * @param selector
     * @param fn
     * @returns {*}
     * @private
     */
    function off(elem, types, selector, fn) {
        var handleObj, type;
        if (typeof types === "object") {
            for (type in types) {
                off(type, selector, types[type]);
            }
            return this;
        }
        if (selector === false || typeof selector === "function") {
            fn = selector;
            selector = undefined;
        }
        if (fn === false) {
            fn = returnFalse;
        }
        pandaEvent.remove(elem, types, fn, selector);
    }

    var exports = {
        /**
         * 绑定事件
         * @method on
         * @param {String} types - 事件类型比如：click
         * @param {String|Object} data - 数据
         * @param {Function} fn - 回调函数
         * @returns {PandaDOM}
         * @example
         *      panda("#id").on("click",function({
	     *          // do something
	     *      })
         */
        on: function (types, data, fn, selector) {
            var type, origFn;
            if (typeof types === "object") {
                for (type in types) {
                    this.on(type, data, types[type], one);
                }
                return this;
            }
            if (data == null && fn == null) {
            } else if (fn == null) {
                fn = data;
            }
            if (fn === false) {
            } else if (!fn) {
                return this;
            }
            this.each(function (el) {
                pandaEvent.add(el, types, fn, data, selector);
            });
            return this;
        },
        /**
         * 事件代理函数
         * @method on
         * @param {String} selector - 被代理事件的元素选择器
         * @param {String} types - 事件类型，比如：click
         * @param {Function} fn - 回调函数
         * @returns {PandaDOM}
         * @example
         *      panda("ul").delegate("li", "mouseover", function() {
	     *          // do something
	     *      })
         */
        delegate: function (selector, types, data, fn) {
            return this.on(types, data, fn, selector);
        },
        /**
         * 绑定事件
         * @method bind
         * @param {String} types - 事件类型比如：click
         * @param {String|Object} data - 数据
         * @param {Function} fn - 回调函数
         * @returns {PandaDOM}
         * @example
         *      panda("#id").bind("click",function({
         *          // do something
         *      })
         */
        bind: function (types, data, fn) {
            return this.on(types, data, fn);
        },
        /**
         * 取消事件绑定
         * @method un
         * @param {String} types - 事件类型
         * @param {Function} fn - 事件回调函数
         * @return {PandaDOM}
         * @example
         *      // 取消click事件
         *      panda("#id").un("click");
         *      // 删除特定函数 （fun）
         *      panda("#id").un("click",funName);
         */
        un: function (types, fn) {
            this.each(function (el) {
                off(el, types, null, fn);
            });
            return this;
        },
        /**
         * 取消事件代理函数
         * @method on
         * @param {String} selector - 被代理事件的元素选择器
         * @param {String} types - 事件类型，比如：click
         * @param {Function} fn - 待取消的函数
         * @returns {PandaDOM}
         * @example
         *      panda("ul").delegate("li", "mouseover", function() {
	     *          // do something
	     *      })
         */
        undelegate: function (selector, types, fn) {
            return this.un(types, fn, selector);
        },
        /**
         * 取消事件绑定
         * @method unbind
         * @param {String} types - 事件类型
         * @param {Function} fn - 事件回调函数
         * @return {PandaDOM}
         * @example
         *      // 取消click事件
         *      panda("#id").unbind("click");
         *      // 删除特定函数 （fun）
         *      panda("#id").unbind("click",fun);
         */
        unbind: function (types, fn) {
            this.each(function (el) {
                off(el, types, null, fn);
            });
            return this;
        },
        /**
         * 在每一个匹配的元素上触发某类事件
         * @method fire
         * @param {String} type - 事件类型
         * @param {String|Object} data - 数据
         * @returns {PandaDOM}
         * @example
         *      panda("#id").fire("click")
         *      // obj 可以是任何对象，eventType 可以是任何事件类型，也可以直接自定义的事件类型
         *      panda(obj).fire(eventType)
         *      // 触发自定义事件类型
         *      function List(){
         *          this.UPDATA_EVENT = "update"
         *      }
         *
         *      List.prototype.update = function(){
         *          var self = this;
         *          panda(self).fire(self.UPDATA_EVENT);
         *      }
         *
         *      // 使用方式
         *      var list = new List();
         *      panda(list).on(list.UPDATA_EVENT,function(){
         *          alert("列表更新");
         *      })
         *      list.update();
         */
        fire: function (type, data) {
            return this.each(function (el) {
                pandaEvent.trigger(type, data, el);
            });
        },
        /**
         * 在每一个匹配的元素上触发某类事件
         * @method trigger
         * @param {String} type - 事件类型
         * @param {String|Object} data - 数据
         * @returns {PandaDOM}
         * @example
         *      panda("#id").trigger("click")
         */
        trigger: function (type, data) {
            return this.each(function (el) {
                if (type == 'mousewheel' && document.mozHidden !== undefined) {
                    type = "DOMMouseScroll";
                }
                pandaEvent.trigger(type, data, el);
            });
        },
        Event: Event
    };

    // 事件扩展
    var extendEvents = ("blur focus focusin focusout load resize scroll unload click dblclick " +
        "mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave " +
        "change select submit keydown keypress keyup error contextmenu").split(" ");

    for (var i = 0; i < extendEvents.length; i++) {
        (function (name) {
            exports[name] = function (data, fn) {
                return arguments.length > 0 ?
                    this.on(name, data, fn) :
                    this.trigger(name);
            };
        })(extendEvents[i]);
    }

    module.exports = exports;
});
define("base.string.bytesLength", [], function (require, exports, module) {
	var _obj = require("base.object");
	var _str = require("base.string.class");
	
	module.exports = {
		bytesLength:function() {
			var value = arguments[0];
			var self = value;
			
			if(typeof this == "object" && this.__type__ == "panda.string") {
				self = this;
			}
			if(typeof value == 'string' || (!isNaN(value) && typeof value == 'number')) {
				self = _obj.merge(new String(value), _str);
			}
			
			if(!self || !self.length) {
				return 0;
			}
			
			var regex = self.match(/[^\x00-\xff]/g);
			return (self.length + (!regex?0:regex.length));
		}
	};
});
/**
 * 提供更高级的字符串使用方式，并添加中文字符相关处理，注意：该系列方法的返回值均为String对象(typeof的值为object)，而非简单字符串对象(typeof值为string)
 * @namespace Core.string
 * @constructor
 */
define("base.string.class", [], function(require,exports,module){
	var _obj = require("base.object");
	
	/**
     * 用于提取字符串中介于两个指定下标之间的字符，该方法是根据字符的字节长度进行截取
     * @pc
     * @method cut
     * @param {String} value "" 待提取的字符串内容
     * @param {Number} start - 一个非负的整数，规定要提取的子串的第一个字符在指定字符串中的字节长度位置
     * @param {Number} end - 一个非负的整数，比要提取的子串的最后一个字符在字符串中的字节长度位置多 1
     * @returns {PandaString}
     * @example
     *      panda.string.cut("一二三四1234", 0, 10); // ==> "一二三四12"
     */
    /**
     * 用于提取字符串中介于两个指定下标之间的字符，该方法是根据字符的字节长度进行截取
     * @pc
     * @method cut
     * @param {Number} start - 一个非负的整数，规定要提取的子串的第一个字符在指定字符串中的字节长度位置
     * @param {Number} end - 一个非负的整数，比要提取的子串的最后一个字符在字符串中的字节长度位置多 1
     * @returns {PandaString}
     * @example
     * 		panda.string.create('一二三四1234').cut(0, 10); // ==> "一二三四12"
     */
	function cut() {
		
	}
	
	/**
     * 获取字符串的字节长度
     * @pc
     * @method bytesLength
     * @param {String} value "" 待统计的字符串内容
     * @returns {Number}
     * @example
     *      panda.string.bytesLength("12一二"); // ==> 6
     */
    /**
     * 获取字符串的字节长度
     * @method bytesLength
     * @returns {Number}
     * @example
     *      panda.string.create("12一二").bytesLength(); // ==> 6
     */
	function bytesLength() {
		
	}
	
	/**
     * 从左侧按字节数截取，该方法为cut方法的简单版本
     * @pc
     * @method leftBytes
     * @param {String} value "" 待截取的字符串内容
     * @param {Number} left - 一个非负整数，该数表示从0至该数的字节将被截取
     * @returns {PandaString}
     * @example
     *      panda.string.leftBytes("12一二", 4); // ==> "12一"
     */
    /**
     * 从左侧按字节数截取，该方法为cut方法的简单版本
     * @pc
     * @method leftBytes
     * @param {Number} left - 一个非负整数，该数表示从0至该数的字节将被截取
     * @returns {PandaString}
     * @example
     *      panda.string.create("12一二").leftBytes(4); // ==> "12一"
     */
	function leftBytes() {
		
	}
	
	/**
     * 将字符串中的全角字符转换为半角字符
     * @pc
     * @method dbcToSbc
     * @param {String} value "" 待转换的字符串内容
     * @returns {PandaString}
     * @example
     *      panda.string.dbcToSbc("，。："); // ==> ",。:"
     */
    /**
     * 将字符串中的全角字符转换为半角字符
     * @pc
     * @method dbcToSbc
     * @returns {PandaString}
     * @example
     *      panda.string.create("，。")dbcToSbc(); // ==> ",."
     */
	function dbcToSbc() {
		
	}
	
	/**
     * 将字符串中的首尾空格进行过滤，被判断为空格的字符有半角空格，全角空格，制表符
     * @pc
     * @method trim
     * @param {String} value "" 待过滤的字符串内容
     * @returns {PandaString}
     * @example
     *      panda.string.trim(" 1 2 3 4 5 "); // ==> "12345"
     */
    /**
     * 将字符串中的首尾空格进行过滤，被判断为空格的字符有半角空格，全角空格，制表符
     * @method trim
     * @returns {PandaString}
     * @example
     *      panda.string.create(" 1 2 3 4 5 ")trim(); // ==> "12345"
     */
    /**
     * 将字符串中的首尾空格进行过滤，并将字符串中间的连续空格过滤为单个空格，被判断为空格的字符有半角空格，全角空格，制表符
     * @pc
     * @method trim
     * @param {String} value "" 待过滤的字符串内容
     * @param {Boolean} noMore false 是否过滤中间空格
     * @returns {PandaString}
     * @example
     *      panda.string.trim(" 1  2 3    4   5  ", true); // ==> "1 2 3 4 5"
     */
    /**
     * 将字符串中的首尾空格进行过滤，并将字符串中间的连续空格过滤为单个空格，被判断为空格的字符有半角空格，全角空格，制表符
     * @method trim
     * @param {Boolean} noMore false 是否过滤中间空格
     * @returns {PandaString}
     * @example
     *      panda.string.create(" 1  2 3    4   5  ").trim(true); // ==> "1 2 3 4 5"
     */
	function trim() {
		
	}
	
	var string = {
		cut:cut,
		bytesLength:bytesLength,
		leftBytes:leftBytes,
		dbcToSbc:dbcToSbc,
		trim:trim
	};

	exports = _obj._extend(new String(""), string);
	
    return exports;
});
define("base.string.cut", [], function (require, exports, module) {
	var _obj = require("base.object");
	var _str = require("base.string.class");
	
	module.exports = {
		cut:function() {
			var self = arguments[0];
			var start = 0;
			var end = -1;
			
			if(typeof self == 'string') {
				self = _obj.merge(new String(self), _str);
				start = arguments[1]*1 || 0;
				if(typeof arguments[2] != 'undefined') {
					end = arguments[2] * 1;
				}else {
					end = self.bytesLength();
				}
			}
			else if(typeof this == "object" && this.__type__ == "panda.string") {
				self = this;
				start = arguments[0]*1 || 0;
				if(typeof arguments[1] != 'undefined') {
					end = arguments[1] * 1;
				}else {
					end = self.bytesLength();
				}
			}
			
			var count = 0;
			var unicode = 0;
			var result = '';
			var length = self.length;
			var blength = self.bytesLength();
			
			if(start<0)
				start = blength + start;
			
			while(end<0 && blength > 0) {
				end = blength + end;
			}
			
			for(var i=0;i<length;i++) {
				if(count >= start) {
					break;
				}
				unicode = self.charCodeAt(i);
				if(unicode < 127)
					count += 1;
				else
					count += 2;
			}
			
			for(;i < length; i++) {
				if(count >= end)
					break;
					
				unicode = self.charCodeAt(i);
				if(unicode < 127)
					count += 1;
				else
					count += 2;
					
				result += self.charAt(i);
			}
			
			return _obj.merge(new String(result), _str);
		}
	};
});
define("base.string.dbcToSbc", [], function (require, exports, module) {
	var _obj = require("base.object");
	var _str = require("base.string.class");
	
	module.exports = {
		dbcToSbc:function() {
			var value = arguments[0];
			var self = value;
			
			if(typeof this == "object" && this.__type__ == "panda.string") {
				self = this;
			}
			
			if(typeof value == 'string' || (!isNaN(value) && typeof value == 'number')) {
				self = _obj.merge(new String(value), _str);
			}
			
			if(!self) {
				return "";
			}
			
			var result = self.replace(/[\uff01-\uff5e]/g, function(c) {
				return String.fromCharCode(c.charCodeAt(0) - 65248);
			}).replace(/\u3000/g, ' ');
			
			return _obj.merge(new String(result), _str);
		}
	};
});
define("base.string.leftBytes", [], function (require, exports, module) {
	var _obj = require("base.object");
	var _str = require("base.string.class");
	
	module.exports = {
		leftBytes:function() {
			var self = arguments[0];
			var length = 0;
			
			if(typeof self == 'string') {
				self = _obj.merge(new String(self), _str);
				if(typeof arguments[1] == 'undefined') {
					length = self.bytesLength();
				}else {
					length = arguments[1]*1 || 0;
				}
			}
			else if(typeof this == "object" && this.__type__ == "panda.string") {
				self = this;
				if(typeof arguments[0] == 'undefined') {
					length = self.bytesLength();
				}else {
					length = arguments[0]*1 || 0;
				}
			}
			
			if(!self) {
				return "";
			}
			
			while(length < 0 && self.length > 0) {
				length += self.bytesLength();
			}
			
			var temp = self.replace(/\*/g, " ").replace(/[^\x00-\xff]/g, '**');
			var result = self.slice(0, temp.slice(0, length).replace(/\*\*/g, ' ').replace(/\*/g, '').length);
			
			if(_str.bytesLength(result) > length)
				result = result.slice(0, result.length-1);
			
			return _obj.merge(new String(result), _str);
		}
	};
});
define("base.string.trim", [], function (require, exports, module) {
	var _obj = require("base.object");
	var _str = require("base.string.class");
	
	module.exports = {
		trim:function(value, noMore) {
			if(typeof value != 'string') {
				value = this;
			}
			if(!value.length) {
				return "";
			}
			var result = value.replace(/(^(\u3000|\s|\t|\u00A0)*)|((\u3000|\s|\t|\u00A0)*$)/g, '');
			
			if(noMore) {
				result = result.replace(/(\u3000|\s|\t|\u00A0){1,9999}/g, ' ');
			}
			
			return _obj.merge(new String(result), _str);
		}
	};
});
/**
 * 浏览器类型及平台判断
 * @namespace System.browser
 * @constructor
 */
define("base.system.browser",[],function (require, exports, module) {
    var _ua = navigator.userAgent.toLowerCase();

	var browser = {
		/**
		 * 浏览器版本号
		 * @attribute version
		 * @type {String}
		 * @example
		 * panda.browser.version; //=> 10.0
		 */
		version : (_ua.match( /.+(?:rv|chrome|ra|ie)[\/: ]([\d.]+)/ ) || [])[1],
		/**
		 * 是否为IE
		 * @attribute ie
		 * @type {Boolean}
		 */
		ie : /msie/.test(_ua),
		/**
		 * 是否为Mozilla
		 * @attribute moz
		 * @type {Boolean}
		 */
		moz : /gecko/.test(_ua),
		/**
		 * 是否为Safari
		 * @attribute safari
		 * @type {Boolean}
		 */
		safari : /safari/.test(_ua),
		/**
		 * 是否为Firefox
		 * @attribute ff
		 * @type {Boolean}
		 */
		ff : /firefox/i.test(_ua),
		/**
		 * 是否为Chrome
		 * @attribute chrome
		 * @type {Boolean}
		 */
		chrome : /chrome/i.test(_ua)
	};
	/**
	 * 是否为IE6
	 * @attribute isIE6
	 * @type {Boolean}
	 */
    browser.isIE6 = (browser.ie && browser.version === '6.0');

    browser.platform={};
	
	/**
	 * 是否为Android
	 * @attribute isAndroid
	 * @type {Boolean}
	 */
	/**
	 * 是否为iPad
	 * @attribute isIpad
	 * @type {Boolean}
	 */
	/**
	 * 是否为iPhone
	 * @attribute isIphone
	 * @type {Boolean}
	 */
	/**
	 * 是否为Linux
	 * @attribute isLinux
	 * @type {Boolean}
	 */
	/**
	 * 是否为Macintosh
	 * @attribute isMacintosh
	 * @type {Boolean}
	 */
	/**
	 * 是否为Windows
	 * @attribute isWindows
	 * @type {Boolean}
	 */
	/**
	 * 是否为X11
	 * @attribute isX11
	 * @type {Boolean}
	 */
	/**
	 * 是否为触控设备
	 * @attribute isTouch
	 * @type {Boolean}
	 */
    var ua = navigator.userAgent;
    var pltemp="Android iPad iPhone Linux Macintosh Windows X11 Touch".split(" ");
    for(var index in pltemp){
        if(pltemp.hasOwnProperty(index)){
            var item=pltemp[index];
            var key = item.charAt(0).toUpperCase() + item.toLowerCase().substr(1);
            browser.platform[ "is" + key ] = !!~ua.indexOf( item );
        }
    };
	
	/**
	 * 是否为移动端设备
	 * @attribute isMobile
	 * @type {Boolean}
	 */
    if(browser.platform.isAndroid || browser.platform.isIpad || browser.platform.isIphone || browser.platform.isTouch){
        browser.isMobile = true;
    }else{
        browser.isMobile = false;
    }
    module.exports = browser;
});
/**
 * cookie相关操作的封装
 * @namespace System.cookie
 * @constructor
 */
define("base.system.cookie",[],function (require, exports, module) {
    module.exports = {
        /**
         * 获取指定 name的cookie值
         * @method get
         * @param {String} name - cookie名称
         * @returns {String}
         * @example
         *      panda.cookie.get("pin")
         */
		get:function(name) {
			name = name.replace(/([\.\[\]\$])/g,'\\\$1');
			var rep = new RegExp(name + '=([^;]*)?;','i'); 
			var co = document.cookie + ';';
			var res = co.match(rep);
			if (res) {
				return unescape(res[1]) || "";
			}
			else {
				return "";
			}
		},
        /**
         * 设置cookie
         * @method set
         * @param {String} name - COOKIE名称
         * @param {String} value - COOKIE值
         * @param {String} expire - 过期时间，该过期时间以小时计算，例如设置1，则表示1小时后过期
         * @param {String} path - COOKIE有效路径
         * @param {String} domain - COOKIE的有效域名
         * @param {String} secure - -
         * @return {undefined}
         * @example
         *      panda.cookie.set("pin","jd_yanfa")
         */
		set:function(name, value, expire, path, domain, secure) {
			var cstr = [];
			cstr.push(name + '=' + escape(value));
			if(expire){
				var dd = new Date();
				var expires = dd.getTime() + expire * 3600000;
				dd.setTime(expires);
				cstr.push('expires=' + dd.toGMTString());
			}
			if (path) {
				cstr.push('path=' + path);
			}
			if (domain) {
				cstr.push('domain=' + domain);
			}
			if (secure) {
				cstr.push(secure);
			}
			document.cookie = cstr.join(';');
		}
    };
});
/**
 * 获取全局尺寸
 * @namespace System.screen
 * @constructor
 */
define("base.system.screen",[],function (require, exports, module) {
    /**
     * 获取客户端显示屏幕的尺寸信息，包括实际尺寸以及可视区域尺寸
     * @pc
     * @method screen
     * @return {width,height,visibleWidth,visibleHeight}
     * @example
     * 		panda.screen().width //=> 1280
     */
    return function(_target) {
		var w, h;   
		var target;
		if (_target) {      
			target = _target.document;  
		}   
		else 
		{      
			target = document;  
		}   
		if (self.innerHeight) { // all except Explorer        
			if (_target) {          
				target = _target.self;      
			}       
			else {          
				target = self;      
			}       
			w = target.innerWidth;      
			h = target.innerHeight; 
		}   
		else if (target.documentElement && target.documentElement.clientHeight) { // Explorer 6 Strict Mode       
			w = target.documentElement.clientWidth;     
			h = target.documentElement.clientHeight;    
		}   
		else if (target.body) { // other Explorers      
			w = target.body.clientWidth;        
			h = target.body.clientHeight;   
		}   
		
		var visibleWidth = 0, visibleHeight = 0;
		if(window && window.screen) {
			visibleWidth = window.screen.availWidth;
			visibleHeight = window.screen.availHeight;
		}
		
		return {        
			width: w,       
			height: h,
			visibleWidth:visibleWidth,
			visibleHeight:visibleHeight
		};
	};
});
/**
 * 滚动条当前位置
 * author: lizihan <lizihan@jd.com>
 * Date: 13-6-25
 * Time: 17:41
 */
/**
 * @namespace System.scroll
 * @constructor
 */
define("base.system.scroll",[],function (require, exports, module) {

    module.exports = {
        /**
         * document 相对滚动条顶部的偏移。
         * @pc
         * @method scrollTop
         * @returns {number}
         * @example
         *      panda.system.scrollTop()
         */

        /**
         * 传递参数值时，设置垂直滚动条顶部偏移为该值
         * @pc
         * @method scrollTop
         * @param {String} val - 待设置的滚动条位置数值
         * @returns {Number}
         * @example
         *      panda.system.scrollTop(200)
         */
        scrollTop: function(val){
            var oDocument = document,
                dd = oDocument.documentElement,
                db = oDocument.body;
            if( val === undefined ) {
                return Math.max(window.pageYOffset || 0, dd.scrollTop, db.scrollTop);
            }else{
                if(window){
                    window.scrollTo(
                        window.pageXOffset,val
                    );
                }else{
                    oDocument['scrollLeft']  = val;
                }
            }
        },
        /**
         * document 相对滚动条左边的偏移。
         * @pc
         * @method scrollLeft
         * @returns {Number}
         * @example
         *      panda.system.scrollLeft()
         */

        /**
         * 设置document 相对滚动条左边的偏移。
         * @pc
         * @method scrollLeft
         * @param  {Number} val - 待设置的滚动条位置数值
         * @example
         *      panda.system.scrollLeft(200)
         */
        scrollLeft: function(val){
            var oDocument = document,
                dd = oDocument.documentElement,
                db = oDocument.body;
            if( val === undefined ) {
                return Math.max(window.pageXOffset || 0, dd.scrollLeft, db.scrollLeft);
            }else{
                if(window){
                    window.scrollTo(
                        val,window.pageYOffset
                    );
                }else{
                    oDocument['scrollLeft']  = val;
                }
            }
        }
    };
});
/**
 * author: lizihan <lizihan@jd.com>
 * Date: 13-6-13
 * Time: 15:17
 */
/**
 * 本地存储方案，暂支持 IE7+，Chrome，Firefox浏览器
 * @namespace System.storage
 */
define("base.system.storage",[],function(require, exports, module){
	var Storage = function() {
		var self = this;
		self._host = "";
		self._isLocal = false;
		self._container = null;
		
		self.initialize = function(){
			self._host = location.hostname ? location.hostname : 'localStatus';
			self._isLocal = window.localStorage ? true : false;
		};
		
		self.getContainer = function(){
			if (!self._container) {
				try {
					self._container = document.createElement('input');
					self._container.type = 'hidden';
					self._container.style.display = 'none';
					self._container.addBehavior('#default#userData');
					panda('body').append(self._container);
					
					var date = new Date();
					date.setDate(date.getDate() + 30);
					self._container.expires = date.toUTCString();
				} 
				catch (e) {
					self._container = null;
				}
			}
			
			return self._container;
		};
        /**
         * 设置本地存储数据，注：由于本地数据仅存储字符串，所以在存储对象时，应先序列化后再使用该方法进行存储
         * @pc
         * @method set
         * @param {String} key - 待存储数据的KEY值
         * @param {String} value - 待存储的数据内容
         * @example
         *      panda.system.storage.set("pin","张三")
         */
		self.set = function(key, value){
			if (self._isLocal) {
				window.localStorage.setItem(key, value);
			}
			else {
				if (self.getContainer()) {
					self.getContainer().load(self._host);
					panda(self.getContainer()).attr(key, value);
					self.getContainer().save(self._host);
				}
			}
		};
        /**
         * 获取本地存储数据
         * @pc
         * @method get
         * @param  {string} key - 待获取数据的KEY值
         * @returns {String}
         * @example
         *      panda.system.storage.get("pin")
         */
		self.get = function(key){
			if (self._isLocal) {
				return window.localStorage.getItem(key);
			}
			else {
				if (self.getContainer()) {
					self.getContainer().load(self._host);
					return panda(self.getContainer()).attr(key);
				}
			}
			
			return null;
		};
        /**
         * 删除本地存储key的数据
         * @method remove
         * @param {string} key - 待删除的数据KEY值
         * @example
         *      panda.system.storage.remove("pin")
         */
		self.remove = function(key){
			if (self._isLocal) {
				window.localStorage.removeItem(key);
			}
			else {
				if (self.getContainer()) {
					self.getContainer().load(self._host);
					panda(self.getContainer()).removeAttr(key);
					self.getContainer().save(self._host);
				}
			}
		};
		
		return self.initialize();
	};
	
	module.exports = new Storage();
});
/**
 * 颜色类
 * User: tangchao
 * Date: 13-06-18
 * Time: 17:55
 */
/**
 * 提供颜色值在RGB，HSL，HSV三种色域之间的转换
 * @namespace Utilities.color
 * @constructor
 */
define("base.util.Color", [], function (require, exports, module) {
    //正则
    var rgbaRe = /\s*rgba?\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*(?:,\s*(\d+))?\)\s*/,
        hexRe = /\s*#([0-9a-fA-F][0-9a-fA-F]?)([0-9a-fA-F][0-9a-fA-F]?)([0-9a-fA-F][0-9a-fA-F]?)\s*/;

   	var Color=function(){
		var r, g, b,a;
		
		/**
		* 将色彩值转换为HSL格式输出
		* @pc
		* @method hslValue
		* @returns {String}
		* @example
		*      new panda.util.Color("#ff0000").hslValue();
		*/
		this.hslValue=function() {
		   var hsl = this.getHSL();
		   return "hsl(" + (Math.round(hsl.h || 0)) + "," + this.percentage(hsl.s) + "," + this.percentage(hsl.l) + ")";
		},
		/**
		* 将色彩值转换为HSLA格式输出
		* @pc
		* @method hslaValue 
		* @returns {String}
		* @example
		*      new panda.util.Color("#ff0000").hslValue();
		*/
		this.hslaValue=function () {
		   var hsl = this.getHSL();
		   return "hsla(" + (Math.round(hsl.h || 0)) + "," + this.percentage(hsl.s) + "," + this.percentage(hsl.l) + "," + this.a + ")";
		},
		/**
		* 将色彩值转换为HSV格式输出
		* @pc
		* @method hslaValue 
		* @returns {String}
		* @example
		*      new panda.util.Color("#ff0000").hsvValue();
		*/
		this.hsvValue=function () {
		   var hsv = this.getHSV();
		   return "hsv(" + (Math.round(hsv.h || 0)) + "," + this.percentage(hsv.s) + "," + this.percentage(hsv.v) + ")";
		},
		/**
		* 将色彩值转换为HSVA格式输出
		* @pc
		* @method hsvaValue 
		* @returns {String}
		* @example
		*      new panda.util.Color("#ff0000").hslValue();
		*/
		this.hsvaValue=function () {
		   var hsv = this.getHSV();
		   return "hsva(" + (Math.round(hsv.h || 0)) + "," + this.percentage(hsv.s) + "," + this.percentage(hsv.v) + "," + this.a + ")";
		},
		/**
		* 将色彩值转换为RGB格式输出
		* @pc
		* @method rgbValue 
		* @returns {String}
		* @example
		*      new panda.util.Color("#ff0000").rgbValue();
		*/
		this.rgbValue=function () {
		   var self = this;
		   return "rgb(" + Math.round(self.r) + "," + Math.round(self.g) + "," + Math.round(self.b) + ")";
		},
		/**
		* 将色彩值转换为RGBA格式输出
		* @pc
		* @method rgbaValue 
		* @returns {String}
		* @example
		*      new panda.util.Color("#ff0000").rgbaValue();
		*/
		this.rgbaValue=function () {
		   var self = this;
		   return "rgba(" + self.r + "," + self.g + "," + self.b + "," + self.a + ")";
		},
		/**
		* 将色彩值转换为16进制格式输出
		* @pc
		* @method hexValue 
		* @returns {String}
		* @example
		*      new panda.util.Color("#ff0000").hexValue();
		*/
		this.hexValue=function () {
		   var self = this;
		   return "#" + this.padding2(Number(self.r).toString(16)) +
		       this.padding2(Number(self.g).toString(16)) + this.padding2(Number(self.b).toString(16));
		},
		/**
		* 将色彩值转换为HSL对象
		* @pc
		* @method getHSL 
		* @returns {Object}
		* @example
		*      new panda.util.Color("#ff0000").getHSL();
		*/
		this.getHSL=function () {
		   var self = this,
		       r = self.r / 255,
		       g = self.g / 255,
		       b = self.b / 255,
		       max = Math.max(r, g, b),
		       min = Math.min(r, g, b),
		       delta = max - min,
		       h,
		       s = 0,
		       l = 0.5 * (max + min);
		
		   if (min != max) {
		       s = (l < 0.5) ? delta / (max + min) : delta / (2 - max - min);
		       if (r == max) {
		           h = 60 * (g - b) / delta;
		       } else if (g == max) {
		           h = 120 + 60 * (b - r) / delta;
		       } else {
		           h = 240 + 60 * (r - g) / delta;
		       }
		
		       h = (h + 360) % 360;
		   }
		   return {
		       h: h,
		       s: s,
		       l: l
		   };
		},
		/**
		* 将色彩值转换为HSV对象
		* @method getHSV 
		* @returns Object
		* @example
		*      new panda.util.Color("#ff0000").getHSV();
		*/
		this.getHSV=function () {
		   return this.rgb2hsv({
		       r: this.r,
		       g: this.g,
		       b: this.b
		   });
		},
		/**
		* 设置HSL
		* @method setHSL 
		* @returns this
		* @example
		*      new panda.util.Color().setHSL();
		*/
		this.setHSL=function (cfg) {
		   var self = this,
		       current;
		   if ("h" in cfg && "s" in cfg && "l" in cfg) {
		   } else {
		       current = self.getHSL();
		       S.each(["h", "s", "l"], function (x) {
		           if (x in cfg) {
		               current[x] = cfg[x];
		           }
		       });
		       cfg = current;
		   }
		
		   self.colorTransfrom({"hsl": cfg.h+','+cfg.s+','+cfg.l});
		   
		   return this;
		},
		this.to255=function (v) {
		   return v * 255;
		},
		this.hsv2rgb=function (cfg) {
		   var h = Math.min(Math.round(cfg.h), 359),
		       s = Math.max(0, Math.min(1, cfg.s)),
		       v = Math.max(0, Math.min(1, cfg.v)),
		       r, g, b,
		       i = Math.floor((h / 60) % 6),
		       f = (h / 60) - i,
		       p = v * (1 - s),
		       q = v * (1 - f * s),
		       t = v * (1 - (1 - f) * s);
		
		   switch (i) {
		       case 0:
		           r = v;
		           g = t;
		           b = p;
		           break;
		       case 1:
		           r = q;
		           g = v;
		           b = p;
		           break;
		       case 2:
		           r = p;
		           g = v;
		           b = t;
		           break;
		       case 3:
		           r = p;
		           g = q;
		           b = v;
		           break;
		       case 4:
		           r = t;
		           g = p;
		           b = v;
		           break;
		       case 5:
		           r = v;
		           g = p;
		           b = q;
		           break;
		   }
		
		   return {r: this.constrain255(this.to255(r)), g: this.constrain255(this.to255(g)), b: this.constrain255(this.to255(b))};
		},
		/**
		* RGB格式转HSV格式
		* @method rgb2hsv 
		* @returns {Object}
		* @private
		* @example
		*      new panda.util.Color().rgb2hsv({r:255, g:255, b:255});
		*/
		this.rgb2hsv=function (cfg) {
		   var r = cfg.r / 255,
		       g = cfg.g / 255,
		       b = cfg.b / 255;
		
		   var h, s,
		       min = Math.min(Math.min(r, g), b),
		       max = Math.max(Math.max(r, g), b),
		       delta = max - min,
		       hsv;
		
		   switch (max) {
		       case min:
		           h = 0;
		           break;
		       case r:
		           h = 60 * (g - b) / delta;
		           if (g < b) {
		               h += 360;
		           }
		           break;
		       case g:
		           h = (60 * (b - r) / delta) + 120;
		           break;
		       case b:
		           h = (60 * (r - g) / delta) + 240;
		           break;
		   }
		
		   s = (max === 0) ? 0 : 1 - (min / max);
		
		   hsv = {
		       h: Math.round(h),
		       s: s,
		       v: max
		   };
		
		   return hsv;
		},
		/**
		* HSL格式转RGB格式
		* @method hsl2rgb 
		* @returns {Object}
		* @private
		* @example
		*      new panda.util.Color().hsl2rgb({h:1, s:1, l:1});
		*/
		this.hsl2rgb=function (cfg) {
		   var h = Math.min(Math.round(cfg.h), 359),
		       s = Math.max(0, Math.min(1, cfg.s)),
		       l = Math.max(0, Math.min(1, cfg.l)),
		       C, X, m, rgb = [],
		       abs = Math.abs,
		       floor = Math.floor;
		
		   if (s == 0 || h == null) {
		       // achromatic
		       rgb = [l, l, l];
		   } else {
		       // http://en.wikipedia.org/wiki/HSL_and_HSV#From_HSL
		       // C is the chroma
		       // X is the second largest component
		       // m is the lightness adjustment
		       h /= 60;
		       C = s * (1 - abs(2 * l - 1));
		       X = C * (1 - abs(h - 2 * floor(h / 2) - 1));
		       m = l - C / 2;
		       switch (floor(h)) {
		           case 0:
		               rgb = [C, X, 0];
		               break;
		           case 1:
		               rgb = [X, C, 0];
		               break;
		           case 2:
		               rgb = [0, C, X];
		               break;
		           case 3:
		               rgb = [0, X, C];
		               break;
		           case 4:
		               rgb = [X, 0, C];
		               break;
		           case 5:
		               rgb = [C, 0, X];
		               break;
		       }
		       rgb = [rgb[0] + m, rgb[1] + m, rgb[2] + m];
		   }
		   for(var index in rgb){
		       rgb[index] = this.to255(rgb[index]);
		   }
		   return {
		       r: rgb[0],
		       g: rgb[1],
		       b: rgb[2]
		   };
		},
		this.parseHex=function (v) {
		   return parseInt(v, 16);
		},
		this.paddingHex=function (v) {
		   return v + v * 16;
		},
		this.padding2=function (v) {
		   if (v.length != 2) {
		       v = "0" + v;
		   }
		   return v;
		},
		this.percentage=function (v) {
		   return Math.round(v * 100) + "%";
		},
		this.constrain255=function (v) {
		   return Math.max(0, Math.min(v, 255));
		},
		this.parse=function (str) {
		   if ((str.length == 4 || str.length == 7) && str.substr(0, 1) === '#') {
		       values = str.match(hexRe);
		       if (values) {
		           this.r = this.parseHex(values[1]);
		           this.g = this.parseHex(values[2]);
		           this.b = this.parseHex(values[3]);
		           if (str.length == 4) {
		               this.r = this.paddingHex(r);
		               this.g = this.paddingHex(g);
		               this.b = this.paddingHex(b);
		           }
		       }
		   }
		   else {
		       values = str.toString().match(rgbaRe);
		       if (values) {
		           this.r = values[1];
		           this.g = values[2];
		           this.b = values[3];
		           this.a = values[4];
		       }
		   }
		};
		
		//判断传入参数颜色类型
		//16进制
		if(arguments.length==1){
		   	this.a=1;
		   	if (arguments[0].toLowerCase().indexOf('rgb') >= 0) {
		   		var matches = arguments[0].match(/\d{1,3}/g);
				if(matches) {
		            this.r = matches[0] || 0;
		            this.g = matches[1] || 0;
		            this.b = matches[2] || 0;
		            this.a = matches[3] || 1;
				}
		   	}
		   	else {
		   		this.parse(arguments[0]);
		   	}
		}
		//RGB or RGBA
		else if(arguments.length>1){
			this.r=arguments[0];
			this.g=arguments[1];
			this.b=arguments[2];
			this.a=arguments[3]||1;
		}
		
		//{"Hex":"#ff0000"} {"rgb":"255,0,0"} {"hsl":"0,1,0.5"} {"hsv":"0,1,1"}
		this.colorTransfrom=function(cobj){
			for(var index in cobj) {
				var paraArray=cobj[index].split(",");
				switch(index){
				  case "hex":
				      this.parse(paraArray[0]);
				      break;
				  case "rgb":
				      this.r=paraArray[0];
				      this.g=paraArray[1];
				      this.b=paraArray[2];
				      break;
				  case "rgba":
				      this.r=paraArray[0];
				      this.g=paraArray[1];
				      this.b=paraArray[2];
				      this.a=paraArray[3]||1;
				      break;
				  case "hsl":
				      var hslrgb=this.hsl2rgb({h:paraArray[0],s:paraArray[1],l:paraArray[2]});
				      this.r=hslrgb.r;
				      this.g=hslrgb.g;
				      this.b=hslrgb.b;
				      break;
				  case "hsla":
				      var hslargb=this.hsl2rgb({h:paraArray[0],s:paraArray[1],l:paraArray[2]});
				      this.r=hslrgb.r;
				      this.g=hslrgb.g;
				      this.b=hslrgb.b;
				      this.a=paraArray[3];
				      break;
				  case "hsv":
				      var hsvrgb=this.hsv2rgb({h:paraArray[0],s:paraArray[1],v:paraArray[2]});
				      this.r=hsvrgb.r;
				      this.g=hsvrgb.g;
				      this.b=hsvrgb.b;
				      break;
				  case "hsva":
				      var hsvrgba=this.hsv2rgb({h:paraArray[0],s:paraArray[1],v:paraArray[2]});
				      this.r=hsvrgba.r;
				      this.g=hsvrgba.g;
				      this.b=hsvrgba.b;
				      this.a=paraArray[3];
				      break;
				}
				
				return;
			}
		};
   	};

    module.exports = Color;
});

/**
 * 高级日期对象
 * User: lizihan
 * Date: 13-05-10
 * Time: 10:36
 */
/**
 * 提供常用的日期方法，并可根据关键字进行格式化输出日期
 * @namespace Utilities.dateformatter
 * @constructor
 */
define("base.util.DateFormatter", [], function (require, exports, module) {
	var DateFormatter = function(time, pattern) {
		var self = this;
		/**
		 * 原始日期对象
		 * @pc
		 * @attribute _source
		 * @protected
		 * @default null
		 * @type Date
		 */
		self._source = null;
		/**
		 * 输出结果
		 * @pc
		 * @attribute _result
		 * @protected
		 * @default ""
		 * @type String
		 */
		self._result = "";
		/**
		 * 输出格式
		 * @pc
		 * @attribute _pattern
		 * @protected
		 * @default "Y-m-d H:i:s"
		 * @type String
		 */
		self._pattern = "Y-m-d H:i:s";
		/**
		 * 格式关键字与日期函数的映射关系
		 * @pc
		 * @attribute _key
		 * @private
		 * @default Map
		 * @type Object
		 */
		self._key = {
			"y":"getYear",		// 两位数的年
			"Y":"getFullYear",	// 完整年
			"m":"getMonth",		// 月份
			"d":"getDate",		// 号数
			"D":"getDay",		// 日期
			"H":"getHours",		// 小时
			"i":"getMinutes",	// 分数
			"s":"getSeconds"	// 秒数
		};
		/**
		 * 初始化
		 * @pc
		 * @method initialize
		 * @protected
		 * @param {Object} time		时间值,可选[Date, String, Number]
		 * @param {Object} pattern	日期模式,默认 Y-m-d H:i:s
		 * @return this
		 */
		self.initialize = function(time, pattern) {
			self._source = new Date();
			
			if(pattern) {
				self.setPattern(pattern);
			}
			
			if(typeof time == 'number') {
				self.setTime(time);
			}
			else if(typeof time == 'string' || typeof time == 'object') {
				self.setSource(time);
			}
			else
				self.setTime(new Date().getTime());
			
			return self;
		};
		
		/**
		 * 设置原始日期对象
		 * @pc
		 * @method setSource
		 * @param {Object} value "" 可选[Date, String]
		 * @return this
		 * @example
		 * 		new panda.util.DateFormatter().setSource("2014-01-02").toString();
		 * 		// ==> 2014-01-02
		 */
		self.setSource = function(value) {
			if(!value) {
				value = "";
			}
			
			if(typeof value == 'object') {
				var date = new Date();
				date.setTime(value.getTime());
				self._source = date;
			}
			if(typeof value == 'string') {
				var data = value; 
		        var reCat = /(\d{1,4})/gm;  
		        var t = data.match(reCat);
		        if(t && t.length > 1) {
		        	t[1] = t[1] - 1;
		        }
				
				if(t && t.length < 6) {
					for(var i=t.length;i<6;i++) {
						if (i == 2) {
							t.push(1);
						}
						else {
							t.push(0);
						}
					}
				}
				
		        if(t) {
		        	eval('self._source = new Date('+t.join(',')+');');
		        }else {
		        	self._source = new Date();
		        }
			}
			
			self.parse();
			
			return self;
		};
		
		/**
		 * 获取原始日期对象
		 * @pc
		 * @method getSource
		 * @return Date
		 * @example
		 * 		new panda.util.DateFormatter().getSource();
		 * 		// ==> Wed Jan 22 2014 18:23:22 GMT+0800 (中国标准时间)
		 */
		self.getSource = function() {
			if(!self._source) {
				self._source = new Date();
			}
			
			return self._source;
		};
		
		/**
		 * 设置毫秒值
		 * @pc
		 * @method setTime
		 * @param {Number} value
		 * @return this
		 * @example
		 * 		new panda.util.DateFormatter().seTime(1390386231345);
		 */
		self.setTime = function(value) {
			self.getSource().setTime(value);
			self.parse();
			return self;
		};
		
		/**
		 * 获取毫秒值
		 * @pc
		 * @method getTime
		 * @return {Number}
		 * @example
		 * 		new panda.util.DateFormatter().getTime();
		 * 		// ==> 1390386231345
		 */
		self.getTime = function() {
			return self.getSource().getTime();
		};
		
		/**
		 * 设置日期模式，该模块可用关键字为Y：四位年份，y：两位年份，m：两位月份，d：号数，D：星期，H：两位小时数，i：两位分钟数，s：两位秒数
		 * @pc
		 * @method setPattern
		 * @param {String} value
		 * @return this
		 * @example
		 * 		new panda.util.DateFormatter().setPattern("Ymd H:i:s").toString();
		 * 		// ==> 20140122 18:24:33
		 */
		self.setPattern = function(value) {
			self._pattern = value;
			self.parse();
			return self;
		};
		
		/**
		 * 根据当前参数项解析日期
		 * @pc
		 * @method parse
		 * @protected
		 * @return this
		 */
		self.parse = function() {
			self._result = "";
			
			for(var i=0;i<self._pattern.length;i++) {
				var ch = self._pattern.charAt(i);
				if(self._pattern.charCodeAt(i) == 92) {
					i++;
					self._result += self._pattern.charAt(i);
					continue;
				}
				
				if(self._key[ch] != null) {
					if(ch == 'm') {
						eval("var re = self.getSource()."+self._key[ch]+"()+1;");
						if(parseInt(re, 10)<10) {
							re = '0'+re;
						}
						self._result += re;
					}else {
						eval("var re = self.getSource()."+self._key[ch]+"();");
						if(parseInt(re, 10)<10) {
							re = '0'+re;
						}
						self._result += re;
					}
				}else {
					self._result += ch;
				}
			}
			
			return self;
		};
		
		/**
		 * 对当前设置时间进行格式化调整，可按年月日小时进行前移和后移
		 * @pc
		 * @method dateTo
		 * @param {Object} type - 可选值为[y,m,d,H,i,s]
		 * @param {Object} value - 正数为加，负数为减
		 * @return this
		 * @example
		 * 		new panda.util.DateFormatter().dateTo("Y", -1).toString();
		 * 		// ==> 2013-01-22 18:25:34
		 */
		self.dateTo = function(type, value) {
			var time = 0;
			switch(type) {
				case "y":time += 31536000000 * value;break;
				case "m":time += 2592000000 * value;break;
				case "d":time += 86400000 * value;break;
				case "H":time += 3600000 * value;break;
				case "i":time += 60000 * value;break;
				case "s":time += 1000 * value;break;
			}
			
			self.setTime(self.getTime() + time);
			
			return self;
		};
		
		/**
		 * 将当前设置的日期与指定日期进行比较，当前设置时间较大，则会返回正数，否则返回负数
		 * @pc
		 * @method compare
		 * @param {Date} value
		 * @return {Number}
		 * @example
		 * 		new panda.util.DateFormatter().compare(1390386464488);
		 * 		// ==> 3
		 */
		self.compare = function(value) {
			return self.getTime() - (value.getTime()||self.getTime());
		};
		
		/**
		 * 判断当前设置的数据是否为闰年
		 * @pc
		 * @method isLeapYear
		 * @return {Boolean}
		 * @exmaple
		 * 		new panda.util.DateFormatter().isLeapYear();
		 * 		// ==> false
		 */
		self.isLeapYear = function() {
			return (0==self.getSource().getFullYear()%4&&((self.getSource().getFullYear()%100!=0)||(self.getSource().getFullYear()%400==0)));
		};
		
		/**
		 * 根据当前对象的设置，进行最终的格式化输出
		 * @pc
		 * @method toString
		 * @return {String}
		 * @example
		 * 		new panda.util.DateFormatter().toString();
		 * 		// ==> 2014-01-22 18:29:06
		 */
		self.toString = function() {
			return self._result;
		};
		
		return self.initialize(time, pattern);
	};
	
	module.exports = DateFormatter;
});
/**
 * User: lizihan
 * Date: 13-06-13
 * Time: 17:22 
 */
/**
 * 高级正则对象，提供了不同于原生正则对象的操作方式
 * @namespace Utilities.reg
 * @constructor
 */
define("base.util.Reg", [], function (require, exports, module) {
	/**
	 * 假设使用方法:
	 * new Reg(/#<year=(\d{4})>-#<month=(\d{2})>-#<day=(\d{2})>/).exec("2013-06-13").year
	 * console: 2013
	 */
	var Reg = function(regstr, pattern) {
		var self = this;
		/**
		 * 缓存解析后的数据
		 * @attribute _quene
		 * @default []
		 * @type {Array}
		 * @protected
		 */
		self._quene = [];
		/**
		 * 格式化后生成的原始正则
		 * @attribute _regexp
		 * @default null
		 * @type {String}
		 * @protected
		 */
		self._regexp = null;
		/**
		 * 目标正则
		 * @attribute _source
		 * @default null
		 * @type {String}
		 * @protected
		 */
		self._source = null;
		/**
		 * 正则模式 /ig
		 * @attribute _pattern
		 * @default ""
		 * @type {String}
		 * @protected
		 */
		self._pattern = "";
		
		/**
		 * 初始化
		 * @method initialize
		 * @protected
		 * @param {Object} regstr	正则表达式
		 * @param {Object} pattern	正则模式, 比如 i, g 之类的
		 * @return this
		 * @private
		 */
		self.initialize = function(regstr, pattern) {
			self._pattern = pattern;
			self._parse(regstr);
			return self;
		};
		
		/**
		 * 分析自定义正则语法
		 * @protected
		 * @method _parse
		 * @param {String} str
		 * @return this
		 */
		self._parse = function(str) {
			self._source = str;
			
			var regsource = str.source;
			
			var treg = /\#<.*?\)>/ig;
			treg = regsource.match(treg);
			
			var ireg = /\#<([a-zA-Z0-9_-]+)=(\(.*\))>/;
			self._quene = [];
			for(var i=0;i<treg.length;i++) {
				var result = treg[i].match(ireg);
				var map = {
					key:result[1],
					reg:result[2],
					source:result[0]				
				};
				self._quene.push(map);
			}
			
			self._buildRegExp();
		};
		
		/**
		 * 构建原始正则
		 * @protected
		 * @method _buildRegExp
		 * @return this
		 */
		self._buildRegExp = function() {
			self._regexp = self._source.source;
			for(var i=0;i<self._quene.length;i++) {
				self._regexp = self._regexp.replace(self._quene[i].source, self._quene[i].reg);
			}
			
			self._regexp = new RegExp(self._regexp, self._pattern);
		};
		
		/**
		 * 根据当前高级正则对字符串进行匹配
		 * @pc
		 * @method exec
		 * @param {String} data - 待匹配的字符串
		 * @return {Object}
		 * @example
		 * 		new panda.util.Reg(/#<year=(\d{4})>-#<month=(\d{2})>-#<day=(\d{2})>/).exec("2014-01-22");
		 * 		// ==> Object {'year':2014, 'month':01, 'day':22}
		 * 		// 高级正则区别于普通正则的地方在于，通过 #<key=(value)>这种特殊形式对期待匹配的内容进行抽取
		 * 		// 例如：#<year=(\d{4})> 代表的是将四个数字组成的字符串赋值到year属性上
		 */
		self.exec = function(data) {
			var result = data.match(self._regexp);
			var re = {};
			if(result) {
				for(var i=0;i<self._quene.length;i++) {
					if(result[i+1]) {
						re[self._quene[i].key] = result[i+1];
					}
				}
			}

			return re;
		};
		
		/**
		 * 测试匹配结果
		 * @pc
		 * @method test
		 * @param {Object} data - 待测试的字符串
		 * @return {Boolean}
		 * @example
		 * 		new panda.util.Reg(/#<year=(\d{4})>-#<month=(\d{2})>-#<day=(\d{2})>/).exec("2014-01-22");
		 * 		// ==> true
		 */
		self.test = function(data) {
			return self._regexp.test(data);
		};
		
		return self.initialize(regstr, pattern);
	};
	
	module.exports = Reg;
});
/**
 * SWF封装类
 * User: lizihan
 * Date: 13-06-14
 * Time: 15:46
 */
/**
 * 提供了flash相关的操作，包括当前版本号，以及创建一个标准的swf节点
 * @namespace Utilities.swf
 * @constructor
 */
define("base.util.SWF", [], function (require, exports, module) {
	var obj = require("base.object");
	var guid = require("base.util.guid");
	var system = require("base.system");
	
	var build = function(url, opts) {
		var opt = obj.parameter(opts, {
			'id':	guid(),
			'width':	1,
			'height':	1,
			'attrs':	{},
			'params':	{},
			'vars':		{},
			'html':		""
		});
		
		var attrs = [];
		var vars = [];
		for(var key in opt.attrs) {
			attrs.push(key + '="' + opt.attrs[key] + '"');
		}
		for(key in opt.vars) {
			vars.push(key + '=' + opt.vars[key]);
		}
		
		opt.params['flashvars'] = vars.join("&");
		
		var builder = [];
		if(system.browser.ie) {
			builder.push('<object id="'+opt.id+'" width="'+opt.width+'" height="'+opt.height+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" ');
			builder.push(attrs.join(" "));
			builder.push('><param name="movie" value="'+url+'" />');
			
			for(key in opt.params) {
				builder.push('<param name="'+key+'" value="'+opt.params[key]+'" />');
			}
			
			builder.push('</object>');
		}else {
			builder.push('<embed id="'+opt.id+'" width="'+opt.width+'" height="'+opt.height+'" type="application/x-shockwave-flash" src="'+url+'" ');
			builder.push(attrs.join(' '));
			
			for(key in opt.params) {
				builder.push(' ' + key + '="'+opt.params[key]+'" ');
			}
			
			builder.push(' />');
		}
		
		opt.html = builder.join("");
		return opt;
	};
	
	module.exports = {
		/**
		 * 创建一个标准化的swf节点
		 * @pc
		 * @method create
		 * @param {Object} target - SWF容器节点,此容器并不是object或embed标签本身
		 * @param {Object} url - SWF的URL地址，建议在地址后添加一个随机字符串，在某些浏览器中，浏览器对swf文件会有深度缓存，导致swf的创建先于DOM树，从而无法与JS通信
		 * @param {Object} opts - SWF配置信息
		 * @return {String}
		 * @example 
		 * 		var swf_id = panda.util.swf.create("http://static.360buyimg.com/swf/test.swf", {
		 * 			width:920,						宽度
		 * 			height:200,						高度
		 * 			attr:{style:"display:none"},	Object或Embed节点属性	
		 * 			params:{wmode:"transparent"},	SWF自身配置
		 * 			vars:{lang:"zh"}				向SWF的传参列表
		 * 		});
		 */
		create: function(target, url, opts) {
			var builder = build(url, opts);
			target.innerHTML = builder.html;
			
			return builder.id;
		},
		/**
		 * 获取当前浏览器的SWF版本号
		 * @pc
		 * @method version
		 * @return {Number}
		 * @example
		 * 		panda.util.swf.version();
		 * 		// ==> 11.8.800.0
		 */
		version: function() {
			if(system.browser.ie) {
				try {
					for(var i=1;i<12;i++) {
						var acx = new ActiveXObject("ShockwaveFlash.ShockwaveFlash." + i);
						if(acx) {
							var version = acx.GetVariable("$version");
							return version.replace(/WIN/g,'').replace(/,/g,'.');
						}
					}
				}catch(err) {}
			}else {
				try {
					var plug = navigator.plugins["Shockwave Flash"];
					return plug.description.replace(/([a-zA-Z]|\s)+/, "").replace(/(\s)+r/, ".") + ".0";
				}catch(err) {}
			}
			
			return null;
		}
	};
});
/**
 * User: lizihan
 * Date: 13-06-14
 * Time: 15:46 
 */
/**
 * 提供对浏览器最优化的定时触发器的封装
 * @namespace Utilities.timer
 * @constructor
 */
define("base.util.Timer", [], function (require, exports, module) {
	var obj = require("base.object");
	var guid = require("base.util.guid");
	
	var _enterFrame = ( function() {
		// return window.requestAnimationFrame ||
			// window.webkitRequestAnimationFrame ||
			// window.mozRequestAnimationFrame ||
			// window.oRequestAnimationFrame ||
			// window.msRequestAnimationFrame ||
			return function( callback ) {
				return window.setTimeout( callback, self.FAST );
			};
	})();
	
	var _cancelFrame = (function() {
		// return window.cancelAnimationFrame || 
			// window.webkitCancelAnimationFrame || 
			// window.mozCancelAnimationFrame || 
			// window.oCancelAnimationFrame ||
			return function(id) {
				window.clearTimeout(id);
			};
	})();
	
	var Timer = function(opts) {
		var self = this;
		/**
		 * 初始化配置项
		 * @attribute _option
		 * @private
		 * @type Object
		 * @default null
		 */
		self._option = null;
		
		/**
		 * 轮循ID
		 * @private
		 * @attribute _cid
		 * @type Number
		 * @default 0
		 */
		self._cid = 0;
		/**
		 * 运行次数统计
		 * @private
		 * @attribute _count
		 * @type Number
		 * @default 0
		 */
		self._count = 0;
		/**
		 * 开始执行时间
		 * @protected
		 * @attribute startTime
		 * @type Number
		 * @default 0
		 */
		self.startTime = 0;
		
		/**
		 * 已运行时长
		 * @protected
		 * @attribute running
		 * @type Number
		 * @default 0
		 */
		self.running = 0;
		
		self.FAST = 16;
		
		/**
		 * 初始化
		 * @protected
		 * @method initialize
		 * @param {Object} opts duration:100,delay:0,repeat:0,callback:empty,complete:empty
		 * @example	
		 * 		new panda.util.Timer({
		 * 			duration:16,			运行间隔
		 * 			delay:300,				延迟运行时长, 默认为0
		 * 			repeat:0,				重复多少次 , 默认为0, 代表无次数限制
		 * 			callback:function(){},	回调函数
		 * 			complete:function(){}	运行结束回调
		 * 		}).start();
		 */
		self.initialize = function(opts) {
			var option = obj.parameter(opts, {
				duration:self.FAST,
				delay:0,
				repeat:0,
				callback:obj.bind(self.empty, self),
				complete:obj.bind(self.empty, self)
			});
			
			self._option = option;
			
			self._option.delay = panda.isNumber(self._option.delay) ? (self._option.delay < 0 ? 0 : self._option.delay) : 0;
			
			self._enterFrame = _enterFrame;
			
			self._cancelFrame = _cancelFrame;
			
			return self;
		};
		
		/**
		 * 设置当前触发器的配置信息
		 * @method setOption
		 * @param {Object} opts - 配置信息，其中包含：duration:触发间隔时长,delay:首次延迟触发时间,repeat:重复次数（0为无次数限制）,callback:每次触发时的回调函数,complete:触发器完成时的回调函数
		 * @return this
		 * @example
		 * 		// 此处均为默认值
		 * 		new panda.util.Timer({
		 * 			duration:16,			
		 * 			delay:0,				
		 * 			repeat:0,				
		 * 			callback:function(){},	
		 * 			complete:function(){}	
		 * 		}).start();
		 */
		self.setOption = function(opts) {
			self._option = obj.parameter(opts, self._option);
			
			return self;
		};
		
		/**
		 * 开始运行当前的触发器
		 * @method start
		 * @return this
		 * @example
		 * 		new panda.util.Timer().start();
		 */
		self.start = function() {
			self.startTime = new Date().getTime();
			self.running = 0;
			self.lastrunning = 0;
			
			if(self._cid) {
				self.stop(self._cid);
				self._cid = 0;
			}
			
			self._cid = self._enterFrame.call(window, obj.bind(self.step, self));
			self._signal = true;
			
			return self;
		};
		
		/**
		 * 每次更新执行 (此处会判断delay及次数限制)
		 * @method step
		 * @protected
		 * @return this
		 */
		self.step = function() {
			if (self._signal) {
				self._cid = self._enterFrame.call(window, obj.bind(self.step, self));
				
				var currentTime = new Date().getTime();
				
				// 如果有延迟执行，则判断与开始时间之间的差
				if (self._option.delay) {
					if (currentTime - self.startTime < self._option.delay) {
						return;
					}
				}
				
				// 当前触发器已执行的时间
				self.running = currentTime - self.startTime - self._option.delay;
				
				try {
					// 当运行时间减去上次运行时间大于触发间隔时
					if (self.running - self.lastrunning >= self._option.duration) {
						// 仅当触发器有次数限制时，才会调用complete回调
						if (self._option.repeat) {
							self._count++;
							if (self._count > self._option.repeat) {
								try {
									self._option.complete && self._option.complete.call();
								} 
								catch (e) {
									panda.stack.extractStacktrace(e, 1);
								}
								return self.stop();
							}
						}
						
						// 调用callback回调
						self.lastrunning = self.running;
						self._option.callback && self._option.callback.call();
					}
				} 
				catch (e) {
					// 避免 回调函数 报错导致动画类异常
					panda.stack.extractStacktrace(e, 1);
				}
			}
		};
		
		/**
		 * 停止运行当前的触发器
		 * @method stop
		 * @return this
		 * @example
		 * 		new panda.util.Timer().stop();
		 */
		self.stop = function() {
			self._count = 0;
			self._signal = false;
			
			self._cancelFrame.call(window, self._cid);
			self._cid = 0;
			
			return self;
		};
		
		/**
		 * 该方法会先停止当前触发器然后再启动，其过程类似于timer.stop().start();
		 * @method reset
		 * @return this
		 * @example
		 * 		new panda.util.Timer().reset();
		 */
		self.reset = function() {
			self.stop();
			self.start();
			
			return self;
		};
		
		/**
		 * 运行状态
		 * @protected
		 * @method isPlay
		 * @return {Boolean}
		 */
		self.isPlay = function() {
			return self._cid?true:false;
		};
		
		/**
		 * 内置临时空函数
		 * @method _empty
		 * @private
		 */
		self._empty = function() {
			
		};
		
		return self.initialize(opts);
	};
	
	module.exports = Timer;
});
/**
 * User: lizihan
 * Date: 13-06-17
 * Time: 11:27 
 */
/**
 * 动画类
 * @namespace Utilities.tweener
 * @constructor
 */
define("base.util.Tweener", [], function (require, exports, module) {
	var _obj = require("base.object");
	var _$ = require("base.query");
	var _type = require("base.util.tweens");
	var _timer = require("base.util.Timer");
	
	var Tweener = function(opts) {
		var self = this;
		/**
		 * 目标对象
		 * @attribute target
		 * @protected 
		 * @type Node
		 * @default null
		 */
		self.target = null;
		/**
		 * 初始化配置项
		 * @attribute options
		 * @protected
		 * @type {Object}
		 * @default null
		 */
		self.options = null;
		/**
		 * 计时器对象
		 * @attribute timer
		 * @protected
		 * @type {Timer}
		 * @default null
		 */
		self.timer = null;
		
		/**
		 * 当前轮循值
		 * @protected
		 * @attribute
		 * @type {Number}
		 * @default 0
		 */
		self.current = 0;
		/**
		 * 延时值
		 * @protected
		 * @attribute
		 * @type {Number}
		 * @default 0
		 */
		self.delay = 0;
		/**
		 * 当前是否在播放
		 * @protected
		 * @attribute
		 * @type {Boolean}
		 * @default false
		 */
		self.isPlay = false;
		
		self.initialize = function(opts) {
			self.options = _obj.parameter(opts, {
				from:null,
				to:{},
				target:null,
				time:100,
				delay:0,
				autoComplete:true,
				onStart:self._empty,
				onEnd:self._empty,
				onStep:self._empty,
				onPause:self._empty,
				onResume:self._empty,
				type:"easeOutQuad"
			});
			
			if(typeof self.options.type == 'string') {
				if(typeof _type[self.options.type] != 'function') {
					self.options.type = 'linear';
				}
				self.options.type = _type[self.options.type];
			}
			
			if(self.options.target == null) {
				throw new Error('Tweener have a non-null Object to the Target');
			}
			
			if(opts.from == null) {
				self.options.from = self._getFrom(self.options.target, self.options.to);
			}
			
			self.delay = self.options.delay;
			self.target = self.options.target;
			
			return self;
		};
		/**
		 * 开始执行当前动画
		 * @method start
		 * @return this
		 * @example
		 * 		tweener = new panda.util.Tweener({
		 * 			// 待执行动画的DOM节点
		 * 			target:dom_target,		
		 * 			// 动画执行的起始属性，均为CSS属性					
		 * 			from:{										
		 * 				marginLeft:0
		 * 			},
		 * 			// 动画执行的结束属性，均为CSS属性
		 * 			to:{										
		 * 				marginLeft:200
		 * 			},
		 * 			// 动画总共的运行时长，单位毫秒
		 * 			time:600,		
		 * 			// 动画延迟启动时长，单位毫秒							
		 * 			delay:0,			
		 * 			// 缓动动画类型，默认就是 easeOutQuad，这个挺好看的						
		 * 			type:"easeOutQuad",			
		 * 			// 当Tweener被stop时，使用此参数来表示是否自动onEnd回调				
		 * 			autoComplete:true,				
		 * 			// 当动画开始执行时执行的回调函数			
		 * 			onStart:function() {},			
		 * 			// 当动画结束后执行的回调函数			
		 * 			onEnd:function() {},			
		 * 			// 当动画每执行一步时执行的回调函数，该回调函数的返回值可修改动画类本身的动态数值
		 * 			// 该回调有三个参数(target:目标节点，running:当前运行时间，time:动画总时长)		
		 * 			onStep:function(target, running, time) {},	
		 * 			// 当动画暂停时执行的回调函数
		 * 			onPause:function() {},		
		 * 			// 当动画恢复执行时的回调函数				
		 * 			onResume:function() {}						
		 * 		}).start();	
		 */
		self.start = function() {
			if(self.holding) {
				self.resume();
			}else {
				self.options.onStart && self.options.onStart();
				
				if(self.timer == null) {
					self.timer = new _timer({
						duration:28,
						delay:self.delay,
						callback:_obj.bind(self.step, self)
					});
				}
				
				self.timer.start();
				self.isPlay = true;
			}
			
			return self;
		};
		self.step = function() {
			var running = self.timer.running;
			if(running < self.options.time) {
				var from = self.options.from;
				var to = self.options.to;

				for(var key in from) {
					if(from.hasOwnProperty(key)) {
						var isPercent = (to[key].charAt && to[key].charAt(to[key].length-1) == '%') ? '%' : '';
						var currentPropertyValue = self.options.type(running, self._toInt(from[key], key), self._toInt(to[key]) - self._toInt(from[key], key), self.options.time);
						currentPropertyValue = Math.round(currentPropertyValue * 100) / 100;
						if (panda.dom.isStyle(key)) {
							_$(self.target).css(key, currentPropertyValue + isPercent);
						}else {
							if (self.target && self.target.setAttribute) {
								_$(self.target).attr(key, currentPropertyValue + isPercent);
							}else {
								self.target[key] = currentPropertyValue + isPercent;
							}
						}
					}
				}
				
				self.options.onStep && self.options.onStep(self.target, running, self.options.time);
			}else {
				self.stop();
			}
		};
		/**
		 * 停止动画
		 * @method stop
		 * @return this
		 * @example
		 * 		// 若配置参数中 autoComplete为true时，stop方法会自动调用onEnd方法
		 * 		timer.stop();
		 */
		self.stop = function() {
			self.timer.stop();
			self.isPlay = false;
			
			if(self.options.autoComplete) {
				var currentStyles = self.options.to;
				for(var key in currentStyles) {
					if(currentStyles.hasOwnProperty(key)) {
						_$(self.target).css(key, currentStyles[key]);
					}
				}
				
				self.options.onEnd && self.options.onEnd();
			}
			
			return self;
		};
		/**
		 * 暂停动画
		 * @method pause
		 * @reutrn this
		 * @example
		 * 		new panda.util.Tweener().pause();
		 */
		self.pause = function() {
			if(self.timer) {
				self.timer.options.delay = 2592000000;
			}
			
			self.options.onPause && self.options.onPause();
			
			return self;
		};
		/**
		 * 恢复动画
		 * @method resume
		 * @return this
		 * @example
		 * 		new panda.util.Tweener().resume();
		 */
		self.resume = function() {
			if(self.timer) {
				self.timer.options.delay = self.delay;
			}
			
			self.options.onResume && self.options.onResume();
			
			return self;
		};
		/**
		 * 格式化目标值
		 * @method _getFrom
		 * @private
		 * @param {Object} source	源值
		 * @param {Object} target	目标值
		 * @return {Object} result
		 */
		self._getFrom = function(source, target) {
			var result = {};
			for(var key in target) {
				var value = _$(source).css(key);
				if(value === 'auto') {
					if(_$(self.target).css('position') == 'absolute') {
						if(key == 'top') {
							value = _$(self.target).position().y;
						}
						else if(key == 'left') {
							value = _$(self.target).position().x;
						}
					}else {
						value = 0;
					}
				}
				if(panda.dom.isStyle(key))
					result[key] = value;
				else
					result[key] = _$(source).attr(key) || 0;
			}
			
			for(var key in result) {
				return result;
			}
			
			return null;
		};
		self._empty = function() {
			
		};
		self._toInt = function(value, key) {
			if(typeof value === "string")
				return parseFloat(value);
			
			return value;
		};
		
		return self.initialize(opts);
	};
	
	module.exports = Tweener;
});
/**
 * 链接封装对象
 * @namespace Utilities.url
 * @constructor
 * User: lizihan
 * Date: 13-05-13
 * Time: 17:10
 */
define("base.util.URL", [], function (require, exports, module) {
	var URL = function(value) {
		var self = this;
		/**
		 * 原始链接
		 * @attribute _source
		 * @protected
		 * @type {String}
		 * @default ""
		 */
		self._source = "";
		/**
		 * 链接地址（无参数）
		 * @attribute _source
		 * @protected
		 * @type {String}
		 * @default ""
		 */
		self._url = "";
		/**
		 * 参数信息
		 * @attribute _query
		 * @protected
		 * @type {Object}
		 * @default null
		 */
		self._query = {};
		/**
		 * 锚点信息
		 * @attribute _anchor
		 * @protected
		 * @type {String}
		 * @default null
		 */
		self._anchor = null;
		/**
		 * 初始化方法
		 * @method initialize
		 * @protected
		 * @param {Object} value
		 * @return this
		 */
		self.initialize = function(value) {
			value = value || "";
			self._source = value;
			self._url = value;
			self._query = {};
			self.parse();
			
			return self;
		};
		/**
		 * 解析链接数据
		 * @method parse
		 * @protected
		 * @param {Object} value
		 * @return this
		 */
		self.parse = function(value) {
			if(value) {
				self._source = value;
				self._url = value;
			}
			
			self.parseAnchor();
			self.parseParam();
			
			return self;
		};
		/**
		 * 解析锚点信息
		 * @protected
		 * @method parseAnchor
		 * @return this
		 */
		self.parseAnchor = function() {
			var anchor = self._url.match(/\#(.*)/);
			anchor = anchor ? anchor[1] : null;
			self._anchor = anchor;
			
			if(anchor != null) {
				self._anchor = self.getNameValuePair(anchor);
				self._url = self._url.replace(/\#.*/, '');
			}
			
			return self;
		};
		/**
		 * 解析参数信息
		 * @protected
		 * @method parseParam
		 * @return this
		 */
		self.parseParam = function() {
			var query = self._url.match(/\?([^\?]*)/);
			query = query ? query[1] : null;
			if(query != null) {
				self._url = self._url.replace(/\?([^\?]*)/, '');
				self._query = self.getNameValuePair(query);
			}
			
			return self;
		};
		
		self.getNameValuePair = function(value) {
			var result = {};
			value.replace(/([^&=]*)(?:\=([^&]*))?/gim, function(w, name, value) {
				if(name == "")
					return;
					
				// 根据架构委员会建议：将匹配字段进行编码，以防出现XSS漏洞，该处修改导致对外API返回结果不一致		by lzh 2013-11-19
				result[name] = (value || "");
			});
			
			return result;
		};
		/**
		 * 获取URL原始链接
		 * @method getSource
		 * @return {String}
		 * @example
		 * 		new panda.util.URL("http://www.baidu.com/s?wd=mobile&rsv_spt=1&issp=1&rsv_bp=0").getSource();
		 * 		// ==> http://www.baidu.com/s?wd=mobile&rsv_spt=1&issp=1&rsv_bp=0
		 */
		self.getSource = function() {
			return self._source;
		};
		/**
		 * 根据指定参数名获取参数
		 * @method getParam
		 * @param {Object} name - 待获取的参数名
		 * @return {String}
		 * @example
		 * 		new panda.util.URL("http://www.baidu.com/s?wd=mobile&rsv_spt=1&issp=1&rsv_bp=0").getParam('wd');
		 * 		// ==> mobile
		 */
		self.getParam = function(name) {
			return self._query[name] || "";
		};
		/**
		 * 根据指定参数名设置参数
		 * @param {Object} name - 待设置的参数名
		 * @param {Object} value - 期望设置的值
		 * @method setParam
		 * @return this
		 * @example
		 * 		new panda.util.URL("http://www.baidu.com/s?wd=mobile&rsv_spt=1&issp=1&rsv_bp=0").setParam('wd', 'allplatform').getParam('wd');
		 * 		// ==> allplatform
		 */
		self.setParam = function(name, value) {
			if(name == null || name == "" || typeof name != 'string')
				throw new Error("URL.setParam invalidate param.");
				
			self._query = self._query || {};
			self._query[name] = value;
			
			return self;
		};
		/**
		 * 将所有参数信息清除
		 * @method clearParam
		 * @return this
		 * @example
		 * 		new panda.util.URL("http://www.baidu.com/s?wd=mobile&rsv_spt=1&issp=1&rsv_bp=0").getQuery();
		 * 		// ==> Object {}
		 */
		self.clearParam = function() {
			self._query = {};
			
			return self;
		};
		/**
		 * 设置字符串形式的Query串，该方法将会解析该字符串并生成键值对对象
		 * @method setQuery
		 * @param {Object} value
		 * @return this
		 * @example
		 * 		new panda.util.URL("http://www.baidu.com/s").setQuery("wd=mobile&rsv_spt=1&issp=1&rsv_bp=0").getQuery();
		 * 		// ==> Object {'wd':'mobile', 'rsv_spt':'1', 'issp':'1', rsv_bp:'0'}
		 */
		self.setQuery = function(value) {
			if(typeof value == 'string') {
				self.parse();
				self._source = self._url = self._url + "?"+ value;
				self.parse();
				return self;
			}
			
			self._query = value;
			
			return self;
		};
		/**
		 * 获取参数信息，并以Map的形式返回结果
		 * @method getQuery
		 * @return {Object}
		 * @example
		 * 		new panda.util.URL("http://www.baidu.com/s?wd=mobile&rsv_spt=1&issp=1&rsv_bp=0").getQuery();
		 * 		// ==> Object {'wd':'mobile', 'rsv_spt':'1', 'issp':'1', rsv_bp:'0'}
		 */
		self.getQuery = function() {
			return self._query;
		};
		/**
		 * 获取锚点信息
		 * @method getAnchor
		 * @return {String}
		 * @example
		 * 		new panda.util.URL("http://www.baidu.com/s#main").getAnchor();
		 * 		// ==> main
		 */
		self.getAnchor = function() {
			return self.serialize(self._anchor);
		};
		/**
		 * 序列化对象
		 * @protected
		 * @param {Object} value
		 * @method serialize
		 * @return {String}
		 */
		self.serialize = function(value) {
			var result = [];
			for(var key in value) {
				if(value[key] == null || value[key] == "") {
					result.push(key + "");
				}else {
					result.push(key + "=" + value[key]);
				}
			}
			
			return result.join("&");
		};
		/**
		 * 将链接所有属性整合并进行格式化输出
		 * @method toString
		 * @return {String}
		 * @example
		 * 		new panda.util.URL("http://t.cn").setQuery("wd=mobile").toString();
		 * 		// ==> http://t.cn?wd=mobile
		 */
		self.toString = function() {
			var query = self.serialize(self.getQuery());
			return self._url + (query.length>0?"?"+query:"") + (self._anchor?"#"+self.serialize(self._anchor):"");	
		};
		
		return self.initialize(value);
	};
	
	module.exports = URL;
});
/**
 * 全局唯一标识生成器
 * User: lizihan
 * Date: 13-06-16
 * Time: 15:14
 */
/**
 * 全局唯一标识生成器
 * @namespace Utilities.guid
 * @constructor
 */
define("base.util.guid", [], function (require, exports, module) {
    function Guid(g){
        var arr = new Array(); 
        if (typeof(g) == "string") { 
            initByString(arr, g);
        }
        else {
            initByOther(arr);
        }
        
        this.toString = function(format){
            if (typeof(format) == "string") {
                if (format == "N" || format == "D" || format == "B" || format == "P") {
                    return toStringWithFormat(arr, format);
                }
                else {
                    return toStringWithFormat(arr, "D");
                }
            }
            else {
                return toStringWithFormat(arr, "D");
            }
        };
        
        function initByString(arr, g){
            g = g.replace(/\{|\(|\)|\}|-/g, "");
            g = g.toLowerCase();
            if (g.length != 32 || g.search(/[^0-9,a-f]/i) != -1) {
                initByOther(arr);
            }
            else {
                for (var i = 0; i < g.length; i++) {
                    arr.push(g.charAt(i));
                }
            }
        }
        
        function initByOther(arr){
            var i = 32;
            while (i--) {
                arr.push("0");
            }
        }
        
        /*
         *  根据所提供的格式说明符，返回此 Guid 实例值的 String 表示形式。
         *	N  32 位： xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
         *	D  由连字符分隔的 32 位数字 xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
         *	B  括在大括号中、由连字符分隔的 32 位数字：{xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx}
         *	P  括在圆括号中、由连字符分隔的 32 位数字：(xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx)
         */
        function toStringWithFormat(arr, format){
            switch (format) {
                case "N":
                    return arr.toString().replace(/,/g, "");
                case "D":
                    var str = arr.slice(0, 8) + "-" + arr.slice(8, 12) + "-" + arr.slice(12, 16) + "-" + arr.slice(16, 20) + "-" + arr.slice(20, 32);
                    str = str.replace(/,/g, "");
                    return str;
                case "B":
                    var str = toStringWithFormat(arr, "D");
                    str = "{" + str + "}";
                    return str;
                case "P":
                    var str = toStringWithFormat(arr, "D");
                    str = "(" + str + ")";
                    return str;
                default:
                    return new Guid();
            }
        }
    }
	
	/**
	 * 全局唯一标识生成器
	 * @method guid
	 * @param {String} type N 生成唯一标识符的格式，可选值有N|D|B|P，在移动端中，仅提供N模式的实现，不区分格式
	 * @return {String}
	 * @example
	 * 		panda.util.guid();
	 * 		// ==> 046a7cf39b557b2775cc1954836777b1
	 * 		panda.util.guid("D");
	 * 		// ==> 2cf5a6a0-3fb7-cbde-99ce-e24e573f1100
	 * 		panda.util.guid("B");
	 * 		// ==> {2eb135ae-f5c8-0aaa-6824-0b9183e70b76}
	 * 		panda.util.guid("P");
	 * 		// ==> (a84d7d6b-877c-79f9-e542-d18a6e92e694)
	 */
	return function(type) {
		var g = "";
        var i = 32;
		if(!type) {
			type = "N";
		}
        while (i--) {
            g += Math.floor(Math.random() * 16.0).toString(16);
        }
        return new Guid(g).toString(type);
	};
});
/**
 * author: sunqingwei <sunqingwei@jd.com>
 * Date: 13-6-13
 * Time: 下午4:00
 */
/**
 * AJAX封装类
 * @namespace Utilities.io
 * @constructor
 */
define("base.util.io", [], function (require, exports, module) {
    var PObj = require("base.object"),
        Guid = require("base.util.guid"),
        JSONPRequest = require("base.util.jsonp"),
        PUrl = require("base.util.URL");

    /**
     * 通过 HTTP 请求加载远程数据
     * @method ajax
     * @param {Object} options {type:"GET",data:"",async:true，timeout：60000} ajax请求设置参数
     * @return {Panda}
     * @example
     *          panda.ajax({
	 * 				url:"url",      // 请求的地址
	 * 				type:"GET",     // ajax 类型， 支持 GET POST  JSOP ,关于jsonp详细接受请参考panda.jsonp 方法
	 * 			    time:3000,      // 超时时间
	 * 				dataType:"json" // 加载成功后的返回值类型，现在支持：text,json,jsonp,script
	 * 				data:{},         // 发送数据到服务器
	 * 				async:true,      // 同步 异步
	 * 				useGzip:false,    // 是否需要gzip 压缩
	 * 				success:function() {},   //成功回调
	 * 				error:function() {},     // 失败回调
	 * 				complete:function() {}   // 请求完成后回调函数 (请求成功或失败之后均调用)
	 * 			});
     */
    function IO(opts) {
        var self = this,
            _defaultCallback = function () {
            },
            defaultOpts = {
                url: window.location.href,
                type: "GET",
                async: true,
                useGzip: false,
                noCache: true,
                dataType: "",
                requestHeaders: {},
                core: null,
                data: {},
                timeout: 60000,
                tId: null,
                success: _defaultCallback,
                error: _defaultCallback,
                complete: _defaultCallback,
                crossDomain:false
            };
        this.options = PObj.parameter(opts, defaultOpts);
        
        if(this.options.dataType == 'script') {
        	return new JSONPRequest()._init(this.options);
        }
        
        if(this.options.dataType == 'jsonp') {
			this.options.callbackParameter = this.options.callbackParameter || 'callback';
			this.options.callback = this.options.callback || ('_'+(Guid()));
			return new JSONPRequest()._init(this.options);
		}
        
        this.urlObj = new PUrl(this.options.url);
        this.setHeader = function (headName, headValue) {
            this.options.requestHeaders[headName] = headValue;
        };
        this.parameterData = function () {
            var result = [];
            var _data = this.urlObj._query;
            for (var i in _data)
                result.push(i + '=' + encodeURIComponent(decodeURIComponent(_data[i])));
            
            if(typeof self.options.data == 'object') {
	            for (var key in self.options.data) {
	            	if(self.options.data.hasOwnProperty(key)) {
	            		result.push(key + "=" + self.options.data[key]);
	            	}
	            }
	        }else if(self.options.data) {
	        	result.push(self.options.data.toString());
	        }
            return result.join('&');
        };

        this.getNoCacheableURL = function (url, cache) {
            if (cache) {
                var _url = url.indexOf('?') > 0 ? url + "&t=" : url + '?';
                return _url + Math.round(Math.random() * 10000);
            } else {
                return url;
            }
        };
        this.fixed = function () {
            if (( self.options.type.toUpperCase()) == "POST") {
                if (self.options.requestHeaders.contentType) {
                    self.setHeader("CONTENT-TYPE", self.requestHeaders.contentType);
                } else {
                    self.setHeader("CONTENT-TYPE", "application/x-www-form-urlencoded");
                }
            } else {
                var parameterData = self.parameterData();
                if (parameterData && parameterData.length > 0)
                    self.urlObj.url += "?" + self.parameterData();
            }
            if (self.options.useGzip) {
                self.setHeader("Accept-Encoding", "gzip, deflate");
            }
        };

        this.done = function () {
        	var url = self.urlObj._url;
        	if((self.options.type.toUpperCase()) == "GET") {
        		url = url + "?"+ self.parameterData();
        	}
        	url = self.getNoCacheableURL(url, true);
        	
            self.core = this._createCore();
            try {
            	self.core.id = Guid();
            }catch(e) {}
            self.core.onreadystatechange = _onReadyStateChange;
            self.core.open(self.options.type.toUpperCase(), url, !!self.options.async);
            try {
            for (var i in self.options.requestHeaders) {
                self.core.setRequestHeader(i, self.options.requestHeaders[i]);
            }
	        }catch(e) {}
            self.core.send(self.options.type.toUpperCase() == 'POST' ? (self.parameterData() || null) : null);
            if (self.options.async && self.options.timeout > 0) {
                self.timeoutTimer = setTimeout(function () {
                    self.core.abort();
                    self.options.error("", "timeout", self.core);
                }, self.options.timeout);
            }
        };
        function _onReadyStateChange() {
            switch (self.core.readyState) {
                case 1:
                case 2:
                case 3:
                    break;
                case 4:
                    if (window && window.ued_config && window.ued_config.development == 'online') {
                        try {
                            _onResponse();
                        } catch (e) {
                            panda.stack.extractStacktrace(e, 1);
                        }
                    } else {
                        _onResponse();
                    }
                    break;
                default:
                    break;
            }
        };

        function _onResponse() {
            if (self.options.timeoutTimer) clearTimeout(self.options.timeoutTimer);
            var _responseText = self.core.responseText;
            if (self.core.status == 200) {
                if (self.options.dataType && self.options.dataType == "json") {
                	try {
                    	eval("var response =" + (self.core.response || _responseText));
                    }catch(e) {
                   		var response = "";
                    }
                } 
                else {
                    var response = self.core.response || _responseText;
                }
                self.options.success(response);
            } else {
                self.options.error(_responseText, self.core.statusText, self.core);
            }
            self.options.complete(self.core.response);
            
            if (self.timeoutTimer)clearTimeout(self.timeoutTimer);
        };
        this._createCore = function () {
            var _xmlhttp = null;
            if (window.ActiveXObject) {
                try {
                    _xmlhttp = new ActiveXObject('microsoft.xmlhttp');
                } catch (e) {
                    _xmlhttp = new ActiveXObject('msxml2.xmlhttp');
                }
            } else {
                _xmlhttp = new XMLHttpRequest();
            }
            return _xmlhttp;
        };

        this.urlObj.parse();
        this.fixed();
        this.done();

        return self;
    }
    /**
     * 跨域请求
     * @method jsonp
     * @param {Object} options - jsonp请求设置参数
     * @return {undefined}
     * @example
     *      panda.jsonp({
     *           url: "url", // 请求的地址
     *           data:{      // 服务端接受的参数
     *               type:1,
     *               message:"测试"
     *           },
     *           timeout:1,  // 超时时间
     *           error:function (type){            // 失败的回调
     *               console.log(type);
     *           },
     *           success:function (c){            // 成功的回调
     *               console.log("success=" + c);
     *           }
     *       });
     */
    /**
     * 异步加载JS代码
     * @method getScript
     * @param {String} url - 期望加载的JS代码文件地址
     * @param {Function} callback - 加载成功后的回调函数，该回调函数无参数
     * @return {undefined}
     * @example
     *      panda.getScript("http://somethingyouwantload.com/some.js", function() {
     * 			console.log("I executed after the \"some.js\" loaded");
     * 		});
     */
    module.exports = {
        ajax: function() {
        	return new IO(arguments[0]);
        },
        jsonp: function () {
            var jp = new JSONPRequest();
            jp._init(arguments[0]);
        },
        getScript:function(url, callback) {
        	return this.ajax({
        		url:url,
        		dataType:"script",
        		success:callback
        	});
        }
    };
});
/**
 * author: sunqingwei <sunqingwei@jd.com>
 * Date: 13-11-22
 * Time: 上午10:20
 /**
 * AJAX封装类
 * @namespace Utilities.io
 * @constructor
 */
define("base.util.jsonp", [], function (require, exports, module) {
    /**
     * 加载依赖
     */
    var PObject = require("base.object");
    var PGuid = require("base.util.guid");
    var win = PObject.isWindow(window) ? window : null,
        doc = PObject.isWindow(window) ? win.document : null,
        _defaultCallback = function () {
        };
        
    var bind = function (func, scope) {
    	var me = func;
        return function () {
            return me.apply(scope, arguments);
        };
    };

    function jsonp() {
        this._configs = {
            STR_ASYNC: "async",
            STR_CHARSET: "charset",
            STR_CED_JSONP: "cedJsonp",
            STR_ON: "on",
            STR_ON_ERROR: "onerror",
            STR_ON_LOAD: "onload",
            STR_ON_READY_STATE_CHANGE: "onreadystatechange",
            STR_READY_STATE: "readyState",
            STR_REMOVE_CHILD: "removeChild",
            STR_SCRIPT_TAG: "<script>",
            STR_SUCCESS: "success",
            STR_ERROR: "error",
            STR_TIMEOUT: "timeout",
            STR_ID: "cedJsonp"
        };
        this.lastValue = null;
        this.done = 0;
        this.stamp = 0;
        this._header = doc.getElementsByTagName("head")[0];
        this._script = doc.createElement("script");
        this._defaultOpts = {
            success: _defaultCallback,
            error: _defaultCallback,
            complete: _defaultCallback,
            callback: "jsonp"+PGuid(),
			callbackParameter:"callback"
        };
    }

    jsonp.prototype = {
        _qMarkOrAmp: function (url) {
            return /\?/.test(url) ? "&" : "?";
        },
        _init: function (opts) {
            this._configs.STR_ID += PGuid();
            this.options = PObject.parameter(opts, this._defaultOpts);
            this.stamp = new Date().valueOf();
            this._open();
            this._send();
        },
        genericCallback: function (data) {
            this.lastValue = [ data ];
        },
        _open: function () {
            var self = this;
            if(win.hasOwnProperty(self.options.callback) && panda.object.isFunction(win[self.options.callback])) {
            	// 已存在则不生成新的函数 by lizihan 20140225
            }else {
            	win[self.options.callback] = bind(self.genericCallback, self);
            }
            self._script[self._configs.STR_ON_LOAD] =
                self._script[self._configs.STR_ON_ERROR] =
                    self._script[self._configs.STR_ON_READY_STATE_CHANGE] = function (result) {
                        if (!self._script[self._configs.STR_READY_STATE ] || !/i/.test(self._script[self._configs.STR_READY_STATE])) {
                            result = self.lastValue;
                            if(self.options.dataType == 'script' && result) {
                            	self.options.success && (self.options.success());
                            }else {
                            	result ? self.notifySuccess(result[ 0 ]) : self.notifyError(self._configs.STR_ERROR);
                            }
                            
                            self.lastValue = null;
                            self._script[self._configs.STR_ON_LOAD] = self._script[self._configs.STR_ON_ERROR] = self._script[self._configs.STR_ON_READY_STATE_CHANGE] = null;
                        }
                    };
            this.options.url += panda.isEmptyObject(this.options.data) ? "": ( this._qMarkOrAmp(this.options.url) + self._paramtoString(this.options.data));
            this.options.callbackParameter && ( this.options.url += this._qMarkOrAmp(this.options.url) + encodeURIComponent(this.options.callbackParameter) + "=?" );
            !this.options.cache && !this.options.pageCache && ( this.options.url += this._qMarkOrAmp(this.options.url) + "_" + this.stamp + "=" );
            this.options.url = this.options.url.replace(/=\?(&|$)/, "=" + this.options.callback + "$1");
        },
        _paramtoString:function(data){
            var result = [];
            var _data = data;
            if(panda.isEmptyObject(_data))return "";
            for(var i in _data)
                result.push(i+'='+_data[i]);
            return result.join('&');
        },
        _send: function () {
            this._script.src = this.options.url || "";
            this._script.id = this._configs.STR_ID;
            this._script.charset = this.options.charset || "utf-8";
            this._header.appendChild(this._script);
        },
        notifySuccess: function (result) {
            if (!( this.done++ )) {
                this.options.success(result);
                this.clearUp();
            }
        },
        notifyError: function (result) {
            if (!( this.done++ )) {
                this.options.error(result);
                this.clearUp();
            }
        },
        startClientTime: function () {
            var self = this;
            this.tId = this.options.timeout > 0 && setTimeout(function () {
                self.notifyError(self.options.STR_TIMEOUT);
            }, this.options.timeout);
        },
        clearUp: function () {
            this.tId && clearTimeout(this.tId);
            this._script[ this._configs.STR_ON_READY_STATE_CHANGE ] =
                this._script[ this._configs.STR_ON_LOAD ] =
                    this._script[ this._configs.STR_ON_ERROR ] = null;
            if (doc.getElementById(this._configs.STR_ID).parentNode)
                doc.getElementById(this._configs.STR_ID).parentNode.removeChild(doc.getElementById(this._configs.STR_ID));
        }
    };
    module.exports = jsonp;
})
;
/**
 * 语言本地化
 * User: lizihan
 * Date: 13-05-09
 * Time: 15:14
 */
/**
 * 文本国际化方法，建议在用户可看到的方案信息均从此方法中获取，以便后期批量替换
 * @namespace Utilities.lang
 * @contructor
 */
define("base.util.lang", [], function (require, exports, module) {
	var _obj = require("base.object");
	var _str = require("base.string.class");
	
	var current_lang = "zh-cn";
	var global_lang = {
		"zh-cn" : {}
	};
	
	module.exports = {
		/**
		 * 设置当前语种下指定KEY值的文案信息
		 * @pc
		 * @method lang
		 * @param {String} key - 设置当前文案的KEY值信息
		 * @param {String} value - 设置当前文案对应的字符串信息
		 * @return {undefined}
		 * @example
		 * 		panda.util.lang('SUCCESS', '成功');
		 */
		/**
		 * 设置当前语种下指定KEY值的文案信息
		 * @pc
		 * @method lang
		 * @param {String} key - 设置当前文案的KEY值信息
		 * @param {String} value - 设置当前文案对应的字符串信息
		 * @param {String} langType - 指定当前新增文案信息到某语种
		 * @return {undefined}
		 * @example
		 * 		panda.util.lang('SUCCESS', 'success', 'en-us');
		 */
		/**
		 * 获取当前语种下指定KEY值的文案信息
		 * @pc
		 * @method lang
		 * @param {String} key - 当前文案的KEY值信息
		 * @return {undefined}
		 * @example
		 * 		panda.util.setLangType('en-us');
		 * 		panda.util.lang('SUCCESS');
		 * 		// ==> success
		 */
		lang:function() {
			var args = arguments;
			
			var lang_type = current_lang;
			if(args.length == 3) {
				lang_type = args[2];
			}
			
			if(args.length == 1) {
				return global_lang[lang_type] ? global_lang[lang_type][args[0]] : "";
			}
			
			if(args.length >= 2) {
				this.setLangType(lang_type);
				
				global_lang[lang_type][args[0]] = args[1];
			}
		},
		/**
		 * 设置当前全局语种
		 * @method setLangType
		 * @pc
 		 * @param {Object} value zh-cn 设置当前使用全局语言类型
 		 * @example
 		 * 		panda.util.setLangType('zh-cn');
		 */
		setLangType:function(value) {
			current_lang = value;
			
			if(typeof global_lang[current_lang] == 'undefined') {
				global_lang[current_lang] = {};
			}
		}
	};
});
/**
 * 提供HTML片段的格式化方式，这些方法主要用于对可变HTML模板的数据替换
 * @namespace Utilities.template
 * @constructor
 */
define("base.util.template", [], function(require, exports, module){
    var Template = function(value) {
		var self = this;
		/**
		 * 原始模板数据
		 * @attribute html
		 * @protected
		 * @type {String}
		 * @default ""
		 */
		self.html = "";
		/**
		 * 模板初始化方法
		 * @protected
		 * @method initialize
		 * @param {String} value
		 * @return this
		 */
		self.initialize = function(value) {
			if(typeof value == 'undefined')
				value = "";
			
			if(value instanceof Array) {
				value = value.join("");
			}
			
			self.html = value;
			
			return self;
		};
		/**
		 * 根据数据返回生成后的模板
		 * @pc
		 * @method expand
		 * @param {Object} opt - 配置将在模板中进行替换的数据，此数据为一个Map键值对,若满足{key}形式且未在此配置参数中提供数据，则会保留原始关键字不做替换
		 * @return {String}
		 * @example
		 * 		panda.util.template.create('<li>{name}</li>').expand({name:'panda'});
		 * 		// ==> <li>panda</li>
		 */
		self.expand = function(opt) {
			var ori = true;
			var curStr = this.html;
			if(!opt) {
				return curStr.toString();
			}
			var formatReg = /\{([^\s{}]+?)\}/ig;
			curStr = curStr.replace(formatReg, function(match, f1, index, srcStr){
				return opt.hasOwnProperty(f1)?opt[f1]:(ori?match:"");
			});
			return curStr;
		};
		
		return self.initialize(value);
	};
	
	return{
		create:function(html) {
			return new Template(html);
		}
	};
});
/**
 * User: lizihan
 * Date: 13-06-17
 * Time: 10:37 
 */
/**
 * 缓动函数，该系列函数为Tweener提供了可选的缓动方式，通常情况下，只需要传递一个字符串形式的方法名，而无需关注其它内容
 * @namespace Utilities.tweener
 */
define("base.util.tweens", [], function (require, exports, module) {
	module.exports = {
		/**
		 * @method linear
		 * @param {Object} t - -
		 * @param {Object} b - -
		 * @param {Object} c - -
		 * @param {Object} d - -
		 * @return {Number}
		 */
		linear:function(t,b,c,d){ 
			return c*t/d + b; 
		},
		/**
		 * @method easeInQuad
		 * @param {Object} t - -
		 * @param {Object} b - -
		 * @param {Object} c - -
		 * @param {Object} d - -
		 * @return {Number}
		 */
		easeInQuad:function(t,b,c,d){
            return c*(t/=d)*t + b;
        },
		/**
		 * @method easeOutQuad
		 * @param {Object} t - -
		 * @param {Object} b - -
		 * @param {Object} c - -
		 * @param {Object} d - -
		 * @return {Number}
		 */
		easeOutQuad:function(t,b,c,d){
            return -c *(t/=d)*(t-2) + b;
        },
		/**
		 * @method easeInOutQuad
		 * @param {Object} t - -
		 * @param {Object} b - -
		 * @param {Object} c - -
		 * @param {Object} d - -
		 * @return {Number}
		 */
		easeInOutQuad:function(t,b,c,d){
            if ((t/=d/2) < 1) return c/2*t*t + b;
            return -c/2 * ((--t)*(t-2) - 1) + b;
        },
		/**
		 * @method easeInCubic
		 * @param {Object} t - -
		 * @param {Object} b - -
		 * @param {Object} c - -
		 * @param {Object} d - -
		 * @return {Number}
		 */
		easeInCubic:function(t,b,c,d){
            return c*(t/=d)*t*t + b;
        },
		/**
		 * @method easeOutCubic
		 * @param {Object} t - -
		 * @param {Object} b - -
		 * @param {Object} c - -
		 * @param {Object} d - -
		 * @return {Number}
		 */
		easeOutCubic:function(t,b,c,d){
            return c*((t=t/d-1)*t*t + 1) + b;
        },
		/**
		 * @method easeInOutCubic
		 * @param {Object} t - -
		 * @param {Object} b - -
		 * @param {Object} c - -
		 * @param {Object} d - -
		 * @return {Number}
		 */
		easeInOutCubic:function(t,b,c,d){
            if ((t/=d/2) < 1) return c/2*t*t*t + b;
            return c/2*((t-=2)*t*t + 2) + b;
        },
		/**
		 * @method easeInQuart
		 * @param {Object} t - -
		 * @param {Object} b - -
		 * @param {Object} c - -
		 * @param {Object} d - -
		 * @return {Number}
		 */
		easeInQuart:function(t,b,c,d){
            return c*(t/=d)*t*t*t + b;
        },
		/**
		 * @method easeOutQuart
		 * @param {Object} t - -
		 * @param {Object} b - -
		 * @param {Object} c - -
		 * @param {Object} d - -
		 * @return {Number}
		 */
		easeOutQuart:function(t,b,c,d){
            return -c * ((t=t/d-1)*t*t*t - 1) + b;
        },
		/**
		 * @method easeInOutQuart
		 * @param {Object} t - -
		 * @param {Object} b - -
		 * @param {Object} c - -
		 * @param {Object} d - -
		 * @return {Number}
		 */
		easeInOutQuart:function(t,b,c,d){
            if ((t/=d/2) < 1) return c/2*t*t*t*t + b;
            return -c/2 * ((t-=2)*t*t*t - 2) + b;
        },
		/**
		 * @method easeInQuint
		 * @param {Object} t - -
		 * @param {Object} b - -
		 * @param {Object} c - -
		 * @param {Object} d - -
		 * @return {Number}
		 */
		easeInQuint:function(t,b,c,d){
            return c*(t/=d)*t*t*t*t + b;
        },
		/**
		 * @method easeOutQuint
		 * @param {Object} t - -
		 * @param {Object} b - -
		 * @param {Object} c - -
		 * @param {Object} d - -
		 * @return {Number}
		 */
		easeOutQuint:function(t,b,c,d){
            return c*((t=t/d-1)*t*t*t*t + 1) + b;
        },
		/**
		 * @method easeInOutQuint
		 * @param {Object} t - -
		 * @param {Object} b - -
		 * @param {Object} c - -
		 * @param {Object} d - -
		 * @return {Number}
		 */
		easeInOutQuint:function(t,b,c,d){
            if ((t/=d/2) < 1) return c/2*t*t*t*t*t + b;
            return c/2*((t-=2)*t*t*t*t + 2) + b;
        },
		/**
		 * @method easeInSine
		 * @param {Object} t - -
		 * @param {Object} b - -
		 * @param {Object} c - -
		 * @param {Object} d - -
		 * @return {Number}
		 */
		easeInSine:function(t,b,c,d){
            return -c * Math.cos(t/d * (Math.PI/2)) + c + b;
        },
		/**
		 * @method easeOutSine
		 * @param {Object} t - -
		 * @param {Object} b - -
		 * @param {Object} c - -
		 * @param {Object} d - -
		 * @return {Number}
		 */
		easeOutSine:function(t,b,c,d){
            return c * Math.sin(t/d * (Math.PI/2)) + b;
        },
		/**
		 * @method easeInOutSine
		 * @param {Object} t - -
		 * @param {Object} b - -
		 * @param {Object} c - -
		 * @param {Object} d - -
		 * @return {Number}
		 */
		easeInOutSine:function(t,b,c,d){
            return -c/2 * (Math.cos(Math.PI*t/d) - 1) + b;
        }
	};
});
/**
 * 组件基础类及建议公开的API
 * @namespace Widget.base
 * @constructor
 * User: lizihan
 * Date: 13-06-20
 * Time: 18:41
 */
define("base.widget.Widget", [], function(require, exports, module) {
	var _guid = require("base.util.guid");
	
	var Widget = function() {
		var self = this;
		/**
		 * 组件管理器的单例引用
		 * @attribute manager
		 * @protected
		 * @type {Object}
		 * @default WidgetManager instance
		 */
		self.manager = require("base.widget.WidgetManager");
		/**
		 * 组件唯一ID
		 * @attribute name
		 * @protected
		 * @type {String}
		 * @default Widget_[guid]
		 */
		self.name = "Widget_"+_guid();
		/**
		 * 组件可监听事件列表
		 * @attribute publishList
		 * @protected
		 * @type {Array}
		 * @default []
		 */
		self.publishList = [];
		/**
		 * 组件可发布事件列表
		 * @attribute notifyList
		 * @protected
		 * @type {Array}
		 * @default []
		 */
		self.notifyList = [];
		/**
		 * 组件可发布事件列表
		 * @attribute notifyList
		 * @protected
		 * @type {Array}
		 * @default []
		 */
		self.uiType = null;
		/**
		 * 组件实例化方法
		 * @method initialize
		 * @return {Panda}
		 */
		self.initialize = function() {
			self.manager.add({
				name:self.name,
				publishList:self.publishList,
				notifyList:self.notifyList,
				type:self.uiType,
				target:self
			});
			return self;
		};
		/**
		 * 组件初始化方法
		 * @method init
         * @return {undefined}
		 */
		self.init = function() {
			
		};
		/**
		 * 组件规范建议使用的渲染方法
		 * @method render
         * @return {undefined}
		 */
		self.render = function(opts) {
			
		};
		/**
		 * 组件规范建议使用的销毁方法
		 * @method destroy
         * @return {undefined}
         */
		self.destroy = function() {
			
		};
		/**
		 * 获取自定义事件
		 * @method notify
		 * @param {String} eventName - 事件名
		 * @param {Object} data - 数据
         * @return {undefined}
		 */
		self.notify = function(eventName, data) {
			
		};
		/**
		 * 发布自定义事件
		 * @method publish
		 * @param {Object} eventName 事件名
		 * @param {Object} data - 数据
         * @return {undefined}
		 */
		self.publish = function(eventName, data) {
			if(self.manager) {
				self.manager.publish(self, eventName, data);
			}
		};
		
		return self.initialize();
	};
	
	module.exports = Widget;
});

/**
 * 全局组件管理器
 * @namespace Widget.manager
 * @constructor
 * User: lizihan
 * Date: 13-06-20
 * Time: 18:41
 */
define("base.widget.WidgetManager", [], function(require, exports, module) {
	var Manager = function() {
		var self = this;
		/**
		 * 组件类型分类
		 * @private
		 * @attribute _types
		 * @type {Object}
		 * @default {}
		 */
		self._types = {};
		/**
		 * 保存所有组件
		 * @private
		 * @attribute _list
		 * @type {Object}
		 * @default {}
		 */
		self._list = {};
		/**
		 * 自定义事件发布者
		 * @private
		 * @attribute _dispatcher
		 * @type {Object}
		 * @default {}
		 */
		self._dispatcher = {};
		
		/**
		 * 添加组件实例，为组件添加事件相关处理，分类存储组件引用
		 * @method add
		 * @param {Object} ui - 添加组件的配置参数，以下参数为必要参数：name 唯一标识符，publishList 发布事件列表， notifyList 监听事件列表， type UI类型标识， target UI实例
		 * @return {PandaDOM}
		 */
		self.add = function(ui) {
			if(!ui || !ui.target) {
				throw new Error("Can't added a null Object to WidgetManager");
			}
			
			if(typeof this._types[ui.type] != 'array') {
				this._types[ui.type] = [];
			}
			this._types[ui.type].push(ui);
			
			this._list[ui.name] = ui;
			
			// 待添加监听事件
			for (var i = 0; i < ui.notifyList.length; i++) {
				if (typeof this._dispatcher[ui.notifyList[i]] != 'array') {
					this._dispatcher[ui.notifyList[i]] = [];
				}
				
				this._dispatcher[ui.notifyList[i]].push(ui.name);
			}
			
			return ui.target;
		};
		/**
		 * 删除组件
		 * @method remove
		 * @param {String} value - 待删除组件的name字段
		 * @return {undefined}
		 */
		/**
		 * 删除组件
		 * @method remove
		 * @param {Object} obj - 待删除的组件对象
		 * @return {undefined}
		 */
		self.remove = function(value) {
			var uiClass = null;
			if(typeof value == 'string') {
				uiClass = this._list[ui];
			}
			if(typeof value == 'object') {
				uiClass = this._list[ui.name];
			}
			
			//从types里删除
			for(var i=0;i<this._types[uiClass.type].length;i++) {
				if(this._types[uiClass.type][i] && this._types[uiClass.type][i].name == uiClass.name) {
					this._types[uiClass.type].splice(i, 1);
					break;
				}
			}
			
			//从list里删除
			for(var key in this._list) {
				if(this._list[key] && this._list[key].name == uiClass.name) {
					delete this._list[key];
					break;
				}
			}
			//执行destroy方法
			uiClass.target && uiClass.target.destroy && uiClass.target.destroy();
			
			//注销事件
			
			return uiClass;
		};
		/**
		 * 获取组件实例
		 * @method get
		 * @param {Widget} Class - 待初始化的组件类（非对象）
		 * @param {Object} opts - 初始化组件时的配置参数
		 * @return {PandaWidget}
		 * @example
		 *      var slider = panda.widget.manager.get(requirec("widget.Slider"), {type:'vertical'});
		 */
		self.get = function(Class, opts) {
			var TypeWidget = null;
			TypeWidget = new Class();
			TypeWidget.init(opts);
			return TypeWidget;
		};
		/**
		 * 根据组件唯一ID获取组件实例
		 * @method getByName
		 * @param {String} name - 组件ID
		 * @return {PandaWiget}
         * @example
         * 		 *      var slider = panda.widget.manager.get(requirec("widget.Slider"), {type:'vertical'});

         *   var button = panda.widget.manager.getByName("Button");
         */
		self.getByName = function(name) {
			return this._list[name].target;
		};
		/**
		 * 根据组件类型获取组件实例组
		 * @method getByType
		 * @param {String} name - 组件的uiType类型
		 * @return Array
		 */
		self.getByType = function(type) {
			return this._types[type];
		};
		/**
		 * 发布事件
		 * @method publish
		 * @param {Object} target - 发布事件的组件对象
		 * @param {String} eventName - 发布事件的名称
		 * @param {Object} data - 事件所携带的事件数据
		 * @return {undefined}
		 */
		self.publish = function(target, eventName, data) {
			if(panda(target.publishList).index(eventName) > -1) {
				this.dispatch(eventName, data);
			}
		};
		/**
		 * 发布事件
		 * @method publish
		 * @protected
		 * @param {String} eventName
		 * @param {Object} data
		 */
		self.dispatch = function(eventName, data) {
			if(this._dispatcher[eventName] && this._dispatcher[eventName] instanceof Array) {
				for(var i=0;i<this._dispatcher[eventName].length;i++) {
					var target = this.getByName(this._dispatcher[eventName][i]);
					if(target) {
						target.notify.call(target, eventName, data);
					}
				}
			}
		};
		
		return self;
	};
	
	module.exports = new Manager();
});
